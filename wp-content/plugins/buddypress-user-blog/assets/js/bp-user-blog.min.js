/*! 
 * BuddyBoss User Blog JavaScript Library 
 * @package BuddyBoss User Blog 
 */function sap_draft_screen_auto_save(){leavetype=function(){(jq(this).find(".medium-insert-images").length>0||jq(this).find("medium-insert-embeds").length>0||"<br>"!==jq(this).find("p").html())&&(clearTimeout(window.sap_autosave_secout),window.sap_autosave_secout=setTimeout(function(){var a=jq("#sap-draft-status").val();""==a&&(a="draft");jq("#sap-edit-status").val();"draft"==a&&sap_post_add_screen("draft","true")},1e3))},entertype=function(){clearTimeout(window.sap_autosave_secout)},jQuery(document).on("keyup",".sap-editable-area",leavetype),jQuery(document).on("keydown",".sap-editable-area",entertype),window.sap_draft_leavetype=leavetype,window.sap_draft_entertype=entertype}function sap_post_add_screen(a,b){var c=jq(".sap-story-publish"),d=jq(".sap-story-draft"),e=jq(".sap-story-review");c.addClass("sap-disabled"),d.addClass("sap-disabled"),d.text(sap_loading_string.saving_string),e.addClass("sap-disabled");var f=title.serialize(),g=jq(".sap-editable-title").attr("id"),h=editor.serialize(),i=jq(".sap-editable-area").attr("id"),j=(jq("#sap-draft-status").val(),jq("#sap-edit-status").val(),jq("#sap_is_index_page").val());"yes"==j&&(a="draft");var k=new Array;jq(".category_hierarchy_ul .single_cat .blogpost_cat").each(function(){var a=jq(this);a.is(":checked")&&k.push(a.val())});var l={action:"sap_save_post",sap_nonce:jq(".sap-editor-nonce").val(),sap_editor_nonce:jq(".sap-publish-popup").find('input[name="sap_editor_nonce"]').val(),post_title:f[g],post_content:h[i],post_cat:k,post_tags:jq("#input-tags-select").val(),post_img:jq("#featured-img-placeholder-id").val(),post_status:a,draft_pid:jq("#sap-draft-pid").val()};l.post_content=BBOSS_SAP.editor.sanitize_content(l.post_content),jq.ajax({type:"POST",url:ajaxurl,data:l,success:function(f){var f=jQuery.parseJSON(f);"Failed"==f[0]?alert(sap_loading_string.failed_string):"Empty"==f[0]?alert(sap_loading_string.empty_content):("pending"==a&&(jq(".sap-post-status").text(sap_loading_string.inreview_string),alert(sap_loading_string.review_string)),"publish"==a&&(window.location.href=f[1]),"draft"==a&&("yes"==j?window.location.href=f[1]:jq(".sap-post-status").text(sap_loading_string.draft_string)),jq("#sap-draft-pid").val(f[0]),jq(".sap-story-preview").attr("href",f[1]),jq(".sap-story-preview").removeClass("sap-disabled"),"false"==b&&jq(".sap-story-publish").removeClass("sap-story-publish-btn")),c.removeClass("sap-disabled"),d.removeClass("sap-disabled"),d.text(sap_loading_string.saved_string),e.removeClass("sap-disabled"),"pending"==a&&"Empty"!=f[0]&&(d.text("Revert to draft"),jq("#sap-draft-status").val("pending"),jq(".sap-pending-preview").show(),jq(".sap-story-review").hide(),jq(".sap-story-delete").show())}})}function sap_check_empty_title(){var a=title.serialize(),b=jq(".sap-editable-title").attr("id"),c=a[b].value,d=jq("#sap-edit-status").val();return jq("body").hasClass("userblog-ie")||"true"==d||0!=jq(c).text().length?0==c.length?"empty":void 0:"empty"}function sap_empty_editor(){jq(".sap-editable-title").html(""),jq(".sap-editable-area").html(""),jq("#sap-cat").val("1"),jq("#sap-cat").change(),jq(".selectize-input").find("div").remove()}if("undefined"==typeof jq)var jq=jQuery;var title=new MediumEditor(".sap-editable-title",{placeholder:{text:sap_loading_string.editor_title}}),editor=new MediumEditor(".sap-editable-area",{placeholder:{text:sap_loading_string.content_placeholder},toolbar:{buttons:["bold","italic","underline","anchor","h2","h3","orderedlist","unorderedlist","quote"]},autoLink:!0,targetBlank:!0});jq(function(){jq(".sap-editable-area").mediumInsert({editor:editor,addons:{images:{label:'<span class="fa fa-camera"></span>',deleteScript:ajaxurl+"?action=buddyboss_sap_delete_photo&sap-editor-nonce="+jq("input[name='sap_editor_nonce']").val(),deleteMethod:"POST",fileDeleteOptions:{},preview:!0,captionPlaceholder:"Type caption for image (optional)",autoGrid:3,fileUploadOptions:{url:ajaxurl+"?action=buddyboss_sap_post_photo",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,formData:[{name:"sap-editor-nonce",value:jq("input[name='sap_editor_nonce']").val()}],limitMultiFileUploadSize:!1,always:function(a,b){window.sap_last_uploaded_image=b},fail:function(a,b){window.sap_last_uploaded_image=b}},uploadCompleted:function(a,b){""!=b.result.files[0].url&&null!=b.result.files[0].url||(alert("Error while uploading image on the server."),jQuery(a).remove()),a.find(".fa-spin").remove();var c=jq("#sap-draft-status").val();""==c&&(c="draft");jq("#sap-edit-status").val();"draft"==c&&setTimeout(function(){sap_post_add_screen("draft","true")},500)}}}})}),jq(document).on("click",".medium-editor-action",function(){setTimeout(function(){var a=jq("#sap-draft-status").val();""==a&&(a="draft");jq("#sap-edit-status").val();"draft"==a&&sap_post_add_screen("draft","true")},1e3)}),jq(".sap-story-publish").on("click",function(a){return a.preventDefault(),"empty"==sap_check_empty_title()?void alert(sap_loading_string.empty_title):(jq("#sap-draft-status").val("publish"),void sap_post_add_screen("publish","false"))}),jq(".sap-story-review").on("click",function(a){return a.preventDefault(),"empty"==sap_check_empty_title()?void alert(sap_loading_string.empty_title):void sap_post_add_screen("pending","false")}),jq(".sap-story-draft").on("click",function(a){a.preventDefault(),jq("#sap-draft-status").val(""),sap_post_add_screen("draft","false"),jq(".sap-story-delete").show(),jq(".sap-pending-preview").hide(),jq(".sap-story-review").show(),jQuery(".sap-story-publish").text("Publish")}),jq(".sap-story-update").on("click",function(a){a.preventDefault(),jq("#sap-edit-status").val(""),sap_post_add_screen("publish","false")}),jq(".sap-story-delete").on("click",function(a){a.preventDefault();var b=confirm("Once deleted it cannot be recovered. Are you sure?");if(1==b){var c={action:"sap_delete_post",sap_nonce:jq(".sap-editor-nonce").val(),sap_editor_nonce:jq(".sap-publish-popup").find('input[name="sap_editor_nonce"]').val(),draft_pid:jq("#sap-draft-pid").val()};jq.ajax({type:"POST",url:ajaxurl,data:c,success:function(a){sap_empty_editor(),window.location.reload()}})}}),jq(document).keypress(function(a){13==a.which&&jq.getScript("//platform.twitter.com/widgets.js",function(){for(var a,b,c=0,d=document.getElementById("twitter-widget-"+c);d;)a=d.parentNode,b=d.dataset.tweetId,jq(d).remove(),twttr.widgets.createTweet(b,a),c++,d=document.getElementById("twitter-widget-"+c)})}),BBOSS_SAP={},BBOSS_SAP.editor={},function(a,b,c){var d=!1,e={},f=0;pics_uploaded=[],state={uploader_max_files:1,uploader_temp_img:"http://placehold.it/150&text=image"},a.init=function(){return!!a.get_elements()&&(setTimeout(function(){a.start_uploader()},10),e.$close_button.on("click",function(b){b.preventDefault(),a.clear_upload()}),c(".toggle-sap-widgets").on("click",function(a){a.preventDefault(),c(this).toggleClass("active"),c(this).find("i").toggleClass("fa-pencil-square-o fa-times"),c(".sap-widget-container").toggleClass("toggled")}),void c("#input-tags-select").selectize({plugins:["remove_button"],delimiter:",",persist:!1,create:function(a){return{value:a,text:a}}}))},a.get_elements=function(){return e.$form=c(".sap-container-wrapper"),0!==e.$form.length&&(e.$open_uploder_button=c("#featured-img-placeholder"),e.$image=e.$form.find(".featured-img-preview"),e.$close_button=e.$form.find(".sap-preview-close"),e.$hidden_field=e.$form.find("#featured-img-placeholder-id"),!0)},a.start_uploader=function(){navigator.userAgent.indexOf("IEMobile")!==-1;d=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:e.$open_uploder_button[0],dragdrop:!1,container:document.getElementById("sap-widget-container"),max_file_size:"10mb",multi_selection:!0,url:ajaxurl,multipart:!0,multipart_params:{action:"buddyboss_sap_post_photo",cookie:encodeURIComponent(document.cookie),"sap-editor-nonce":c("input[name='sap_editor_nonce']").val()},filters:[{title:"Upload file",extensions:"jpg,jpeg,gif,png,bmp",prevent_duplicates:!0}],init:{Init:function(){},FilesAdded:function(a,b){return a.files.length>state.uploader_max_files||b.length>state.uploader_max_files?(d.splice(f,d.files.length),alert("Exceeded maximum number of files"),!1):(e.$open_uploder_button.hide(),e.$image.attr("src",sap_loading_string.config.loading_image).show(),e.$close_button.hide(),void a.start())},UploadProgress:function(a,b){},FileUploaded:function(a,b,d){var f=c.parseJSON(d.response);console.log(f),e.$hidden_field.val(f.attachment_id),e.$image.attr("src",f.url).show(),e.$close_button.data("fileid",b.id).show()},Error:function(a,b){alert("Error uploading photo")}}}),d.init(),d.refresh()},a.clear_upload=function(){e.$hidden_field.val(""),e.$image.attr("src",sap_loading_string.config.loading_image).hide(),e.$close_button.hide(),e.$open_uploder_button.show(),c.each(d.files,function(a,b){d.removeFile(b)}),a.start_uploader()},a.sanitize_content=function(a){var b="<div class='bboss_e_sanitize_wrapper'>"+a.value+"</div>";return $content=c(b),$content.wrap("<div class='bboss_e_sanitize_wrapper'></div>"),$content.find(".me_oembed_orig_url").each(function(a,b){$org_url_div=c(b);var d=$org_url_div.data("url");d.indexOf("www.facebook.com")==-1?(d=d.replace(/(\r\n|\n|\r)/gm,""),$embed_wrapper=$org_url_div.next(".medium-insert-embeds-wpoembeds"),$embed_wrapper.html("\n"+d+"\n"),$org_url_div.remove()):($embed_wrapper=$org_url_div.next(".medium-insert-embeds-wpoembeds"),$embed_wrapper.attr("class","medium-insert-embeds-wpoembeds medium-insert-embeds"))}),a.value=$content.html(),a}}(BBOSS_SAP.editor,window,window.jQuery),jQuery(document).ready(function(a){BBOSS_SAP.editor.init(),window.sap_autosave_secout=null;var b=a("#sap_is_index_page").val();void 0!==b&&"no"!=b||sap_draft_screen_auto_save()}),jq(document).on("ready",function(){jq("#sort-posts-form #sort").on("change",function(){jq(this).parents("form").submit()}),jq(document).on("click",".sap-load-more-posts",function(a){a.preventDefault();var b=jq(this),c=b.attr("data-sort"),d=b.attr("data-max"),e=b.attr("data-paged");jq.ajax({type:"POST",url:ajaxurl,data:{action:"sap_posts_pagination",sort:c,paged:e},beforeSend:function(){b.addClass("loading")},success:function(a){return b.removeClass("loading"),b.parent().before(a),"null"===a?void b.remove():(d===e&&b.remove(),e++,void b.attr("data-paged",e))}})})});