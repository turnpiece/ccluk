var WPForms=window.WPForms||{};WPForms.Admin=WPForms.Admin||{},WPForms.Admin.Builder=WPForms.Admin.Builder||{},WPForms.Admin.Builder.Providers=WPForms.Admin.Builder.Providers||function(e,r,t){"use strict";var n={cache:{},config:{templates:["wpforms-providers-builder-content-connection-fields","wpforms-providers-builder-content-connection-conditionals"]}},i={provider:"",providerHolder:{},form:t("#wpforms-builder-form"),spinner:'<i class="fa fa-circle-o-notch fa-spin wpforms-button-icon" />',ajax:{_mergeData:function(e){var r={id:t("#wpforms-builder-form").data("id"),nonce:wpforms_builder.nonce,action:"wpforms_builder_provider_ajax_"+i.provider};return t.extend(r,e),r},request:function(e,r){void 0!==e&&i.setProvider(e),r.data=i.ajax._mergeData(r.data||{});var o={url:wpforms_builder.ajax_url,type:"post",dataType:"json",beforeSend:function(){i.getProviderHolder().find(".wpforms-builder-provider-title-spinner").show()}};return t.extend(o,r),t.ajax(o).fail(function(e,r){console.error("provider:",i.provider),console.error(e),console.error(r)}).always(function(){i.getProviderHolder().find(".wpforms-builder-provider-title-spinner").hide()})}},cache:{provider:"",as:function(e){return this.provider=e,this},get:function(e){return void 0===n.cache[this.provider]||!n.cache[this.provider]instanceof Map?null:n.cache[this.provider].get(e)},getById:function(e,r){return void 0===this.get(e)[r]?null:this.get(e)[r]},set:function(e,r){return(void 0===n.cache[this.provider]||!n.cache[this.provider]instanceof Map)&&(n.cache[this.provider]=new Map),n.cache[this.provider].set(e,r)},addTo:function(e,r,o){(void 0===n.cache[this.provider]||!n.cache[this.provider]instanceof Map)&&(n.cache[this.provider]=new Map,this.set(e,{}));var i=this.get(e);return i[r]=o,this.set(e,i)},delete:function(e){return void 0===n.cache[this.provider]||!n.cache[this.provider]instanceof Map?null:n.cache[this.provider].delete(e)},deleteFrom:function(e,r){if(void 0===n.cache[this.provider]||!n.cache[this.provider]instanceof Map)return null;var o=this.get(e);return delete o[r],this.set(e,o)},clear:function(){void 0===n.cache[this.provider]||!n.cache[this.provider]instanceof Map||n.cache[this.provider].clear()}},init:function(){t(e).ready(i.ready)},ready:function(){i.providerHolder=t(".wpforms-builder-provider"),i.Templates=WPForms.Admin.Builder.Templates,i.Templates.add(n.config.templates),i.bindActions(),i.ui.bindActions(),t("#wpforms-panel-providers").trigger("WPForms.Admin.Builder.Providers.ready")},bindActions:function(){t(e).on("wpformsSaved",function(){var e=t("#wpforms-panel-providers").find(".wpforms-builder-provider-connection");if(e.length){var i=!1;e.each(function(){var r=!1;if(t(this).find("input.wpforms-required, select.wpforms-required, textarea.wpforms-required").each(function(){var e=t(this).val();_.isEmpty(e)?(t(this).addClass("wpforms-error"),r=!0):t(this).removeClass("wpforms-error")}),r&&!i){var e=t(this).closest(".wpforms-builder-provider").find(".wpforms-builder-provider-title").clone();e.find("button").remove();var o=wpforms_builder.provider_required_flds;t.alert({title:wpforms_builder.heads_up,content:o.replace("{provider}","<strong>"+e.text().trim()+"</strong>"),icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}}),i=!0}})}}),t("#wpforms-panel-providers").on("connectionRendered",function(){!0===wpf.initialSave&&(wpf.savedState=wpf.getFormState("#wpforms-builder-form"))})},ui:{bindActions:function(){i.providerHolder.on("click",".js-wpforms-builder-provider-account-add",function(e){e.preventDefault(),i.ui.account.setProvider(t(this).data("provider")),i.ui.account.add()}).on("click",".js-wpforms-builder-provider-connection-add",function(e){e.preventDefault(),i.ui.connectionAdd()}).on("click",".js-wpforms-builder-provider-connection-delete",function(e){e.preventDefault(),i.ui.connectionDelete(t(this).closest(".wpforms-builder-provider-connection"))}),i.providerHolder.on("click",".js-wpforms-builder-provider-connection-fields-add",function(e){e.preventDefault();var r=t(this).parents(".wpforms-builder-provider-connection-fields-table"),o=r.find("tr").last().clone(!0),i=parseInt(/\[(\d+)\]/g.exec(o.find("input").attr("name"))[1],10)+1;o.find("input").attr("name",o.find("input").attr("name").replace(/\[fields_meta\]\[(\d+)\]/g,"[fields_meta]["+i+"]")).val(""),o.find("select").attr("name",o.find("select").attr("name").replace(/\[fields_meta\]\[(\d+)\]/g,"[fields_meta]["+i+"]")).val(""),o.find(".js-wpforms-builder-provider-connection-fields-delete").removeClass("hidden"),r.find("tbody").append(o.get(0))}).on("click",".js-wpforms-builder-provider-connection-fields-delete",function(e){e.preventDefault(),t(this).parents(".wpforms-builder-provider-connection-fields-table tr").remove()}),t("#wpforms-panel-providers").on("connectionRendered",function(e,r,o){wpf.initTooltips()})},connectionAdd:function(){t.confirm({title:!1,content:wpforms_builder_providers.prompt_connection.replace(/%type%/g,"connection")+'<input autofocus="" type="text" id="wpforms-builder-provider-connection-name" placeholder="'+wpforms_builder_providers.prompt_placeholder+'"><p class="error">'+wpforms_builder_providers.error_name+"</p>",backgroundDismiss:!1,closeIcon:!1,icon:"fa fa-info-circle",type:"blue",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){var e=this.$content.find("#wpforms-builder-provider-connection-name").val(),r=this.$content.find(".error");if(""===e)return r.show(),!1;i.providerHolder.trigger("connectionCreate",[e])}},cancel:{text:wpforms_builder.cancel}}})},connectionDelete:function(e){t.confirm({title:!1,content:wpforms_builder_providers.confirm_connection,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){i.providerHolder.trigger("connectionDelete",[e]),e.fadeOut("fast",function(){t(this).remove(),i.providerHolder.trigger("connectionDeleted",[e])})}},cancel:{text:wpforms_builder.cancel}}})},account:{provider:"",submitHandlers:[],setProvider:function(e){this.provider=e},add:function(){var o=this;t.confirm({title:!1,smoothContent:!0,content:function(){var r=this;return i.ajax.request(o.provider,{data:{task:"account_template_get"}}).done(function(e){e.success&&(e.data.title.length&&r.setTitle(e.data.title),e.data.content.length&&r.setContent(e.data.content),e.data.type.length&&r.setType(e.data.type),i.providerHolder.trigger("accountAddModal.content.done",[r,o.provider,e]))}).fail(function(){i.providerHolder.trigger("accountAddModal.content.fail",[r,o.provider])}).always(function(){i.providerHolder.trigger("accountAddModal.content.always",[r,o.provider])})},contentLoaded:function(e,r,o){this.buttons.add.enable(),this.buttons.cancel.enable(),i.providerHolder.trigger("accountAddModal.contentLoaded",[this])},onOpenBefore:function(){this.buttons.add.disable(),this.buttons.cancel.disable(),this.$body.addClass("wpforms-providers-account-add-modal"),i.providerHolder.trigger("accountAddModal.onOpenBefore",[this])},onClose:function(){!0===i.ui.account.isConfigured()&&i.ui.connectionAdd()},icon:"fa fa-info-circle",type:"blue",buttons:{add:{text:wpforms_builder.provider_add_new_acc_btn,btnClass:"btn-confirm",keys:["enter"],action:function(){if(i.providerHolder.trigger("accountAddModal.buttons.add.action.before",[this]),!_.isEmpty(o.provider)&&void 0!==o.submitHandlers[o.provider])return o.submitHandlers[o.provider](this)}},cancel:{text:wpforms_builder.cancel}}})},registerAddHandler:function(e,r){"string"==typeof e&&"function"==typeof r&&(this.submitHandlers[e]=r)},isConfigured:function(){return i.providerHolder.find(".js-wpforms-builder-provider-account-add").hasClass("hidden")}}},setProvider:function(e){i.provider=e},getProviderHolder:function(){return t("#"+i.provider+"-provider")}};return i}(document,window,jQuery),WPForms.Admin.Builder.Providers.init();