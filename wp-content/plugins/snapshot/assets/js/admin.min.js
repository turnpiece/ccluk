window.SS_UTILS={},window.SS_PAGES={},function(a){a(document).ready(function(){function b(){a("#wps-snapshot-key").addClass("show"),a("body").addClass("wps-popup-modal-active")}function c(){a("#wps-snapshot-key-notice").addClass("show"),a("#wps-snapshot-key-notice .wps-automatic-try.error").removeClass("hidden"),a("#view-snapshot-key-automatic").addClass("hidden")}a(".wdpun-notice").detach().appendTo("section#header"),a.each(document.body.className.replace(/-/g,"_").split(/\s+/),function(b,c){a.isFunction(SS_PAGES[c])&&SS_PAGES[c]()}),a("#view-snapshot-key,#view-snapshot-key-2").on("click",function(c){c.preventDefault();var d=a(this),e=d.html(),f=(window.snapshot_messages||{}).working||e;if(d.is(".has-key"))return b();d.html(f),a.post(ajaxurl,{action:"snapshot-full_backup-exchange_key"}).done(function(a){return(a||{}).success?window.location.reload():b()}).error(b).always(function(){d.html(e)})}),a("#view-snapshot-key-automatic,#wps-error-connecting a").on("click",function(b){b.preventDefault(),a("#wps-snapshot-key-notice").removeClass("show"),a("#view-snapshot-key-automatic").removeClass("hidden");var d=a("#view-snapshot-key-automatic"),e=d.html(),f=(window.snapshot_messages||{}).working||e;d.html(f),a.post(ajaxurl,{action:"snapshot-full_backup-exchange_key"}).done(function(a){return(a||{}).success?window.location.reload():c()}).error(c).always(function(){d.html(e)})}),a("#secret-key-notice form").on("submit",function(b){b.preventDefault();var c=a(this).serializeArray();c.push({name:"action",value:"snapshot_save_key"}),c.push({name:"security",value:a(this).data("security")}),a("#get-snapshot-key-notice").addClass("disabled-get-key"),a("#secret-key-notice").addClass("wps-processing"),a("#wps-snapshot-key-notice .wps-automatic-try.error").addClass("hidden"),a(".disabled-get-key").on("click",function(a){a.preventDefault()}),jQuery.ajax({type:"POST",url:ajaxurl,data:c,dataType:"json",success:function(b){a("#secret-key-notice").removeClass("wps-processing"),b.success?window.location.reload(!1):(a(".wps-get-snapshot-key").addClass("hidden"),a('#secret-key-notice form button[type="submit"]').html("Try Again"),a("#wps-snapshot-key-notice .wps-manual-try.error").removeClass("hidden"))},error:function(){a("#secret-key-notice").removeClass("wps-processing"),a(".wps-get-snapshot-key").addClass("hidden"),a('#secret-key-notice form button[type="submit"]').html("Try Again"),a("#wps-snapshot-key-notice .wps-manual-try.error").removeClass("hidden")}})}),a(".wps-icon.i-close").on("click",function(b){a("#wps-snapshot-key").removeClass("show"),a("body").removeClass("wps-popup-modal-active")}),a(".wps-popup-close").on("click",function(b){a(this).parents(".wps-popup-modal").removeClass("show"),a("body").removeClass("wps-popup-modal-active")}),a(".wps-popup-modal").hasClass("show")?a("body").addClass("wps-popup-modal-active"):a("body").removeClass("wps-popup-modal-active"),a("select.bulk-action-selector-top").on("change",function(b){var c=a(this).val();a("select.bulk-action-selector-top").not(this).val(c).trigger("wpmu:change")});var d=a("#wps-snapshot-key");a("#wps-snapshot-key form").on("submit",function(b){b.preventDefault();var c=a(this).serializeArray();c.push({name:"action",value:"snapshot_save_key"}),c.push({name:"security",value:a(this).data("security")}),a(".wps-snapshot-popin-content",d).addClass("hidden"),a(".wps-snapshot-popin-content-step-2",d).removeClass("hidden"),a(".wps-snapshot-key.wpmud-box-gray",d).addClass("wps-processing"),jQuery.ajax({type:"POST",url:ajaxurl,data:c,dataType:"json",success:function(b){if(a(".wps-snapshot-key.wpmud-box-gray",d).removeClass("wps-processing"),a(".wps-snapshot-popin-content",d).addClass("hidden"),b.success){a(".wps-snapshot-popin-content-step-4",d).removeClass("hidden");var c=location.href;c+=-1===c.indexOf("?")?"?":"&",location.href=c+a.param({message:"success-snapshot-key"})}else a(".wps-snapshot-popin-content-step-3",d).removeClass("hidden")},error:function(){a(".wps-snapshot-key.wpmud-box-gray",d).removeClass("wps-processing"),a(".wps-snapshot-popin-content",d).addClass("hidden"),a(".wps-snapshot-popin-content-step-3",d).removeClass("hidden")}})}),a("#disable-notif").on("click",function(b){b.preventDefault();var c={security:a(this).data("security"),action:"snapshot_disable_notif_ajax"};jQuery.ajax({type:"POST",url:ajaxurl,data:c,dataType:"json",success:function(){a(".try-managed-backups-box").remove()}})}),a(".wps-message").on("click",function(b){a(this).fadeOut()}).delay(2e3).fadeOut(),a(".button-disabled").on("click",function(a){a.preventDefault()}),a(".wpmud-box-tab-title.can-toggle").on("click",function(b){b.preventDefault(),a(this).parents(".wpmud-box-tab").toggleClass("open")})})}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_dashboard=function(){var b=function(){var b=a("#ss-show-apikey").html(),c=function(){a("#reset-api-key").click(function(){var b=a(this).data("url");a("<a>").attr("href",b).attr("target","_blank")[0].click()})};SS_UTILS.openModal(snapshot_messages.snapshot_key,b,c)};a("#view-snapshot-key,#view-snapshot-key-2").click(b)},window.SS_PAGES.toplevel_page_snapshot_pro_dashboard=function(){var b=window.Sfb||{value:function(a){return(window._snp_vars||{})[a]},l10n:function(a){return(this.value("l10n")||{})[a]||a}};b.ListDashBackups={loadBackups:function(){var b={security:jQuery("#snapshot-ajax-nonce").val()};a(".wps-hosting-backup-list-loader").show(),a(".wps-hosting-backup-no-backup").hide(),a(".wps-backup-list-ajax-error").hide(),a(".wps-hosting-backup-list").hide();var c=ajaxurl+"?action=snapshot-hosting_backup-dashboard-list";snapshot_ajax_lhb_xhr=jQuery.ajax({type:"POST",url:c,data:b,cache:!1,dataType:"json",error:function(b,c,d){a(".wps-hosting-backup-list-loader").hide(),a(".wps-backup-list-ajax-error").show()},success:function(b){if(b.success&&void 0!==b.data.backups){a(".wps-hosting-backup-list-loader").hide();var c=void 0!==b.data.backups&&null!==b.data.backups?b.data.backups.length:0;a(".wps-hosting-backups-count").text(c).show(),0!==c?(a(".wps-hosting-backup-list").show(),a(".wps-hosting-backup-no-backup").hide(),a("#wps-hosting-backups-disclaimer").show(),a(".wps-count.wps-hosting-backups-count").show(),a("#my-hosting-backups-table > tbody:last-child").html(""),a.each(b.data.backups,function(b,c){c.tooltip?iconMarkup='<div class="wps-tooltip sui-tooltip sui-tooltip-constrained sui-tooltip-top-right" data-tooltip="'+c.tooltip+'"><i class="wps-icon '+c.icon+'"></i></div>':iconMarkup='<i class="wps-icon '+c.icon+'"></i>',a("#my-hosting-backups-table > tbody:last-child").append('<tr><td class="msc-name">'+iconMarkup+c.link+'</td><td class="msc-type" data-title="Type:">'+c.type+'</td><td class="msc-context" data-title="Frequency:">'+c.context+"</td>")})):(a(".wps-hosting-backup-list").hide(),a(".wps-hosting-backup-no-backup").show(),a("#wps-hosting-backups-disclaimer").hide(),a(".wps-count.wps-hosting-backups-count").hide())}else void 0===b.data.not_wpmudev_hosting&&(a(".wps-hosting-backup-list-loader").hide(),a(".wps-backup-list-ajax-error").show())}})}},a(document).on("click",".wps-reload-backup-listing",function(){b.ListDashBackups.loadBackups()}),a(function(){b.ListDashBackups.loadBackups()})}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_destinations=function(){if(a("#wps-destination-delete").on("click",function(b){b.preventDefault(),a("#wps-destination-warning").addClass("show")}),a(".copy-to-clipboard").on("click",function(b){b.preventDefault();var c=a(this).data("clipboard-target"),d=a(c);d.length&&(d.select(),document.execCommand("copy"))}),a(".show-instructions").on("click",function(b){a(a(this).data("instructions")).toggle()}),"dropbox"===jQuery('[name="snapshot-destination[type]"]').val()){$form=a("#wps-destinations-wizard form"),$dropboxToken=a('[name="snapshot-destination[tokens][access][authorization_token]"]'),$submitButton=a('#wps-destinations-wizard form [type="submit"]'),$forceAuthorize=a('[name="snapshot-destination[force-authorize]"]'),$dropboxToken.on("input",function(b){a(this).val().length>0?($submitButton.val($submitButton.data("authenticate-text")),$form.attr("target",""),$forceAuthorize.val("off")):($submitButton.val($submitButton.data("get-code-text")),$form.attr("target","_blank"),$forceAuthorize.val("on"))}).trigger("input"),"on"===$forceAuthorize.val()&&$forceAuthorize.is(":checkbox")&&$forceAuthorize.is(":checked")||"on"===$forceAuthorize.val()&&$forceAuthorize.is(":hidden")?($submitButton.val($submitButton.data("get-code-text")),$form.attr("target","_blank"),$forceAuthorize.val("on")):1===$dropboxToken.length&&""!==$dropboxToken.val()?($submitButton.val($submitButton.data("authenticate-text")),$form.attr("target",""),$forceAuthorize.val("off")):($submitButton.val($submitButton.data("save-text")),$form.attr("target",""),$forceAuthorize.val("off"));var b=!1;a('[name="snapshot-destination[tokens][access][authorization_token]"]',"#wps-destination-token-checkbox").on("input",function(a){b=!0}),$forceAuthorize.filter(":checkbox").on("change",function(c){a(this).is(":checked")?($submitButton.val($submitButton.data("get-code-text")),$form.attr("target","_blank"),$forceAuthorize.val("on"),a("#wps-destination-token-checkbox").css("display","block")):(b?$submitButton.val($submitButton.data("authenticate-text")):$submitButton.val($submitButton.data("save-text")),$form.attr("target",""),$forceAuthorize.val("off"),a("#wps-destination-token-checkbox").css("display","none"))}).trigger("change")}}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_hosting_backups=function(){var b=window.Sfb||{value:function(a){return(window._snp_vars||{})[a]},l10n:function(a){return(this.value("l10n")||{})[a]||a}},c={element_selector:"",get_elements:function(){return a(this.element_selector)},initialize_listeners:function(){var b=this;return this.get_elements().each(function(){b.initialize_listener(a(this))}),!0},initialize_listener:function(a){}};b.Util={stop_prop:function(a){return a&&a.preventDefault&&a.preventDefault(),a&&a.stopPropagation&&a.stopPropagation(),!1}},b.DealWithCurrentBackup={show_current_backup_state:function(){var c={security:jQuery("#snapshot-ajax-nonce").val()},d=ajaxurl+"?action=snapshot-deal_with_current_backup";snapshot_ajax_lhb_xhr=jQuery.ajax({type:"POST",url:d,data:c,cache:!1,dataType:"json",error:function(a,b,c){},success:function(c){void 0!==c.is_done?(a(".wps-new-hosting-backup-state").show(),!0===c.is_done?b.StartHostingBackups.Viewer.show_backup_result("completed",!1):!0===c.error?b.StartHostingBackups.Viewer.show_backup_result("errored",!1):(b.StartHostingBackups.Viewer.show_backup_result("in progress",!1),a('.wps-page-hosting-backups input[name="start_hosting_backup"]').addClass("button-disabled"),a('.wps-page-hosting-backups input[name="start_hosting_backup"]').attr("disabled","disabled"),a('.wps-page-hosting-backups input[name="start_first_hosting_backup"]').addClass("button-disabled"),a('.wps-page-hosting-backups input[name="start_first_hosting_backup"]').attr("disabled","disabled"))):a(".wps-new-hosting-backup-state").hide()}})}},b.ListHostingBackups={snapshot_list_hosted_backups:function(){var c={security:jQuery("#snapshot-ajax-nonce").val()};a(".wps-hosting-backup-list-loader").show(),a(".wps-my-hosting-backups").hide(),a(".wps-no-hosting-managed-backups").hide(),a(".wps-backup-list-ajax-error").hide();var d=ajaxurl+"?action=snapshot-hosting_backup-list";snapshot_ajax_lhb_xhr=jQuery.ajax({type:"POST",url:d,data:c,cache:!1,dataType:"json",error:function(b,c,d){a(".wps-backup-list-ajax-error").show(),a(".wps-hosting-backup-list-loader").hide()},success:function(c){if(c.success&&void 0!==c.data.backups){if(a(".wps-hosting-backup-list-loader").hide(),a(".wps-my-hosting-backups").show(),c.data.backups&&0!==c.data.backups.length){var d=!0;lastBackup=c.data.backups[0];var e=a(".wps-hosting-backups-last-backup");e.find(".wps-hosting-spinner").remove(),e.html(lastBackup.date+"<span>"+lastBackup.time+"</span>"),a(".wps-page-hosting-backups .wps-my-hosting-backups").show(),a('.wps-page-hosting-backups input[name="start_hosting_backup"]').show(),a(".wps-page-hosting-backups .wps-available-backups-header").show(),a(".wps-page-hosting-backups .wps-no-available-backups-header").hide(),a(".wps-page-hosting-backups .wps-no-hosting-managed-backups").hide(),a("#wps-hosting-backups-disclaimer").show(),a("#my-hosting-backups-table > tbody:last-child").html(""),a.each(c.data.backups,function(b,c){var d;d=c.tooltip?'<div class="wps-tooltip sui-tooltip sui-tooltip-constrained sui-tooltip-top-right" data-tooltip="'+c.tooltip+'"><i class="wps-icon '+c.icon+'"></i></div>':'<i class="wps-icon '+c.icon+'"></i>',a("#my-hosting-backups-table > tbody:last-child").append('<tr><td class="msc-name">'+d+c.link+'</td><td class="msc-type" data-title="Type:">'+c.type+'</td><td class="msc-context" data-title="Frequency:">'+c.context+'</td><td class="msc-info">'+c.menu+"</td></tr>")})}else{var d=!1;lastBackup="Never";var e=a(".wps-hosting-backups-last-backup");e.find(".wps-hosting-spinner").remove(),e.html(lastBackup),a(".wps-page-hosting-backups .wps-my-hosting-backups").hide(),a('.wps-page-hosting-backups input[name="start_hosting_backup"]').hide(),a(".wps-page-hosting-backups .wps-available-backups-header").hide(),a(".wps-page-hosting-backups .wps-no-available-backups-header").show(),a(".wps-page-hosting-backups .wps-no-hosting-managed-backups").css("display","flex"),a("#wps-hosting-backups-disclaimer").hide()}void 0!==c.data.is_done&&(!0===c.data.is_done?(b.StartHostingBackups.Viewer.show_backup_result("completed",d),b.StartHostingBackups.Viewer.toggle_new_backup("enable")):!0===c.data.error?(b.StartHostingBackups.Viewer.show_backup_result("errored",d),b.StartHostingBackups.Viewer.toggle_new_backup("enable")):(b.StartHostingBackups.Viewer.show_backup_result("in progress",d),b.StartHostingBackups.Viewer.toggle_new_backup("disable"),b.StartHostingBackups.Viewer.handle_view(null,d))),b.ListHostingBackups.initialize_ajax_actions(),b.RestoreBackup.run(),b.ExportBackup.run()}else a(".wps-backup-list-ajax-error").show(),a(".wps-hosting-backup-list-loader").hide()}})},initialize_ajax_actions:function(){a(".wps-menu-dots").each(function(){var b=a(this),c=b.parent(".wps-menu"),d=a(".wps-menu").not(c);b.on("click",function(){d.removeClass("open"),c[c.hasClass("open")?"removeClass":"addClass"]("open")})})}},b.StartHostingBackups={Viewer:a.extend({},c,{element_selector:'.wps-page-hosting-backups input[name="start_hosting_backup"]',ttl:3e4,show_backup_result:function(b,c){a(".wps-new-hosting-backup-state").show(),"in progress"===b?(window.hidden_result_notification=!1,void 0!==window.hidden_progress_loader&&window.hidden_progress_loader||(a(".wps-new-hosting-backup-state .wps-progress-loader").show(),a(".wps-my-hosting-backups .wps-progress-loader-row").css("display","table-row"),a(".wps-new-hosting-backup-state .wps-progress-success").hide(),a(".wps-new-hosting-backup-state .wps-progress-error").hide(),c&&(a(".wps-page-hosting-backups .wps-my-hosting-backups").show(),a(".wps-page-hosting-backups .wps-no-hosting-managed-backups").hide()))):"completed"===b?(window.hidden_progress_loader=!1,void 0!==window.hidden_result_notification&&window.hidden_result_notification||(a("#my-hosting-backups-table").removeClass("in-progress-row"),a(".wps-new-hosting-backup-state .wps-progress-loader").hide(),a(".wps-my-hosting-backups .wps-progress-loader-row").hide(),a(".wps-new-hosting-backup-state .wps-progress-success").show(),a(".wps-new-hosting-backup-state .wps-progress-error").hide(),c&&(a(".wps-page-hosting-backups .wps-my-hosting-backups").show(),a(".wps-page-hosting-backups .wps-no-hosting-managed-backups").hide()))):"errored"===b&&(window.hidden_progress_loader=!1,void 0!==window.hidden_result_notification&&window.hidden_result_notification||(a("#my-hosting-backups-table").removeClass("in-progress-row"),a(".wps-new-hosting-backup-state .wps-progress-loader").hide(),a(".wps-my-hosting-backups .wps-progress-loader-row").hide(),a(".wps-new-hosting-backup-state .wps-progress-success").hide(),a(".wps-new-hosting-backup-state .wps-progress-error").show(),c&&(a(".wps-page-hosting-backups .wps-my-hosting-backups").show(),a(".wps-page-hosting-backups .wps-no-hosting-managed-backups").hide())))},toggle_new_backup:function(b){"disable"===b?(a('.wps-page-hosting-backups input[name="start_hosting_backup"]').addClass("button-disabled"),a('.wps-page-hosting-backups input[name="start_hosting_backup"]').attr("disabled","disabled")):(a('.wps-page-hosting-backups input[name="start_hosting_backup"]').removeClass("button-disabled"),a('.wps-page-hosting-backups input[name="start_hosting_backup"]').removeAttr("disabled"))},handle_view:function(c,d){ttl=b.StartHostingBackups.Viewer.ttl?parseInt(b.StartHostingBackups.Viewer.ttl,10):3e4,b.StartHostingBackups.Viewer.show_backup_result("in progress",d),b.StartHostingBackups.Viewer.toggle_new_backup("disable"),a("#my-hosting-backups-table").addClass("in-progress-row");var e=ajaxurl+"?action=snapshot-hosting_backup-create";return function a(c){var f={older_backup:c,security:jQuery("#snapshot-ajax-nonce").val()};snapshot_ajax_nhb_xhr=jQuery.ajax({type:"POST",url:e,data:f,cache:!1,dataType:"json",error:function(a,c,e){b.StartHostingBackups.Viewer.show_backup_result("errored",d),b.StartHostingBackups.Viewer.toggle_new_backup("enable")},success:function(c){!1===c.is_done?void 0!==c.error&&!0===c.error?(b.StartHostingBackups.Viewer.show_backup_result("errored",d),b.StartHostingBackups.Viewer.toggle_new_backup("enable")):(b.StartHostingBackups.Viewer.show_backup_result("in progress",d),void 0===c.older_backup||!0!==c.older_backup?(setTimeout(function(){a(!1)},ttl),b.StartHostingBackups.Viewer.toggle_new_backup("disable")):(setTimeout(function(){a(!0)},ttl),b.StartHostingBackups.Viewer.toggle_new_backup("disable"))):(b.StartHostingBackups.Viewer.show_backup_result("completed",d),b.StartHostingBackups.Viewer.toggle_new_backup("enable"),b.ListHostingBackups.snapshot_list_hosted_backups())}})}(),b.Util.stop_prop(c)},initialize_listener:function(a){a.off("click.snapshot").on("click.snapshot",this.handle_view)},run:function(){return this.initialize_listeners(),!0}}),run:function(){return b.StartHostingBackups.Viewer.run(),!0}},b.RestoreBackup={Viewer:a.extend({},c,{element_selector:"a.snapshot-hosting-backup-restore",ttl:3e4,show_restore_result:function(b,c){a(".wps-new-hosting-backup-state").show(),"in progress"===b?(a(".wps-my-hosting-backups .wps-restore-progress-loader-row").css("display","table-row"),a(".wps-new-hosting-backup-state .wps-restore-progress-success").hide(),a(".wps-new-hosting-backup-state .wps-restore-progress-error").hide()):"completed"===b?(a("#my-hosting-backups-table").removeClass("in-progress-row"),a(".wps-my-hosting-backups .wps-restore-progress-loader-row").hide(),a(".wps-new-hosting-backup-state .wps-restore-progress-success").show(),a(".wps-new-hosting-backup-state .wps-restore-progress-error").hide()):"errored"===b&&(a("#my-hosting-backups-table").removeClass("in-progress-row"),a(".wps-my-hosting-backups .wps-restore-progress-loader-row").hide(),a(".wps-new-hosting-backup-state .wps-restore-progress-success").hide(),a(".wps-new-hosting-backup-state .wps-restore-progress-error").show(),a(".wps-restore-progress-error .snapshot-hosting-backup-restore").attr("data-backup-id",c))},handle_view:function(c){$menu=a(c.target).parents(".wps-menu"),$menu.removeClass("open"),b.RestoreBackup.Viewer.show_restore_result("in progress"),ttl=b.RestoreBackup.Viewer.ttl?parseInt(b.RestoreBackup.Viewer.ttl,10):3e4;var d=ajaxurl+"?action=snapshot-hosting_backup-restore";return b.RestoreBackup.Viewer.perform_auth_check(),window.clear_ongoing_backup_performed=!1,a("#my-hosting-backups-table").addClass("in-progress-row"),b.StartHostingBackups.Viewer.toggle_new_backup("disable"),function(){backup_id=a(c.target).data("backup-id");var e={backup_id:backup_id,security:jQuery("#snapshot-ajax-nonce").val()};snapshot_ajax_rhb_xhr=jQuery.ajax({type:"POST",url:d,data:e,cache:!1,dataType:"json",error:function(c,d,e){a(".wps-restore-progress-error a.snapshot-hosting-backup-restore").attr("data-backup-id",backup_id),b.RestoreBackup.Viewer.show_restore_result("errored",backup_id),b.StartHostingBackups.Viewer.toggle_new_backup("enable")},success:function(c){void 0!==c.action_id&&""!==c.action_id&&c.action_id?b.RestoreBackup.Viewer.handle_ongoing_restore(c.action_id,c.api_key,c.site_id):(a(".wps-restore-progress-error a.snapshot-hosting-backup-restore").attr("data-backup-id",backup_id),b.RestoreBackup.Viewer.show_restore_result("errored",backup_id),b.StartHostingBackups.Viewer.toggle_new_backup("enable"))}})}(),b.Util.stop_prop(c)},handle_ongoing_restore:function(a,c,d){ttl=3e4;var e="https://premium.wpmudev.org/api/hosting/v1/"+d+"/actions/"+a;snapshot_ajax_rs_xhr=jQuery.ajax({type:"GET",url:e,headers:{Authorization:c},cache:!1,timeout:6e4,dataType:"json",error:function(e,f,g){setTimeout(function(){b.RestoreBackup.Viewer.handle_ongoing_restore(a,c,d)},ttl)},success:function(e){void 0!==e.status&&"completed"===e.status?(b.StartHostingBackups.Viewer.toggle_new_backup("enable"),b.RestoreBackup.Viewer.show_restore_result("completed"),b.RestoreBackup.Viewer.perform_auth_check(),window.clear_ongoing_backup_performed||b.RestoreBackup.Viewer.clear_ongoing_backup()):void 0!==e.status&&"errored"===e.status?(b.StartHostingBackups.Viewer.toggle_new_backup("enable"),b.RestoreBackup.Viewer.show_restore_result("errored",backup_id)):(b.RestoreBackup.Viewer.show_restore_result("in progress"),setTimeout(function(){b.RestoreBackup.Viewer.handle_ongoing_restore(a,c,d)},ttl))}})},clear_ongoing_backup:function(b){var c=ajaxurl+"?action=snapshot-ongoing_backup_after_restore";security=b||a("#snapshot-ajax-nonce").val();var d={security:security};snapshot_ajax_rs_xhr=jQuery.ajax({type:"POST",url:c,cache:!1,data:d,timeout:6e4,dataType:"json",error:function(a,b,c){},success:function(a){window.clear_ongoing_backup_performed=!0}})},perform_auth_check:function(){return a(document).on("heartbeat-tick.wp-auth-check",b.RestoreBackup.Viewer.check_auth_context),!!((wp||{}).heartbeat||{}).connectNow&&(wp.heartbeat.connectNow(),!0)},clear_auth_context_check_and_continue:function(){a(document).off("heartbeat-tick.wp-auth-check",b.RestoreBackup.Viewer.check_auth_context),url=window.location.pathname+"?page=snapshot_pro_hosting_backups",a.get(url,function(c){var d=a(c).find("#snapshot-ajax-nonce").val();b.RestoreBackup.Viewer.clear_ongoing_backup(d)})},check_auth_context:function(c,d){if(!("wp-auth-check"in d))return!1;if(d["wp-auth-check"])return!0;var e=(window,a("#wp-auth-check-wrap")),f=e.find("iframe");e.length&&!e.is(".snapshot-bound")&&f.length&&(e.addClass("snapshot-bound"),f.on("load",function(){a(this).contents().find("body").is(".interim-login-success")&&setTimeout(function(){b.RestoreBackup.Viewer.clear_auth_context_check_and_continue(),e.removeClass("snapshot-bound")})}))},initialize_listener:function(a){a.off("click.snapshot").on("click.snapshot",this.handle_view)},run:function(){return this.initialize_listeners(),!0}}),run:function(){return b.RestoreBackup.Viewer.run(),!0}},b.ExportBackup={Viewer:a.extend({},c,{element_selector:"a.snapshot-hosting-backup-export",handle_view:function(c){var d=ajaxurl+"?action=snapshot-hosting_backup-export";return clearTimeout(window.fadeOutTimeout),function(e){void 0!==e&&""!==e||(e=a(c.target).data("backup-id"));var f={backup_id:e,security:jQuery("#snapshot-ajax-nonce").val()};snapshot_ajax_ehb_xhr=jQuery.ajax({type:"POST",url:d,data:f,cache:!1,dataType:"json",error:function(a,c,d){b.ExportBackup.Viewer.show_export_notifications(!1,reply_data.data)},success:function(a){if(void 0!==a.success&&a.success){var c=!0;b.ExportBackup.Viewer.show_export_notifications(c,a.data)}if(void 0!==a.success&&!a.success){var c=!1;b.ExportBackup.Viewer.show_export_notifications(c,a.data)}}})}(),b.Util.stop_prop(c)},show_export_notifications:function(c,d){if(c)var e="wps-success-message",f="wps-error-message";else var e="wps-error-message",f="wps-success-message";a(".snapshot-three.wps-message."+f).hide(),a(".snapshot-three.wps-message."+e+" p").html('<i class="wps-icon i-close wps-popup-close wps-dismiss-notice"></i>'+d),a(".snapshot-three.wps-message."+e).addClass("wps-hosting-backups-message").css({display:"block",opacity:"1",visibility:"visible"}).attr("title",""),a(".wps-hosting-backups-message .wps-dismiss-notice").css({color:"#888888",border:"none"}),window.fadeOutTimeout=setTimeout(function(){a(".snapshot-three.wps-message."+e).fadeOut()},1e4),a(".wps-hosting-backups-message i.wps-dismiss-notice").on("click",function(b){b.preventDefault(),a(".wps-hosting-backups-message").fadeOut()}),c||a(".wps-error-message-wrap a.snapshot-hosting-backup-export").on("click",function(c){c.preventDefault(),a(".snapshot-three.wps-message.wps-error-message").hide(),b.ExportBackup.Viewer.handle_view(c)})},initialize_listener:function(a){a.off("click.snapshot").on("click.snapshot",this.handle_view)},run:function(){return this.initialize_listeners(),!0}}),run:function(){return b.ExportBackup.Viewer.run(),!0}},window.Sfb=b,a(function(){window.hidden_progress_loader=!1,window.hidden_result_notification=!1,window.clear_ongoing_backup_performed=!1,b.StartHostingBackups.run(),b.ListHostingBackups.snapshot_list_hosted_backups(),b.DealWithCurrentBackup.show_current_backup_state(),a('.wps-no-hosting-managed-backups input[name="start_first_hosting_backup"]').on("click",function(a){a.preventDefault(),b.StartHostingBackups.Viewer.handle_view(a,!0)}),a(".wps-new-hosting-backup-state a.retry-hosting-backup-creation").on("click",function(a){a.preventDefault(),b.StartHostingBackups.Viewer.handle_view(a,!1)}),a('input[name="wps-managed-backups-menu"]').on("change",function(b){var c=a(this).filter(":checked").val();a('select[name="wps-managed-backups-menu-mobile"]').val(c).change(),a(".wps-managed-backups-pages > .wpmud-box").addClass("hidden").filter("."+c).removeClass("hidden")}),a('select[name="wps-managed-backups-menu-mobile"]').on("change",function(b){var c=a(this).val();a('input[name="wps-managed-backups-menu"][value="'+c+'"]').attr("checked","checked"),a(".wps-managed-backups-pages > .wpmud-box").addClass("hidden").filter("."+c).removeClass("hidden")}),a("div.wps-new-hosting-backup-state i.wps-dismiss-notice").on("click",function(b){b.preventDefault();var c=a(this).parents();c.eq(1).is(".wps-progress-loader")?void 0!==window.hidden_progress_loader&&window.hidden_progress_loader||(window.hidden_progress_loader=!0):(c.eq(1).is(".wps-progress-success")||c.eq(1).is(".wps-progress-error"))&&(void 0!==window.hidden_result_notification&&window.hidden_result_notification||(window.hidden_result_notification=!0)),c.eq(1).hide()}),a(".wps-managed-backup-notice .wps-dismiss-notice").on("click",function(b){b.preventDefault(),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"dismiss_managed_backups_notice"}}),a(this).parent().hide().remove()}),a("a.wps-reload-backup-listing").on("click",function(a){a.preventDefault(),b.ListHostingBackups.snapshot_list_hosted_backups()}),a(".wps-message").off("click")})}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_managed_backups_create=function(){function b(){return null!==c&&c.abort(),d=!0,jQuery("#wps-build-error").addClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"),jQuery("#wps-build-success").addClass("hidden"),jQuery("#wps-build-abort-upload").removeClass("hidden"),window.Sfb.ManualBackup.current=window.Sfb.ManualBackup.total=0,window.Sfb.ManualBackup.update_progress(),!1}a(document).ready(function(){"#wps-backups-settings-schedule"===window.location.hash&&a('[for="wps-managed-backups-configs"]').click()}),a("#wps-managed-backups-configure").on("click",function(b){b.preventDefault(),a("[for='wps-managed-backups-menu-config']").click(),a("html,body").animate({scrollTop:a(".wps-managed-backups-configs").offset().top},"slow")}),jQuery("input[name='frequency']").change(function(){"once"===jQuery("input[name='frequency']:checked").val()?(jQuery("div#snapshot-schedule-options-container").slideUp("fast"),jQuery("#snapshot-backup-action").attr("name","snapshot-disable-cron")):(jQuery("div#snapshot-schedule-options-container").slideDown("slow"),jQuery("#snapshot-backup-action").attr("name","snapshot-schedule"))}).change(),jQuery("#checkbox-run-backup-now").on("change",function(b){var c=a(this).is(":checked"),d=a("#managed-backup-update button[type=submit]");d.text(d.attr("data-"+(c?"run-backup":"update-settings")+"-text"))}),jQuery("form#managed-backup-update").off().on("submit",function(b){var c=a(this),d=jQuery("#frequency-once",c).is(":checked"),e=jQuery("#checkbox-run-backup-now",c).is(":checked");(d||!d&&e)&&(b.preventDefault(),jQuery("#managed-backup-update").addClass("hidden"),jQuery("#container.wps-page-builder").removeClass("hidden"),d?window.Sfb.ManualBackup.handle_start_click():jQuery.ajax({type:"POST",url:c.attr("src"),data:c.serialize(),success:function(){window.Sfb.ManualBackup.handle_start_click()}}))});var c=null,d=!1;jQuery("#wps-build-progress-cancel").off("click.wps-build-progress-cancel").on("click.wps-build-progress-cancel",function(a){a.preventDefault(),b()});var e=window.Sfb||{value:function(a){return(window._snp_vars||{})[a]},l10n:function(a){return(this.value("l10n")||{})[a]||a}},f={element_selector:"",get_elements:function(){return a(this.element_selector)},initialize_listeners:function(){var b=this;return this.get_elements().each(function(){b.initialize_listener(a(this))}),!0},initialize_listener:function(a){}};e.Util={stop_prop:function(a){return a&&a.preventDefault&&a.preventDefault(),a&&a.stopPropagation&&a.stopPropagation(),!1}},e.Notice=a.extend({},f,{element_selector:".wp-admin .notice .button.snapshot",target_selector:".backup-list td.name .location.local:first",subtarget_selector:"td",handle_target_scroll:function(b){var c=a(this).attr("data-target")||e.Notice.target_selector,d=a(this).is("[data-subtarget]")?a(this).attr("data-target"):e.Notice.subtarget_selector,f=a(c),g=0;return d&&(f=f.closest(d)),f.length&&(g=(f.offset()||{}).top-a("#wpadminbar").height())>0&&(a(window).scrollTop(g),f.fadeOut(300).fadeIn(300)),e.Util.stop_prop(b)},initialize_listener:function(a){a.off("click.snapshot").on("click.snapshot",this.handle_target_scroll)},run:function(){return this.initialize_listeners(),!0}});var g=function(){};e.ManualBackup=a.extend({},f,{element_selector:'.wp-admin .snapshot-wrap button[name="backup"]',abort_upload:function(b){return a.post(ajaxurl,{security:b,action:"snapshot-full_backup-abort-upload"},function(a){e.ManualBackup.error_handler({responseText:(a||{}).error})})},abort_processing:function(b){return a.post(ajaxurl,{action:"snapshot-full_backup-abort-processing",security:b},g,"json")},current:0,total:0,$target:!1,skip_estimate:!1,error_handler:function(b){var c=a.trim((b||{}).responseText)||"&lt;empty response&gt;";return jQuery("#wps-build-error .wps-auth-message p").html("<p>"+c+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"),jQuery("#wps-build-abort-upload").addClass("hidden"),!!e.ManualBackup.initialize_listeners()},update_progress:function(){if(this.total>0&&this.current&&this.current<=this.total){var a=this.current>1?this.current-1:1,b=100*a/this.total;b>=100&&(b=100),jQuery(".wps-total-status .wps-loading-number").html(parseInt(b,10)+"%"),jQuery(".wps-total-status .wps-loading-bar span").width(parseInt(b,10)+"%")}return!0},start_backup:function(){return a.post(ajaxurl,{action:"snapshot-full_backup-start"},g,"json").fail(e.ManualBackup.error_handler)},finish_backup:function(b){this.update_progress();var c=a.post(ajaxurl,{action:"snapshot-full_backup-finish",security:b},g,"json");return c.then(function(a){
if(!a.status)return d?e.ManualBackup.abort_upload(b):e.ManualBackup.finish_backup(b);jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"),jQuery("#wps-build-success").removeClass("hidden"),jQuery("#wps-build-abort-upload").addClass("hidden")}).fail(e.ManualBackup.error_handler),c},process_files:function(b){this.update_progress(),a.post(ajaxurl,{action:"snapshot-full_backup-process",security:b},g,"json").then(function(a){e.ManualBackup.current++;var c=!1;try{c=!!a.done}catch(a){return error_handler()}d?e.ManualBackup.abort_processing(b).then(function(){e.ManualBackup.error_handler({responseText:"Backup aborted"})}):c?e.ManualBackup.finish_backup(b):e.ManualBackup.process_files(b)}).fail(e.ManualBackup.error_handler)},estimate_backup:function(){var b=a.post(ajaxurl,{action:"snapshot-full_backup-estimate"},g,"json");return b.then(function(a){var b=parseInt((a||{}).total||"0",10);b&&(e.ManualBackup.total=b)}).fail(e.ManualBackup.error_handler),b},handle_start_click:function(a){jQuery("#managed-backup-update").addClass("hidden"),jQuery("#container.wps-page-builder").removeClass("hidden");var b=jQuery("form#managed-backup-update :hidden#snapshot-ajax-nonce");return e.ManualBackup.current=1,e.ManualBackup.start_backup().then(function(a){return(a||{}).id?e.ManualBackup.skip_estimate?e.ManualBackup.process_files(b.val()):e.ManualBackup.estimate_backup().then(function(){return e.ManualBackup.process_files(b.val())}):e.ManualBackup.error_handler(a)}),e.Util.stop_prop(a)},initialize_listener:function(a){return a.off("click.snapshot",this.handle_start_click).on("click.snapshot",this.handle_start_click),!0},run:function(){if(!this.get_elements().length)return!1;var b=a("#snapshot-full_backups-panel header"),c='<div id="snapshot-ajax-out"><div class="out"></div></div>';return a("#snapshot-ajax-out").remove(),b.length?b.after(c):this.get_elements().first().after(c),this.$target=a("#snapshot-ajax-out").find(".out"),this.initialize_listeners(),!0}}),e.Logs={Toggler:a.extend({},f,{element_selector:"#log-enable",handle_enable:function(){var b=e.Logs.Toggler.get_elements(),c=b.is(":checked"),d=b.attr("data-default");c?a(".snapshot-settings.log-levels").show():a(".snapshot-settings.log-levels").hide().find('input[type="radio"]').attr("checked",!1).end().find('input[type="radio"][value="'+d+'"]').attr("checked",!0)},initialize_listener:function(a){a.off("click.snapshot").on("click.snapshot",this.handle_enable)},run:function(){return this.initialize_listeners(),this.handle_enable(),!0}}),Viewer:a.extend({},f,{element_selector:'a[href="#view-log-file"]',ttl:12e4,handle_view:function(b){ttl=e.Logs.Viewer.ttl?parseInt(e.Logs.Viewer.ttl,10):0,a("#wps-snapshot-log div.wps-log-box").replaceWith(a('<pre class="wps-log-box">')),a("#wps-snapshot-log .wps-log-box").html("Loading...<br />"),a("#wps-snapshot-log").addClass("show");var d=ajaxurl+"?action=snapshot-full_backup-get_log",f=setInterval(function(){a("#wps-snapshot-log").length&&a("#wps-snapshot-log").is(".show")?c=jQuery.ajax({type:"POST",url:d,cache:!1,dataType:"html",error:function(a,b,c){clearInterval(f)},success:function(b){a(b).length>0?(a("#wps-snapshot-log .wps-log-box").html(a(b).text()),a("#wps-snapshot-log .wps-log-box").scrollTop(a("#wps-snapshot-log .wps-log-box")[0].scrollHeight)):a("#wps-snapshot-log .wps-log-box").html(b)}}):clearInterval(f)}(),ttl);return e.Util.stop_prop(b)},initialize_listener:function(a){a.off("click.snapshot").on("click.snapshot",this.handle_view)},run:function(){return this.initialize_listeners(),!0}}),run:function(){return e.Logs.Toggler.run(),e.Logs.Viewer.run(),!0}},window.Sfb=e,a(function(){e.Notice.run(),e.Logs.run(),e.ManualBackup.run()})}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_managed_backups_restore=function(){function b(){return null!==h&&h.fail(),i=!0,a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(snapshot_messages.restore_backup_aborted),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),!1}function c(b,c,g){var h="100"===g?"done":"",i="",j=g;if(g+="%",a("#container.wps-page-builder tr .wps-log-progress .wps-spinner").addClass("hidden"),a("#container.wps-page-builder tr .wps-log-progress .snapshot-button-abort").addClass("hidden"),"error"===b)a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Restoration failed"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden");else if("done"===b)e("100%"),d("finish",h,g,snapshot_messages.finalized_restoration),d("tableset","done","100%",snapshot_messages.database_restored),a("#wps-build-progress .progress-action-title").html(a("#wps-log-process-finish .wps-log-process").html()+"..."),a("#wps-build-error").addClass("hidden"),a("#wps-build-progress-container").addClass("hidden"),a("#wps-build-success").removeClass("hidden");else if("fetch"===b)"done"===h?(e("10%"),d("init",h,g,snapshot_messages.determined),a("#wps-build-progress .progress-action-title").html(snapshot_messages.restoring_files+"..."),f("fileset","tableset")):(e("0%"),f("init",""),f("","fileset"),a("#wps-build-progress .progress-action-title").html(a("#wps-log-process-init .wps-log-process").html()+"...")),d("init",h,g,"");else if("process"===b){if("fileset"===c||"tableset"===c){if("tableset"===c){i=snapshot_messages.restoring_database;var k=parseInt(j)<50?"50%":"70%";e(k),f("","finish"),d("fileset","done","100%",snapshot_messages.files_restored),d("init","done","100%",snapshot_messages.determined)}else{var l=parseInt(j)<50?"10%":"30%";i=snapshot_messages.restoring_files,e(l),d("init","done","100%",snapshot_messages.determined),f("","tableset")}f(c,""),a("#wps-build-progress .progress-action-title").html(i+"..."),d(c,h,g,i)}}else"finalizing"===b&&(e("90%"),f("finish",""),d("tableset","done","100%",snapshot_messages.database_restored),a("#wps-build-progress .progress-action-title").html(snapshot_messages.finalizing_restoration+"..."),d(c,h,g,snapshot_messages.finalizing_restoration))}function d(b,c,d,e){a("#container.wps-page-builder #wps-log-process-"+b+" .wps-loading-status .wps-loading-number").html(d).addClass(c),a("#container.wps-page-builder #wps-log-process-"+b+" .wps-loading-status .wps-loading-bar span").width(d),a("#container.wps-page-builder #wps-log-process-"+b+" .wps-loading-status .wps-loading-bar .wps-loader").addClass(c),e&&a("#container.wps-page-builder #wps-log-process-"+b+" .wps-log-process").html(e)}function e(b){a("#wps-build-progress .wps-total-status .wps-loading-number").html(b),a("#wps-build-progress .wps-total-status .wps-loading-bar span").width(b)}function f(b,c){a("#container.wps-page-builder #wps-log-process-"+b+" .wps-spinner").removeClass("hidden"),a("#container.wps-page-builder #wps-log-process-"+c+" .snapshot-button-abort").removeClass("hidden")}function g(a){var b=snapshot_messages.fail_restore_start;switch(a){case"init":b+=' <span style="text-transform: lowercase;">'+snapshot_messages.determining+"</span>. ";break;case"fileset":b+=' <span style="text-transform: lowercase;">'+snapshot_messages.restoring_files+"</span>. ";break;case"tableset":b+=' <span style="text-transform: lowercase;">'+snapshot_messages.restoring_database+"</span>. ";break;case"finish":b+=' <span style="text-transform: lowercase;">'+snapshot_messages.finalizing_restoration+"</span>. ";break;default:b=snapshot_messages.restore_fail+". "}return b+=snapshot_messages.fail_restore_end}var h=null,i=!1;a("#wps-show-full-log").on("click",function(b){b.preventDefault();var c=a(this);a("#wps-log").is(".hidden")?(c.text(c.attr("data-wps-hide-title")),a("#wps-log").removeClass("hidden"),a(this).html(snapshot_messages.hide_full_log)):(c.text(c.attr("data-wps-show-title")),a("#wps-log").addClass("hidden"),a(this).html(snapshot_messages.show_full_log))}),a("#wps-build-error-back").on("click",function(b){b.preventDefault(),a("#wps-build-error").addClass("hidden"),a("#wps-build-progress").removeClass("hidden"),a("#managed-backup-restore").removeClass("hidden"),a("#container.wps-page-builder").addClass("hidden"),a(".wpmud-box-title .wps-title-result").addClass("hidden"),a(".wpmud-box-title .wps-title-progress").removeClass("hidden")}),a("#wps-cancel").off().on("click",function(a){a.preventDefault(),b()}),a(".snapshot-button-abort").on("click",function(a){a.preventDefault(),b()}),a("form#managed-backup-restore").off().submit(function(b){b.preventDefault(),a("#managed-backup-restore").addClass("hidden"),a("#snapshot-ajax-warning").html(""),a("#snapshot-ajax-warning").hide(),a("#container.wps-page-builder").removeClass("hidden");var d=new a.Deferred,e=a("form#managed-backup-restore :hidden.archive"),f=a("form#managed-backup-restore :text.location"),j=a("form#managed-backup-restore .request-filesystem-credentials-form input"),k=a("form#managed-backup-restore :hidden#snapshot-ajax-nonce"),l={},m=function(b){return window._snapshot_last_request=b,a(document).on("heartbeat-tick.wp-auth-check",o),!!((wp||{}).heartbeat||{}).connectNow&&(wp.heartbeat.connectNow(),!0)},n=function(){a(document).off("heartbeat-tick.wp-auth-check",o);var b=window._snapshot_last_request,c=window.location.pathname+"?page=snapshot_pro_managed_backups";a.get(c,function(c){var d=a(c).find("#snapshot-ajax-nonce"),e=d.val();k.val(e),b.security=e,callback(b)})},o=function(b,c){if(!("wp-auth-check"in c))return!1;if(c["wp-auth-check"])return!0;var d=(window,a("#wp-auth-check-wrap")),e=d.find("iframe");d.length&&!d.is(".snapshot-bound")&&e.length&&(d.addClass("snapshot-bound"),e.on("load",function(){a(this).contents().find("body").is(".interim-login-success")&&setTimeout(function(){n(),d.removeClass("snapshot-bound")})}))},p=function(b){c("fetch","init","0"),b.action="snapshot-full_backup-restore",initial_request=b,initial_request.initial_callback=1,h=a.post(ajaxurl,initial_request,function(){},"json").then(function(e){if(!0===i)return d.resolve(),!1;if(!e||(e||{}).error||!1===e.status&&"fetching"!==e.task){if(e){var f=g(e.action);a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(f)}else a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Error restoring backup");return a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),d.resolve(),!1}if("fetching"!==e.task)return d.resolve(),a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Restoration failed"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),!1;if(!0===e.errors){var f=g("init");a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(f),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),d.resolve()}else!0===e.status?(c("fetch","init","100"),b.initial_callback=0,callback(b)):(b.initial_callback=1,p(b))}).fail(function(){return d.resolve(),a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Restoration failed"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),!1})};return callback=function(b){b.action="snapshot-full_backup-restore",h=a.post(ajaxurl,b,function(){},"json").then(function(e){if(!0===i)return d.resolve(),!1;if(!e||(e||{}).error||!1===e.status){if(e){var f=g(e.action);a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(f)}else a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Error restoring backup");return a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),d.resolve(),!1}if("clearing"!==e.task){var h="fetching"===e.task?"fetch":"process",j="fetch"===h?"100":e.progress;c(h,e.action,j),callback(b)}else c("finalizing","finish","50"),a("#wps-cancel").addClass("hidden"),setTimeout(function(){c(e.status?"done":"error","finish","100")},1e4),d.resolve()}).fail(function(){if(!m(b))return d.resolve(),a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Restoration failed"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),!1})},l={idx:void 0,archive:e.val(),restore:f.val(),credentials:{},security:k.val()},j.each(function(){var b=a(this);b.is(":radio")||b.is(":checkbox")?b.is(":checked")&&(l.credentials[b.attr("name")]=b.val()):(b.is(":text")||b.is(":password")||b.is(":hidden"))&&(l.credentials[b.attr("name")]=b.val())}),a(window).on("beforeunload.snapshot-restore",function(a){var b="You still have a restore active, navigating off this page will stop it mid-process";return a.returnValue=b,b}),p(l),d.promise().always(function(){a(window).off("beforeunload.snapshot-restore")})})}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_managed_backups_upload=function(){var b={aborted:!1,el:{form:a("form#managed-backup-upload"),progress_box:a("#managed-backup-upload-progress"),abort_state:a("#wps-upload-abort"),success_state:a("#wps-upload-success"),error_state:a("#wps-upload-error"),progress_state:a("#wps-upload-progress"),retry_upload_button:a('[href="#retry-upload-after-error"]'),cancel_upload_button:a("#wps-cancel")},set_state:function(a){b.el.progress_state.addClass("hidden"),b.el.success_state.addClass("hidden"),b.el.error_state.addClass("hidden"),b.el.abort_state.addClass("hidden"),a.removeClass("hidden")},show_error_message:function(a){b.set_state(b.el.error_state),b.el.error_state.find("p").html(a)},show_success_message:function(){b.set_state(b.el.success_state)},update_progress:function(c,d){if(a.isNumeric(c)&&a.isNumeric(d)&&!(parseInt(d)<1)){b.set_state(b.el.progress_state);var e=b.el.progress_box,f=Math.ceil(c/d*100);f>100&&(f=100),e.find(".wps-loading-number").html(f+"%"),e.find(".wps-loader span").css("width",f+"%")}},get_request_data:function(c){var d=b.el.form.serializeArray(),e={action:c};return a.each(d,function(a,b){e[b.name]=b.value}),e},upload_file:function(){var c=b.get_request_data("snapshot-full_backup-upload");return a.post(ajaxurl,c,function(a){var c=a||{};if(c.error)return void b.show_error_message(c.error);c.is_done?(b.update_progress(1,1),setTimeout(function(){b.show_success_message()},1e3)):b.aborted?b.abort_upload():(b.update_progress(c.completed,c.total),b.upload_file())},"json").fail(function(a,c,d){b.show_error_message(d)})},abort_upload:function(){return a.post(ajaxurl,b.get_request_data("snapshot-full_backup-abort-upload"),function(a){b.show_error_message(a.error)})},initiate_abort:function(){b.set_state(b.el.abort_state),b.aborted=!0},retry_upload:function(){b.aborted=!1,b.update_progress(0,1),b.upload_file()},handle_form:function(a){a.preventDefault(),b.el.form.addClass("hidden"),b.el.progress_box.removeClass("hidden"),b.upload_file()},init:function(){b.el.form.off("submit.snapshot").on("submit.snapshot",b.handle_form),b.el.retry_upload_button.off("click.snapshot").on("click.snapshot",function(a){a.preventDefault(),window.location.reload()}),b.el.cancel_upload_button.off("click.snapshot").on("click.snapshot",function(a){a.preventDefault(),b.initiate_abort()})}};b.init()}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_managed_backups=function(){function b(){var b=a('#managed-backup-update select[name="frequency"]');if(!b.length)return!1;a(".select-container.offset").hide().find("select").attr("disabled",!0),a(".select-container #frequency").attr("disabled",!1),a(".select-container #schedule_time").attr("disabled",!1);var c=a(".select-container.offset."+b.val());c.length&&c.show().find("select").attr("disabled",!1),"weekly"===b.val()?(a(".offset-monthly-label").hide(),a(".offset-weekly-label").show()):"monthly"===b.val()?(a(".offset-weekly-label").hide(),a(".offset-monthly-label").show()):(a(".offset-monthly-label").hide(),a(".offset-weekly-label").hide())}a(".wps-menu-dots").each(function(){var b=a(this),c=b.parent(".wps-menu"),d=a(".wps-menu").not(c);b.on("click",function(){d.removeClass("open"),c[c.hasClass("open")?"removeClass":"addClass"]("open")})}),a("#snapshot-edit-listing table tr").each(function(b,c){a(c).find(".msc-info").css("z-index",1e3-b)}),a('input[name="wps-managed-backups-menu"]').on("change",function(b){var c=a(this).filter(":checked").val();a('select[name="wps-managed-backups-menu-mobile"]').val(c).change(),a(".wps-managed-backups-pages > .wpmud-box").addClass("hidden").filter("."+c).removeClass("hidden")}),a('select[name="wps-managed-backups-menu-mobile"]').on("change",function(b){var c=a(this).val();a('input[name="wps-managed-backups-menu"][value="'+c+'"]').attr("checked","checked"),a(".wps-managed-backups-pages > .wpmud-box").addClass("hidden").filter("."+c).removeClass("hidden")}),a("#wps-managed-backups-configure").on("click",function(b){b.preventDefault(),a("[for='wps-managed-backups-menu-config']").click(),a("html,body").animate({scrollTop:a(".wps-managed-backups-configs").offset().top},"slow")}),a("input[name='managed-backup-exclusions']").change(function(){"global"===jQuery("input[name='managed-backup-exclusions']:checked").val()?a("div#managed-backup-exclusions-config").slideUp():a("div#managed-backup-exclusions-config").slideDown()}).change(),a("#my-backup-all").on("change",function(){a('input[id^="my-backup"]').attr("checked",a(this).is(":checked"))}),a("#wps-managed-backups-onoff").on("change",function(b){var c=a(this).parents("form"),d=a(this).is(":checked"),e=a("#wps-managed-backups-onoff-hidden",c);d?(e.attr("name","snapshot-enable-cron"),a(".wps-managed-backups-schedule-form").removeClass("hidden")):(e.attr("name","snapshot-disable-cron"),a(".wps-managed-backups-schedule-form").addClass("hidden"));var f=c.serialize();jQuery.ajax({type:"POST",url:c.attr("src"),data:f,success:function(){}})}),a(window).on("load",b),a(document).on("change",'select[name="frequency"]',b),window.SS_PAGES.snapshot_page_snapshot_pro_managed_backups_create(),window.SS_PAGES.snapshot_page_snapshot_pro_managed_backups_upload()}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_settings=function(){a('[name="files"]').on("change",function(){a('[name="files"]:checked').is("#common_files")?a("#wps-settings-localdir .wpmud-box-gray").removeClass("hidden"):a("#wps-settings-localdir .wpmud-box-gray").addClass("hidden")}).change(),a("#wps-settings--error .wps-input--parent > .wps-input--checkbox > input").each(function(){a(this).on("change",function(){var b=a(this),c=b.parents(".wps-input--parent").next(".wpmud-box-gray");b.is(":checked")?c.removeClass("hidden"):c.addClass("hidden")}).change()})}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_snapshot_create=function(){function b(a,b){return"remote"===a?"enable"===b?jQuery("input#snapshot-remote-archive-count").attr("disabled",!1):jQuery("input#snapshot-remote-archive-count").attr("disabled","disabled"):"local"===a&&("enable"===b?jQuery("input#snapshot-archive-count").attr("disabled",!1):jQuery("input#snapshot-archive-count").attr("disabled","disabled")),"all"===a&&("1"!==jQuery("input[name='snapshot-clean-local']:checked").val()&&jQuery("input#snapshot-archive-count").attr("disabled","disabled"),"1"!==jQuery("input[name='snapshot-clean-remote']:checked").val()&&jQuery("input#snapshot-remote-archive-count").attr("disabled","disabled")),!1}function c(){return null!==d&&d.abort(),e=!0,jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(snapshot_messages.snapshot_aborted),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"),!1}b("all",!1),jQuery("input[name='frequency']").change(function(){"once"===jQuery("input[name='frequency']:checked").val()?(jQuery("#snapshot-immediate").attr("disabled",!1).attr("checked",!0),jQuery("#snapshot-interval").attr("disabled",!0),jQuery("div#snapshot-schedule-options-container").slideUp("fast"),jQuery("#snapshot-add-update-submit").text(jQuery("#snapshot-add-update-submit").data("title-save-and-run"))):(jQuery("#snapshot-immediate").attr("disabled",!0).attr("checked",!1),jQuery("#snapshot-interval").attr("disabled",!1),jQuery("div#snapshot-schedule-options-container").slideDown("slow"),jQuery("#checkbox-run-backup-now").is(":checked")||jQuery("#snapshot-add-update-submit").text(jQuery("#snapshot-add-update-submit").data("title-save-only")))}).change(),jQuery("input[name='snapshot-clean-remote']").change(function(){"1"===jQuery("input[name='snapshot-clean-remote']:checked").val()?(jQuery("div#remote-count").slideDown("fast"),b("remote","enable")):(jQuery("div#remote-count").slideUp("fast"),b("remote","disable"))}).change(),jQuery("input[name='snapshot-clean-local']").change(function(){"1"===jQuery("input[name='snapshot-clean-local']:checked").val()?(jQuery("div#local-count").slideDown("fast"),b("local","enable")):(jQuery("div#local-count").slideUp("fast"),b("local","disable"))}).change(),jQuery("#checkbox-run-backup-now").change(function(){a(this).is(":checked")&&"once"!==jQuery("input[name='frequency']:checked").val()?jQuery("#snapshot-add-update-submit").text(jQuery("#snapshot-add-update-submit").data("title-save-and-run")):"once"!==jQuery("input[name='frequency']:checked").val()&&jQuery("#snapshot-add-update-submit").text(jQuery("#snapshot-add-update-submit").data("title-save-only"))}).change(),jQuery("[name=snapshot-destination]").change(function(){var a=jQuery("[name=snapshot-destination]:checked").attr("data-destination-type");"dropbox"==a?jQuery("input#snapshot-destination-sync-mirror").attr("disabled",!1):(jQuery("input#snapshot-destination-sync-mirror").attr("disabled","disabled"),jQuery("input#snapshot-destination-sync-archive").attr("checked","checked")),"local"==a?jQuery("div#clean-remote-count").slideUp("fast"):jQuery("div#clean-remote-count").slideDown("fast")}).change();var d=null,e=!1;jQuery("#wps-show-full-log").on("click",function(a){a.preventDefault();var b=jQuery(this),c=jQuery("#wps-log");c.is(".hidden")?(b.text(b.attr("data-wps-hide-title")),c.removeClass("hidden")):(b.text(b.attr("data-wps-show-title")),c.addClass("hidden"))}),jQuery("#wps-build-error-again").on("click",function(a){a.preventDefault(),jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").addClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").removeClass("hidden"),jQuery("form#snapshot-add-update").submit()}),jQuery("#wps-build-error-back").on("click",function(a){a.preventDefault(),jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").removeClass("hidden"),jQuery("#snapshot-add-update").removeClass("hidden"),jQuery("#container.wps-page-builder").addClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").addClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").removeClass("hidden")}),jQuery("#wps-cancel").off().on("click",function(b){b.preventDefault(),c(),a("html,body").animate({scrollTop:a("#container.wps-page-builder").offset().top},"slow")}),a("#container.wps-page-builder").off("click.abort").on("click.abort","a.snapshot-button-abort",function(b){b.preventDefault(),c(),a("html,body").animate({scrollTop:a("#container.wps-page-builder").offset().top},"slow")}),jQuery(".snapshot-tables-option, .snapshot-files-option").on("change",function(){1===jQuery("#snapshot-tables-option-none:checked").length&&1===jQuery("#snapshot-files-option-none:checked").length?(jQuery("#snapshot-ajax-error").html("<p>"+snapshot_messages.no_files_tables+"</p>").show(),jQuery("#snapshot-add-update-submit").addClass("button-disabled")):(jQuery("#snapshot-ajax-error").html("").hide(),jQuery("#snapshot-add-update-submit").removeClass("button-disabled"))}),jQuery("form#snapshot-add-update").off().submit(function(b){function c(b,p){var C,D;if("init"===b)C=b,D={action:"snapshot_backup_ajax","snapshot-proc-action":b,"snapshot-action":n,"snapshot-item":m,"snapshot-data-item":o,"snapshot-blog-id":w,"snapshot-name":x,"snapshot-notes":y,"snapshot-files-option":g,"snapshot-files-sections":f,"snapshot-files-ignore":i,"snapshot-tables-option":l,"snapshot-tables-array":k,"snapshot-interval":q,"snapshot-archive-count":r,"snapshot-remote-archive-count":s,"snapshot-destination":t,"snapshot-store-local":u,"snapshot-destination-directory":v,"snapshot-destination-sync":h,"snapshot-clean-remote":z,"snapshot-clean-local":A,"snapshot-transitioned-purging":B,security:j},jQuery("[id^=snapshot-interval-offset]").each(function(){D[this.name]=this.value}),d=jQuery.ajax({type:"POST",url:ajaxurl,data:D,dataType:"json",error:function(a,b,c){!1!==a.responseText&&""!==a.responseText?(jQuery("#wps-build-error .wps-auth-message p").html(a.responseText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error .wps-auth-message p").html("<p>AAA "+snapshot_messages.snapshot_failed+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))},success:function(d){if(void 0===d||void 0===d.errorStatus)jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>BBB "+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden");else if(!1!==d.errorStatus)void 0===d.errorText?(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>CCC "+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#snapshot-ajax-error").append(d.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else if(!1===d.errorStatus||!1===e){var f=b;jQuery("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-bar span").width("100%"),jQuery("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-number").html("100%"),jQuery("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),jQuery("#container.wps-page-builder #wps-log-process-init .wps-loading-status").removeClass("wps-spinner"),jQuery("#container.wps-page-builder #wps-log-process-init .snapshot-button-abort").addClass("hidden"),G++;var g=Math.min(100,Math.round(100*G/F));if(jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(g+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(g+"%"),!1===e){if(void 0!==d.files_data&&(I=d.files_data,F+=I.length),void 0!==d.table_data){H=d.table_data;var h=JSON.stringify(d.table_data);if(h)for(var i in k)if(k.hasOwnProperty(i)){var f=k[i];-1===h.indexOf(f)&&a("#snapshot-item-table-"+f).remove()}c("table",0)}void 0!==d.MEMORY&&(void 0!==d.MEMORY.memory_limit&&jQuery("#snapshot-memory-info").find(".log-memory.number").html(d.MEMORY.memory_limit),void 0!==d.MEMORY.memory_usage_current&&jQuery("#snapshot-memory-info .log-usage.number").html(d.MEMORY.memory_usage_current),void 0!==d.MEMORY.memory_usage_peak&&jQuery("#snapshot-memory-info .log-peak.number").html(d.MEMORY.memory_usage_peak))}}}});else if("table"===b){var E=parseInt(p),J=E+1;if(J>H.length)return void(I.length>0?c("file",0):c("finish",0));var K=H[E];C=K.table_name,jQuery("#container.wps-page-builder #snapshot-item-table-"+C+" a.snapshot-button-abort").removeClass("hidden"),jQuery("#container.wps-page-builder #snapshot-item-table-"+C+" .wps-spinner").removeClass("hidden"),D={action:"snapshot_backup_ajax","snapshot-proc-action":b,"snapshot-action":n,"snapshot-item":m,"snapshot-data-item":o,"snapshot-blog-id":w,"snapshot-table-data-idx":E,security:j},d=jQuery.ajax({type:"POST",url:ajaxurl,data:D,dataType:"json",error:function(a,b,c){!1!==a.responseText&&""!==a.responseText?(jQuery("#wps-build-error .wps-auth-message p").html(a.responseText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))},success:function(a){if(void 0===a||void 0===a.errorStatus)jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden");else if(!1!==a.errorStatus)void 0===a.errorText?(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#snapshot-ajax-error").append(a.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else if(!1===a.errorStatus||!1===e){if(void 0===a.table_data)void 0!==a.errorText?(jQuery("#snapshot-ajax-error").append(a.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else{K=a.table_data;var b,d=parseInt(K.rows_start)+parseInt(K.rows_end);if(d>0?(b=Math.ceil(d/K.rows_total*100),jQuery("#container.wps-page-builder #snapshot-item-table-"+K.table_name+" .wps-loading-status .wps-loading-bar span").width(b+"%"),jQuery("#container.wps-page-builder #snapshot-item-table-"+K.table_name+" .wps-loading-status .wps-loading-number").html(b+"%")):(b=100,jQuery("#container.wps-page-builder #snapshot-item-table-"+K.table_name+" .wps-loading-status .wps-loading-bar span").width(b+"%"),
jQuery("#container.wps-page-builder #snapshot-item-table-"+K.table_name+" .wps-loading-status .wps-loading-number").html(b+"%")),100===b){jQuery("#container.wps-page-builder #snapshot-item-table-"+K.table_name+" .snapshot-button-abort").hide(),jQuery("#container.wps-page-builder #snapshot-item-table-"+K.table_name+" .wps-spinner").hide(),jQuery("#container.wps-page-builder #snapshot-item-table-"+K.table_name+" .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),G++;var f=Math.min(100,Math.ceil(100*G/F));jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(f+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(f+"%")}void 0!==a.MEMORY&&(void 0!==a.MEMORY.memory_limit&&jQuery("#snapshot-memory-info span.memory-limit").html(a.MEMORY.memory_limit),void 0!==a.MEMORY.memory_usage_current&&jQuery("#snapshot-memory-info span.memory-usage").html(a.MEMORY.memory_usage_current),void 0!==a.MEMORY.memory_usage_peak&&jQuery("#snapshot-memory-info span.memory-peak").html(a.MEMORY.memory_usage_peak))}c("table",J)}}})}else if("file"===b){var L=parseInt(p),M=L+1;if(C=b,M>I.length)return c("finish",0),!1;var N=I[L];jQuery("#snapshot-item-"+C+" .snapshot-filename").html(": "+N),jQuery("#container.wps-page-builder #snapshot-item-"+C+" a.snapshot-button-abort").removeClass("hidden"),jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-spinner").removeClass("hidden"),D={action:"snapshot_backup_ajax","snapshot-proc-action":b,"snapshot-action":n,"snapshot-item":m,"snapshot-data-item":o,"snapshot-blog-id":w,"snapshot-file-data-key":N,security:j},d=jQuery.ajax({type:"POST",url:ajaxurl,data:D,dataType:"json",error:function(a,b,c){!1!==a.responseText&&""!==a.responseText?(jQuery("#wps-build-error .wps-auth-message p").html(a.responseText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))},success:function(a){if(void 0===a||void 0===a.errorStatus)jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden");else if(!1!==a.errorStatus)void 0===a.errorText?(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#snapshot-ajax-error").append(a.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else if(!1===a.errorStatus||!1===e){var b;if(M<I.length)b=Math.ceil(M/I.length*100),jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-loading-status .wps-loading-bar span").width(b+"%"),jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-loading-status .wps-loading-number").html(b+"%");else{G++;var d=Math.min(100,Math.ceil(100*G/F));jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(d+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(d+"%"),b=100,jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-loading-status .wps-loading-bar span").width(b+"%"),jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-loading-status .wps-loading-number").html(b+"%"),jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-loading-status .wps-loading-bar .wps-loader").addClass("done")}100==b&&(jQuery("#container.wps-page-builder #snapshot-item-"+C+" .snapshot-button-abort").hide(),jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-spinner").hide(),jQuery("#snapshot-item-"+C+" .snapshot-filename").html("")),void 0!==a.MEMORY&&(void 0!==a.MEMORY.memory_limit&&jQuery("#snapshot-memory-info span.memory-limit").html(a.MEMORY.memory_limit),void 0!==a.MEMORY.memory_usage_current&&jQuery("#snapshot-memory-info span.memory-usage").html(a.MEMORY.memory_usage_current),void 0!==a.MEMORY.memory_usage_peak&&jQuery("#snapshot-memory-info span.memory-peak").html(a.MEMORY.memory_usage_peak)),c("file",M)}}})}else if("finish"==b){C=b,jQuery("#container.wps-page-builder #snapshot-item-table-"+C+" .wps-loading-status .wps-loading-bar span").width("0%"),jQuery("#container.wps-page-builder #snapshot-item-table-"+C+" .wps-loading-status .wps-loading-number").html("0%");var O=jQuery("#container.wps-page-builder #snapshot-item-table-"+C+" .snapshot-text").html();jQuery("#container.wps-page-builder #snapshot-item-table-"+C+" .snapshot-text").html(O+" (creating zip archive of tables)"),D={action:"snapshot_backup_ajax","snapshot-proc-action":b,"snapshot-action":n,"snapshot-item":m,"snapshot-data-item":o,"snapshot-blog-id":w,security:j},d=jQuery.ajax({type:"POST",url:ajaxurl,data:D,dataType:"json",error:function(a,b,c){!1!==a.responseText&&""!==a.responseText?(jQuery("#wps-build-error .wps-auth-message p").html(a.responseText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))},success:function(a){if(void 0===a||void 0===a.errorStatus)jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden");else if(!1!==a.errorStatus)void 0===a.errorText?(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#snapshot-ajax-error").append(a.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else if(!1===a.errorStatus||!1===e){G++;var b=Math.min(100,Math.ceil(100*G/F));jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(b+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(b+"%");jQuery("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-bar span").width("100%"),jQuery("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-number").html("100%"),jQuery("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),jQuery("#container.wps-page-builder #wps-log-process-finish .wps-loading-status").removeClass("wps-spinner"),void 0!==a.MEMORY&&(void 0!==a.MEMORY.memory_limit&&jQuery("#snapshot-memory-info span.memory-limit").html(a.MEMORY.memory_limit),void 0!==a.MEMORY.memory_usage_current&&jQuery("#snapshot-memory-info span.memory-usage").html(a.MEMORY.memory_usage_current),void 0!==a.MEMORY.memory_usage_peak&&jQuery("#snapshot-memory-info span.memory-peak").html(a.MEMORY.memory_usage_peak)),void 0!==a.responseText&&(jQuery("#wps-build-success").removeClass("hidden").find(".wps-auth-message.success").html("<p>"+a.responseText+"</p>"),jQuery("#wps-build-success-view").attr("href",jQuery("#wps-build-success .wps-auth-message.success").find("a").attr("href")),jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))}}})}}e=!1,jQuery('[id^="snapshot-item-table-"]').remove(),jQuery("#snapshot-item-file").remove();var f=[],g=jQuery("input.snapshot-files-option:checked").val(),h="archive",i="",j=jQuery(":hidden#snapshot-ajax-nonce").val();if("none"!==g){if("all"===g);else if("selected"===g&&(jQuery("input.snapshot-backup-sub-options:checked",this).each(function(){f[f.length]=jQuery(this).attr("value")}),0===f.length))return jQuery("#snapshot-ajax-warning").html("<p>"+snapshot_messages.no_files_selected+"</p>").show(),!1;i=jQuery("textarea#snapshot-files-ignore").val(),h=jQuery("input.snapshot-destination-sync:checked").val()}var k=[],l=jQuery("input.snapshot-tables-option:checked").val();if("selected"===l){if(jQuery("input.snapshot-table-item:checked",this).each(function(){var a=jQuery(this).attr("value");k[k.length]=a}),0===k.length)return jQuery("#snapshot-ajax-warning").html("<p>"+snapshot_messages.no_tables_selected+"</p>").show(),!1}else"all"===l&&jQuery("input.snapshot-table-item",this).each(function(){k[k.length]=jQuery(this).attr("value")});if("none"===g&&"none"===l)return jQuery("#snapshot-ajax-error").html("<p>"+snapshot_messages.no_files_tables+"</p>").show(),!1;var m,n=jQuery("input#snapshot-action",this).val();"add"!==n&&"update"!==n||(m=jQuery("input#snapshot-item",this).val());var o=jQuery("input#snapshot-data-item",this).val();if(""===m)return jQuery("#snapshot-ajax-warning").html("<p>"+snapshot_messages.missing_timekey+"</p>").show(),!1;var p=jQuery("input[name=frequency]:checked",this).val(),q="once"!==p?jQuery("select#snapshot-interval",this).val():"immediate";if(!jQuery("#checkbox-run-backup-now",this).is(":checked")&&"immediate"!==q)return!0;b.preventDefault();var r=jQuery("input#snapshot-archive-count",this).val(),s=jQuery("input#snapshot-remote-archive-count",this).val(),t=jQuery("[name=snapshot-destination]:checked",this).val(),u=jQuery("select#snapshot-destination-local",this).val(),v=jQuery("input#snapshot-destination-directory",this).val(),w=0;w=jQuery("select#snapshot-blog-id",this).length>0?jQuery("select#snapshot-blog-id",this).val():jQuery("input#snapshot-blog-id",this).val();var x=jQuery("input#snapshot-name",this).val(),y=jQuery("textarea#snapshot-notes",this).val();if(g=jQuery("input:radio[name=snapshot-files-option]:checked",this).val(),"1"===jQuery("input:radio[name=snapshot-clean-remote]:checked",this).val())var z=1;else{var z=0;s=!1}if("1"===jQuery("input:radio[name=snapshot-clean-local]:checked",this).val())var A=1;else{var A=0;r=!1}var B=jQuery("input#snapshot-transitioned-purging",this).val();jQuery("#snapshot-ajax-warning").html("").hide(),jQuery("#snapshot-add-update").addClass("hidden");var C;for(var D in k)if(k.hasOwnProperty(D)){var E=k[D];C=a('<tr id="snapshot-item-table-'+E+'"></tr>').append(a("#wps-log-process-template").html()).find(".wps-log-process.name").html(E).end(),jQuery("tr#wps-log-process-finish").before(C)}"all"!==g&&"selected"!==g||(C=a('<tr id="snapshot-item-file"></tr>').append(a("#wps-log-process-template").html()).find(".wps-log-process.name").html('Files: <span class="snapshot-filename" style="font-style: italic;"></span>').end(),jQuery("tr#wps-log-process-finish").before(C)),jQuery("#container.wps-page-builder").removeClass("hidden");var F=k.length+2,G=0,H=[],I=[];return c("init",0),!0})}}(jQuery),function(a){function b(a){return void 0!==a&&a.length?a.replace(/\\/g,"/").replace(/.*\//,""):a}window.SS_PAGES.snapshot_page_snapshot_pro_snapshots_restore=function(){function c(){return null!==d&&d.abort(),e=!0,a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(snapshot_messages.restore_aborted),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),!1}var d=null,e=!1;a("#wps-build-error-again").on("click",function(b){b.preventDefault(),a("#wps-build-error").addClass("hidden"),a("#wps-build-progress").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").addClass("hidden"),a(".wpmud-box-title .wps-title-progress").removeClass("hidden"),a("form#snapshot-edit-restore").submit()}),a("#wps-build-error-back").on("click",function(b){b.preventDefault(),a("#wps-build-error").addClass("hidden"),a("#wps-build-progress").removeClass("hidden"),a("#snapshot-edit-restore").removeClass("hidden"),a("#container.wps-page-builder").addClass("hidden"),a(".wpmud-box-title .wps-title-result").addClass("hidden"),a(".wpmud-box-title .wps-title-progress").removeClass("hidden")}),a("#wps-cancel").off().on("click",function(a){a.preventDefault(),c()}),a("form#snapshot-edit-restore").off().submit(function(){function f(v,w){var x,y;if("init"===v){x=v;var z='<div class="snapshot-item" id="snapshot-item-table-'+x+'"><div class="progress"><div class="percent">0%</div><div class="bar" style="width: 0px;"></div></div><button style="display: none;" class="snapshot-button-abort">Abort</button><div class="snapshot-text">Snapshot determining tables/files to restore</div></div>';a("#snapshot-progress-bar-container").append(z),a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" .progress .bar").width("0%"),a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" .progress .percent").html("0%"),a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" .snapshot-button-abort").show(),a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" button.snapshot-button-abort").click(function(){c()}),y={action:"snapshot_restore_ajax",snapshot_action:v,item_key:g,item_data:u,"snapshot-blog-id":p,"snapshot-files-option":m,"snapshot-files-sections":l,"snapshot-tables-option":o,"snapshot-tables-array":n,snapshot_blog_search:h,security:j},d=a.ajax({type:"POST",url:ajaxurl,data:y,dataType:"json",error:function(b,c,d){!1!==b.responseText&&""!==b.responseText?(a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(b.responseText),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")):(a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a("#wps-build-progress").addClass("hidden"))},success:function(b){var c;if(null!==b)if(void 0!==b.errorStatus)if(!1===b.errorStatus){if(!1===e){var d="init";a("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-bar span").width("100%"),a("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-number").html("100%"),a("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),a("#container.wps-page-builder #wps-log-process-init .snapshot-button-abort").addClass("hidden"),r++;var g=Math.min(100,Math.round(100*r/q));if(a("#wps-build-progress .wps-total-status .wps-loading-number").html(g+"%"),a("#wps-build-progress .wps-total-status .wps-loading-bar span").width(g+"%"),void 0!==b.MANIFEST.TABLES&&Object.keys(b.MANIFEST.TABLES).length){for(d in b.MANIFEST.TABLES)if(b.MANIFEST.TABLES.hasOwnProperty(d)){var h=b.MANIFEST.TABLES[d];c=a('<tr id="snapshot-item-table-'+h.table_name+'"></tr>').append(a("#wps-log-process-template").html()).find(".wps-log-process.name").html(h.label).end(),a("tr#wps-log-process-finish").before(c)}s=b.MANIFEST["TABLES-DATA"]}void 0!==b.MANIFEST["FILES-DATA"]&&Object.keys(b.MANIFEST["FILES-DATA"]).length&&(t=b.MANIFEST["FILES-DATA"],c=a('<tr id="snapshot-item-file"></tr>').append(a("#wps-log-process-template").html()).find(".wps-log-process.name").html('Files: <span class="snapshot-filename" style="font-style: italic;"></span>').end(),a("tr#wps-log-process-finish").before(c)),f("table",0)}}else void 0!==b.errorText&&(a("#wps-build-error .wps-auth-message p").html(b.errorText),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"));else a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden");else a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")}})}else if("table"===v){var A=parseInt(w),B=A+1;if(B>s.length)return void(t.length>0?f("file",0):f("finish",0));var C=s[A];x=C.table_name,a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" button.snapshot-button-abort").show().click(function(){c()}),y={action:"snapshot_restore_ajax",snapshot_action:v,item_key:g,item_data:u,"snapshot-blog-id":p,snapshot_table:x,table_data:C,snapshot_blog_search:h,security:j},d=a.ajax({type:"POST",url:ajaxurl,data:y,timeout:6e5,dataType:"json",error:function(b,c,d){!1!==b.responseText&&""!==b.responseText?(a("#wps-build-error .wps-auth-message p").html(b.responseText),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")):(a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"))},success:function(b){var c;if(a("#snapshot-progress-bar-container").find("#snapshot-item-table-"+x).find(".snapshot-button-abort").hide(),a("#snapshot-progress-bar-container").find("#snapshot-item-table-"+x).find(".wps-spinner").hide(),void 0!==b.errorStatus)if(!1===b.errorStatus){if(!1===e){if(void 0!==b.table_data){C=b.table_data;var d=parseInt(C.rows_start)+parseInt(C.rows_end);if(d>0?(c=Math.ceil(d/C.rows_total*100),a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .wps-loading-status .wps-loading-bar span").width(c+"%"),a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .wps-loading-status .wps-loading-number").html(c+"%")):(c=100,a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .wps-loading-status .wps-loading-bar span").width(c+"%"),a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .wps-loading-status .wps-loading-number").html(c+"%")),100==c){a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .snapshot-button-abort").hide(),a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .wps-spinner").hide(),a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),r++;var g=Math.min(100,Math.round(100*r/q));a("#wps-build-progress .wps-total-status .wps-loading-number").html(g+"%"),a("#wps-build-progress .wps-total-status .wps-loading-bar span").width(g+"%")}}f("table",B)}}else a("#wps-build-error .wps-auth-message p").html(b.errorText),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden");else a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")}})}else if("file"==v){var D=parseInt(w),E=D+1;if(x=v,E>t.length)return void(t.length>0&&f("finish",0));var F=t[D];F=b(F),a("#snapshot-item-"+x+" .snapshot-filename").html(": "+F),a("#snapshot-progress-bar-container #snapshot-item-file button.snapshot-button-abort").show(),a("#snapshot-progress-bar-container #snapshot-item-file button.snapshot-button-abort").click(function(){c()}),y={action:"snapshot_restore_ajax",snapshot_action:v,item_key:g,item_data:u,file_data_idx:D,"snapshot-blog-id":p,security:j},d=a.ajax({type:"POST",url:ajaxurl,data:y,timeout:6e5,dataType:"json",error:function(b,c,d){!1!==b.responseText&&""!==b.responseText?(a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(b.responseText),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")):(a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"))},success:function(b){var c;if(a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" .snapshot-button-abort").hide(),a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" .wps-spinner").hide(),void 0!==b.errorStatus)if(!1===b.errorStatus){if(!1===e){if(void 0!==b.file_data){if(E<t.length)c=Math.ceil(E/t.length*100),a("#container.wps-page-builder #snapshot-item-"+x+" .wps-loading-status .wps-loading-bar span").width(c+"%"),a("#container.wps-page-builder #snapshot-item-"+x+" .wps-loading-status .wps-loading-number").html(c+"%");else{r++;var d=Math.min(100,Math.round(100*r/q));a("#wps-build-progress .wps-total-status .wps-loading-number").html(d+"%"),a("#wps-build-progress .wps-total-status .wps-loading-bar span").width(d+"%"),c=100,a("#container.wps-page-builder #snapshot-item-"+x+" .wps-loading-status .wps-loading-bar span").width(c+"%"),a("#container.wps-page-builder #snapshot-item-"+x+" .wps-loading-status .wps-loading-number").html(c+"%"),a("#container.wps-page-builder #snapshot-item-"+x+" .wps-loading-status .wps-loading-bar .wps-loader").addClass("done")}100===c&&(a("#snapshot-progress-bar-container #snapshot-item-"+x+" .snapshot-button-abort").hide(),a("#snapshot-progress-bar-container #snapshot-item-"+x+" .wps-spinner").hide(),a("#snapshot-item-"+x+" .snapshot-filename").html(""))}f("file",E)}}else a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(b.errorText),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden");else a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")}})}else"finish"==v&&(x=v,a("#container.wps-page-builder #snapshot-item-table-"+x+" .wps-loading-status .wps-loading-bar span").width("0%"),a("#container.wps-page-builder #snapshot-item-table-"+x+" .wps-loading-status").addClass("wps-spinner"),a("#container.wps-page-builder #snapshot-item-table-"+x+" .wps-loading-status .wps-loading-number").html("0%"),y={action:"snapshot_restore_ajax",snapshot_action:v,item_key:g,item_data:u,"snapshot-blog-id":p,snapshot_restore_plugin:i,snapshot_restore_theme:k,security:j},d=a.ajax({type:"POST",url:ajaxurl,data:y,dataType:"json",error:function(b,c,d){!1!==b.responseText&&""!==b.responseText?(a("#wps-build-error .wps-auth-message p").html(b.responseText),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")):(a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"))},success:function(b){if(void 0!==b.errorStatus)if(!1===b.errorStatus){if(!1===e){r++;var c=Math.min(100,Math.round(100*r/q));a("#wps-build-progress .wps-total-status .wps-loading-number").html(c+"%"),a("#wps-build-progress .wps-total-status .wps-loading-bar span").width(c+"%");a("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-bar span").width("100%"),a("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-number").html("100%"),a("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),a("#container.wps-page-builder #wps-log-process-finish .wps-loading-status").removeClass("wps-spinner"),a("#wps-build-success-view").attr("href",a("#wps-build-success .wps-auth-message.success").find("a").attr("href")),a("#wps-build-error").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),void 0!==b.restore_admin_url&&a("a.restored-admin-url").attr("href",b.restore_admin_url),void 0!==b.restore_site_url&&a("a.restored-site-url").attr("href",b.restore_site_url),a("#wps-build-success").removeClass("hidden")}}else a("#wps-build-error .wps-auth-message p").html(b.errorText),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden");else a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")}}))}var g=a('input[name="item"]').val(),h=a('input[name="snapshot-blog-id-search"]').val(),i=a("input#snapshot-restore-option-plugins",this).attr("checked"),j=jQuery(":hidden#snapshot-ajax-nonce").val();i="checked"===i?"yes":"no";var k=a('input[name="restore-option-theme"]:checked',this).val(),l=[],m=a("input.snapshot-files-option:checked").val();"all"==m||"selected"==m&&(a("input.snapshot-backup-sub-options:checked",this).each(function(){var b=a(this).attr("value");l[l.length]=b}),0===l.length&&(m="all"));var n=[],o=a("input.snapshot-tables-option:checked").val(),p=a("input#snapshot-blog-id").val();"selected"===o?(a("input.snapshot-table-item:checked",this).each(function(){n[n.length]=a(this).attr("value")}),0===n.length&&(o="all")):"all"===o&&a("input.snapshot-table-item",this).each(function(){n[n.length]=a(this).attr("value")});var q=n.length+2,r=0;a("#snapshot-edit-restore").addClass("hidden"),a("#snapshot-ajax-warning").html(""),a("#snapshot-ajax-warning").hide(),a("#container.wps-page-builder").removeClass("hidden");var s=[],t=[],u=a('input:radio[name="snapshot-restore-file"]:checked').val();return f("init",0),!1})}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_snapshots=function(){a(".wps-menu-dots").each(function(){var b=a(this),c=b.parent(".wps-menu"),d=a(".wps-menu").not(c);b.on("click",function(){d.removeClass("open"),c[c.hasClass("open")?"removeClass":"addClass"]("open")})}),a("#my-snapshot-all").on("change",function(){a('input[id^="my-snapshot"]').attr("checked",a(this).is(":checked"))}),a("#wps-snapshot-log").find(".wps-popup-close").on("click",function(b){b.preventDefault(),a("#wps-snapshot-log").removeClass("show")}),a("#wps-snapshot-log-view").on("click",function(b){b.preventDefault(),a("#wps-snapshot-log .wps-log-box").html(snapshot_messages.loading+"<br />"),a("#wps-snapshot-log").addClass("show");var c=tb_parseQuery(a("#wps-snapshot-log").attr("data-ajax-src")),d=0,e=setInterval(function(){if(a("#wps-snapshot-log").length&&a("#wps-snapshot-log").is(".show")){var b={action:"snapshot_view_log_ajax","snapshot-item":c["snapshot-item"],"snapshot-data-item":c["snapshot-data-item"],"snapshot-log-position":d,"snapshot-noonce-field":c["snapshot-noonce-field"]};snapshot_ajax_hdl_xhr=jQuery.ajax({type:"POST",url:ajaxurl,cache:!1,data:b,dataType:"json",error:function(a,b,c){clearInterval(e)},success:function(b){0===b.payload.length||b.position>=b.filesize?clearInterval(e):(void 0!==b&&void 0!==b.payload&&(0===d?a("#wps-snapshot-log .wps-log-box").html(b.payload):a("#wps-snapshot-log .wps-log-box").append(b.payload),"1"==c.live&&a("#wps-snapshot-log").length&&a("#wps-snapshot-log .wps-log-box").scrollTop(a("#wps-snapshot-log .wps-log-box")[0].scrollHeight)),void 0!==b&&void 0!==b.position&&d!=b.position&&(d=b.position))}})}else clearInterval(e)},1e3)}),a("body").is(".snapshot_page_snapshot_pro_snapshot_create")||window.SS_PAGES.snapshot_page_snapshot_pro_snapshot_create()}}(jQuery),function(a){SS_UTILS.openModal=function(b,c,d,e){var f=a(a("#ss-modal-template").html());f.find(".wpmud-box-title > h3").html(b),f.find(".wpmud-box-content").html(c),a("#wpbody-content").append(f),a.isFunction(d)&&d(),f.fadeIn(),f.on("click",".wpmud-box-title > .close",function(){f.fadeOut(),setTimeout(function(){f.remove(),a.isFunction(e)&&e()},400)})}}(jQuery);
//# sourceMappingURL=admin.min.js.map