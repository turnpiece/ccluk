window.SS_UTILS={},window.SS_PAGES={},function(a){a(document).ready(function(){function b(){a("#wps-snapshot-key").addClass("show"),a("body").addClass("wps-popup-modal-active")}a(".wdpun-notice").detach().appendTo("section#header"),a.each(document.body.className.replace(/-/g,"_").split(/\s+/),function(b,c){a.isFunction(SS_PAGES[c])&&SS_PAGES[c]()}),a("#view-snapshot-key,#view-snapshot-key-2").on("click",function(c){c.preventDefault();var d=a(this),e=d.html(),f=(window.snapshot_messages||{}).working||e;if(d.is(".has-key"))return b();d.html(f),a.post(ajaxurl,{action:"snapshot-full_backup-exchange_key"}).done(function(a){return(a||{}).success?window.location.reload():b()}).error(b).always(function(){d.html(e)})}),a(".wps-icon.i-close").on("click",function(b){a("#wps-snapshot-key").removeClass("show"),a("body").removeClass("wps-popup-modal-active")}),a(".wps-popup-close").on("click",function(b){a(this).parents(".wps-popup-modal").removeClass("show"),a("body").removeClass("wps-popup-modal-active")}),a(".wps-popup-modal").hasClass("show")?a("body").addClass("wps-popup-modal-active"):a("body").removeClass("wps-popup-modal-active"),a("select.bulk-action-selector-top").on("change",function(b){var c=a(this).val();a("select.bulk-action-selector-top").not(this).val(c).trigger("wpmu:change")});var c=a("#wps-snapshot-key");a("#wps-snapshot-key form").on("submit",function(b){b.preventDefault();var d=a(this).serializeArray();d.push({name:"action",value:"snapshot_save_key"}),d.push({name:"security",value:a(this).data("security")}),a(".wps-snapshot-popin-content",c).addClass("hidden"),a(".wps-snapshot-popin-content-step-2",c).removeClass("hidden"),a(".wps-snapshot-key.wpmud-box-gray",c).addClass("wps-processing"),jQuery.ajax({type:"POST",url:ajaxurl,data:d,dataType:"json",success:function(b){if(a(".wps-snapshot-key.wpmud-box-gray",c).removeClass("wps-processing"),a(".wps-snapshot-popin-content",c).addClass("hidden"),b.success){a(".wps-snapshot-popin-content-step-4",c).removeClass("hidden");var d=location.href;d+=-1===d.indexOf("?")?"?":"&",location.href=d+a.param({message:"success-snapshot-key"})}else a(".wps-snapshot-popin-content-step-3",c).removeClass("hidden")},error:function(){a(".wps-snapshot-key.wpmud-box-gray",c).removeClass("wps-processing"),a(".wps-snapshot-popin-content",c).addClass("hidden"),a(".wps-snapshot-popin-content-step-3",c).removeClass("hidden")}})}),a("#disable-notif").on("click",function(b){b.preventDefault();var c={security:a(this).data("security"),action:"snapshot_disable_notif_ajax"};jQuery.ajax({type:"POST",url:ajaxurl,data:c,dataType:"json",success:function(){a(".try-managed-backups-box").remove()}})}),a(".wps-message").on("click",function(b){a(this).fadeOut()}).delay(2e3).fadeOut(),a(".button-disabled").on("click",function(a){a.preventDefault()}),a(".wpmud-box-tab-title.can-toggle").on("click",function(b){b.preventDefault(),a(this).parents(".wpmud-box-tab").toggleClass("open")})})}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_dashboard=function(){var b=function(){var b=a("#ss-show-apikey").html(),c=function(){a("#reset-api-key").click(function(){var b=a(this).data("url");a("<a>").attr("href",b).attr("target","_blank")[0].click()})};SS_UTILS.openModal(snapshot_messages.snapshot_key,b,c)};a("#view-snapshot-key,#view-snapshot-key-2").click(b)}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_destinations=function(){if(a("#wps-destination-delete").on("click",function(b){b.preventDefault(),a("#wps-destination-warning").addClass("show")}),a(".copy-to-clipboard").on("click",function(b){b.preventDefault();var c=a(this).data("clipboard-target"),d=a(c);d.length&&(d.select(),document.execCommand("copy"))}),a(".show-instructions").on("click",function(b){a(a(this).data("instructions")).toggle()}),"dropbox"===jQuery('[name="snapshot-destination[type]"]').val()){$form=a("#wps-destinations-wizard form"),$dropboxToken=a('[name="snapshot-destination[tokens][access][authorization_token]"]'),$submitButton=a('#wps-destinations-wizard form [type="submit"]'),$forceAuthorize=a('[name="snapshot-destination[force-authorize]"]'),$dropboxToken.on("input",function(b){a(this).val().length>0?($submitButton.val($submitButton.data("authenticate-text")),$form.attr("target",""),$forceAuthorize.val("off")):($submitButton.val($submitButton.data("get-code-text")),$form.attr("target","_blank"),$forceAuthorize.val("on"))}).trigger("input"),"on"===$forceAuthorize.val()&&$forceAuthorize.is(":checkbox")&&$forceAuthorize.is(":checked")||"on"===$forceAuthorize.val()&&$forceAuthorize.is(":hidden")?($submitButton.val($submitButton.data("get-code-text")),$form.attr("target","_blank"),$forceAuthorize.val("on")):1===$dropboxToken.length&&""!==$dropboxToken.val()?($submitButton.val($submitButton.data("authenticate-text")),$form.attr("target",""),$forceAuthorize.val("off")):($submitButton.val($submitButton.data("save-text")),$form.attr("target",""),$forceAuthorize.val("off"));var b=!1;a('[name="snapshot-destination[tokens][access][authorization_token]"]',"#wps-destination-token-checkbox").on("input",function(a){b=!0}),$forceAuthorize.filter(":checkbox").on("change",function(c){a(this).is(":checked")?($submitButton.val($submitButton.data("get-code-text")),$form.attr("target","_blank"),$forceAuthorize.val("on"),a("#wps-destination-token-checkbox").css("display","block")):(b?$submitButton.val($submitButton.data("authenticate-text")):$submitButton.val($submitButton.data("save-text")),$form.attr("target",""),$forceAuthorize.val("off"),a("#wps-destination-token-checkbox").css("display","none"))}).trigger("change")}}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_managed_backups_create=function(){function b(){null!==c&&c.abort(),d=!0;a.post(ajaxurl,{action:"snapshot-full_backup-finish"},g,"json");return jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Backup aborted"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"),window.Sfb.ManualBackup.current=window.Sfb.ManualBackup.total=0,window.Sfb.ManualBackup.update_progress(),!1}a(document).ready(function(){"#wps-backups-settings-schedule"===window.location.hash&&a('[for="wps-managed-backups-configs"]').click()}),a("#wps-managed-backups-configure").on("click",function(b){b.preventDefault(),a("[for='wps-managed-backups-menu-config']").click(),a("html,body").animate({scrollTop:a(".wps-managed-backups-configs").offset().top},"slow")}),jQuery("input[name='frequency']").change(function(){"once"===jQuery("input[name='frequency']:checked").val()?(jQuery("div#snapshot-schedule-options-container").slideUp("fast"),jQuery("#snapshot-backup-action").attr("name","snapshot-disable-cron")):(jQuery("div#snapshot-schedule-options-container").slideDown("slow"),jQuery("#snapshot-backup-action").attr("name","snapshot-schedule"))}).change(),jQuery("#wps-build-error-again").on("click",function(a){a.preventDefault(),jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").removeClass("hidden"),jQuery("form#managed-backup-update").trigger("submit")}),jQuery("#checkbox-run-backup-now").on("change",function(b){var c=a(this).is(":checked"),d=a("#managed-backup-update button[type=submit]");d.text(d.attr("data-"+(c?"run-backup":"update-settings")+"-text"))}),jQuery("form#managed-backup-update").off().on("submit",function(b){var c=a(this),d=jQuery("#frequency-once",c).is(":checked"),e=jQuery("#checkbox-run-backup-now",c).is(":checked");(d||!d&&e)&&(b.preventDefault(),jQuery("#managed-backup-update").addClass("hidden"),jQuery("#container.wps-page-builder").removeClass("hidden"),d?window.Sfb.ManualBackup.handle_start_click():jQuery.ajax({type:"POST",url:c.attr("src"),data:c.serialize(),success:function(){window.Sfb.ManualBackup.handle_start_click()}}))});var c=null,d=!1;jQuery("#wps-build-progress-cancel").on("click",function(a){a.preventDefault(),b()}),jQuery("#wps-build-error-back").on("click",function(a){a.preventDefault(),jQuery("#container.wps-page-builder").addClass("hidden"),jQuery("#managed-backup-update").removeClass("hidden")});var e=window.Sfb||{value:function(a){return(window._snp_vars||{})[a]},l10n:function(a){return(this.value("l10n")||{})[a]||a}},f={element_selector:"",get_elements:function(){return a(this.element_selector)},initialize_listeners:function(){var b=this;return this.get_elements().each(function(){b.initialize_listener(a(this))}),!0},initialize_listener:function(a){}};e.Util={stop_prop:function(a){return a&&a.preventDefault&&a.preventDefault(),a&&a.stopPropagation&&a.stopPropagation(),!1}},e.Notice=a.extend({},f,{element_selector:".wp-admin .notice .button.snapshot",target_selector:".backup-list td.name .location.local:first",subtarget_selector:"td",handle_target_scroll:function(b){var c=a(this).attr("data-target")||e.Notice.target_selector,d=a(this).is("[data-subtarget]")?a(this).attr("data-target"):e.Notice.subtarget_selector,f=a(c),g=0;return d&&(f=f.closest(d)),f.length&&(g=(f.offset()||{}).top-a("#wpadminbar").height())>0&&(a(window).scrollTop(g),f.fadeOut(300).fadeIn(300)),e.Util.stop_prop(b)},initialize_listener:function(a){a.off("click.snapshot").on("click.snapshot",this.handle_target_scroll)},run:function(){return this.initialize_listeners(),!0}});var g=function(){};e.ManualBackup=a.extend({},f,{element_selector:'.wp-admin .snapshot-wrap button[name="backup"]',current:0,total:0,$target:!1,skip_estimate:!1,error_handler:function(b){var c=a.trim((b||{}).responseText)||"&lt;empty response&gt;";return jQuery("#wps-build-error .wps-auth-message p").html("<p>"+c+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"),!!e.ManualBackup.initialize_listeners()},update_progress:function(){if(this.total>0&&this.current&&this.current<=this.total){var a=this.current>1?this.current-1:1,b=100*a/this.total;b>=100&&(b=100),jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(parseInt(b,10)+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(parseInt(b,10)+"%")}return!0},start_backup:function(){return a.post(ajaxurl,{action:"snapshot-full_backup-start"},g,"json").fail(e.ManualBackup.error_handler)},finish_backup:function(b){this.update_progress();var c=a.post(ajaxurl,{action:"snapshot-full_backup-finish",security:b},g,"json");return c.then(function(a){if(!a.status)return e.ManualBackup.finish_backup(b);jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"),jQuery("#wps-build-success").removeClass("hidden")}).fail(e.ManualBackup.error_handler),c},process_files:function(b){this.update_progress(),a.post(ajaxurl,{action:"snapshot-full_backup-process",security:b},g,"json").then(function(a){e.ManualBackup.current++;var c=!1;try{c=!!a.done}catch(a){return error_handler()}c?e.ManualBackup.finish_backup(b):e.ManualBackup.process_files(b)}).fail(e.ManualBackup.error_handler)},estimate_backup:function(){var b=a.post(ajaxurl,{action:"snapshot-full_backup-estimate"},g,"json");return b.then(function(a){var b=parseInt((a||{}).total||"0",10);b&&(e.ManualBackup.total=b)}).fail(e.ManualBackup.error_handler),b},handle_start_click:function(a){jQuery("#managed-backup-update").addClass("hidden"),jQuery("#container.wps-page-builder").removeClass("hidden");var b=jQuery("form#managed-backup-update :hidden#snapshot-ajax-nonce");return e.ManualBackup.current=1,e.ManualBackup.start_backup().then(function(a){return(a||{}).id?e.ManualBackup.skip_estimate?e.ManualBackup.process_files(b.val()):e.ManualBackup.estimate_backup().then(function(){return e.ManualBackup.process_files(b.val())}):e.ManualBackup.error_handler(a)}),e.Util.stop_prop(a)},initialize_listener:function(a){return a.off("click.snapshot",this.handle_start_click).on("click.snapshot",this.handle_start_click),!0},run:function(){if(!this.get_elements().length)return!1;var b=a("#snapshot-full_backups-panel header"),c='<div id="snapshot-ajax-out"><div class="out"></div></div>';return a("#snapshot-ajax-out").remove(),b.length?b.after(c):this.get_elements().first().after(c),this.$target=a("#snapshot-ajax-out").find(".out"),this.initialize_listeners(),!0}}),e.Logs={Toggler:a.extend({},f,{element_selector:"#log-enable",handle_enable:function(){var b=e.Logs.Toggler.get_elements(),c=b.is(":checked"),d=b.attr("data-default");c?a(".snapshot-settings.log-levels").show():a(".snapshot-settings.log-levels").hide().find('input[type="radio"]').attr("checked",!1).end().find('input[type="radio"][value="'+d+'"]').attr("checked",!0)},initialize_listener:function(a){a.off("click.snapshot").on("click.snapshot",this.handle_enable)},run:function(){return this.initialize_listeners(),this.handle_enable(),!0}}),Viewer:a.extend({},f,{element_selector:'a[href="#view-log-file"]',ttl:12e4,handle_view:function(b){ttl=e.Logs.Viewer.ttl?parseInt(e.Logs.Viewer.ttl,10):0,a("#wps-snapshot-log div.wps-log-box").replaceWith(a('<pre class="wps-log-box">')),a("#wps-snapshot-log .wps-log-box").html("Loading...<br />"),a("#wps-snapshot-log").addClass("show");var d=ajaxurl+"?action=snapshot-full_backup-get_log",f=setInterval(function(){a("#wps-snapshot-log").length&&a("#wps-snapshot-log").is(".show")?c=jQuery.ajax({type:"POST",url:d,cache:!1,dataType:"html",error:function(a,b,c){clearInterval(f)},success:function(b){a(b).length>0?(a("#wps-snapshot-log .wps-log-box").html(a(b).text()),a("#wps-snapshot-log .wps-log-box").scrollTop(a("#wps-snapshot-log .wps-log-box")[0].scrollHeight)):a("#wps-snapshot-log .wps-log-box").html(b)}}):clearInterval(f)}(),ttl);return e.Util.stop_prop(b)},initialize_listener:function(a){a.off("click.snapshot").on("click.snapshot",this.handle_view)},run:function(){return this.initialize_listeners(),!0}}),run:function(){return e.Logs.Toggler.run(),e.Logs.Viewer.run(),!0}},window.Sfb=e,a(function(){e.Notice.run(),e.Logs.run(),e.ManualBackup.run()})}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_managed_backups_restore=function(){function b(){return null!==d&&d.abort(),e=!0,a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(snapshot_messages.restore_aborted),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),!1}function c(b){"error"===b?(a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Restoration failed"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")):"done"===b?(a("#wps-build-progress .wps-total-status .wps-loading-number").html("100%"),a("#wps-build-progress .wps-total-status .wps-loading-bar span").width("100%"),a("#wps-build-error").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),a("#wps-build-success").removeClass("hidden")):"fetch"===b?(a("#wps-build-progress .wps-total-status .wps-loading-number").html("40%"),a("#wps-build-progress .wps-total-status .wps-loading-bar span").width("40%")):"process"===b&&(a("#wps-build-progress .wps-total-status .wps-loading-number").html("80%"),a("#wps-build-progress .wps-total-status .wps-loading-bar span").width("80%"))}var d=null,e=!1,f=!1;a("#wps-show-full-log").on("click",function(b){b.preventDefault();var c=a(this);a("#wps-log").is(".hidden")?(c.text(c.attr("data-wps-hide-title")),a("#wps-log").removeClass("hidden")):(c.text(c.attr("data-wps-show-title")),a("#wps-log").addClass("hidden"))}),a("#wps-build-error-again").on("click",function(b){b.preventDefault(),a("#wps-build-error").addClass("hidden"),a("#wps-build-progress").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").addClass("hidden"),a(".wpmud-box-title .wps-title-progress").removeClass("hidden"),a("form#managed-backup-restore").submit()}),a("#wps-build-error-back").on("click",function(b){b.preventDefault(),a("#wps-build-error").addClass("hidden"),a("#wps-build-progress").removeClass("hidden"),a("#managed-backup-restore").removeClass("hidden"),a("#container.wps-page-builder").addClass("hidden"),a(".wpmud-box-title .wps-title-result").addClass("hidden"),a(".wpmud-box-title .wps-title-progress").removeClass("hidden")}),a("#wps-cancel").off().on("click",function(a){a.preventDefault(),b()}),a("form#managed-backup-restore").off().submit(function(b){b.preventDefault(),a("#managed-backup-restore").addClass("hidden"),a("#snapshot-ajax-warning").html(""),a("#snapshot-ajax-warning").hide(),a("#container.wps-page-builder").removeClass("hidden");var d=new a.Deferred,e=a("form#managed-backup-restore :hidden.archive"),g=a("form#managed-backup-restore :text.location"),h=a("form#managed-backup-restore .request-filesystem-credentials-form input"),i=a("form#managed-backup-restore :hidden#snapshot-ajax-nonce"),j={},k=function(b){b.action="snapshot-full_backup-restore",a.post(ajaxurl,b,function(){},"json").then(function(e){if(!e||(e||{}).error)return a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Error restoring backup"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),d.resolve(),!1;if("clearing"!==e.task){c("fetching"===e.task?"fetch":"process"),k(b)}else c(e.status?"done":"error"),f=!1,d.resolve()}).fail(function(){return d.resolve(),a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Restoration failed"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),!1})};return j={idx:void 0,archive:e.val(),restore:g.val(),credentials:{},security:i.val()},h.each(function(){var b=a(this);b.is(":radio")||b.is(":checkbox")?b.is(":checked")&&(j.credentials[b.attr("name")]=b.val()):(b.is(":text")||b.is(":password")||b.is(":hidden"))&&(j.credentials[b.attr("name")]=b.val())}),f=!0,c("fetch"),a(window).on("beforeunload.snapshot-restore",function(a){var b="You still have a restore active, navigating off this page will stop it mid-process";return a.returnValue=b,b}),k(j),d.promise().always(function(){a(window).off("beforeunload.snapshot-restore")})})}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_managed_backups=function(){a(".wps-menu-dots").each(function(){var b=a(this),c=b.parent(".wps-menu"),d=a(".wps-menu").not(c);b.on("click",function(){d.removeClass("open"),c[c.hasClass("open")?"removeClass":"addClass"]("open")})}),a("#snapshot-edit-listing table tr").each(function(b,c){a(c).find(".msc-info").css("z-index",1e3-b)}),a('input[name="wps-managed-backups-menu"]').on("change",function(b){var c=a(this).filter(":checked").val();a('select[name="wps-managed-backups-menu-mobile"]').val(c).change(),a(".wps-managed-backups-pages > .wpmud-box").addClass("hidden").filter("."+c).removeClass("hidden")}),a('select[name="wps-managed-backups-menu-mobile"]').on("change",function(b){var c=a(this).val();a('input[name="wps-managed-backups-menu"][value="'+c+'"]').attr("checked","checked"),a(".wps-managed-backups-pages > .wpmud-box").addClass("hidden").filter("."+c).removeClass("hidden")}),a("#wps-managed-backups-configure").on("click",function(b){b.preventDefault(),a("[for='wps-managed-backups-menu-config']").click(),a("html,body").animate({scrollTop:a(".wps-managed-backups-configs").offset().top},"slow")}),a("#my-backup-all").on("change",function(){a('input[id^="my-backup"]').attr("checked",a(this).is(":checked"))}),a("#wps-managed-backups-onoff").on("change",function(b){var c=a(this).parents("form"),d=a(this).is(":checked"),e=a("#wps-managed-backups-onoff-hidden",c);d?(e.attr("name","snapshot-enable-cron"),a(".wps-managed-backups-schedule-form").removeClass("hidden")):(e.attr("name","snapshot-disable-cron"),a(".wps-managed-backups-schedule-form").addClass("hidden"));var f=c.serialize();jQuery.ajax({type:"POST",url:c.attr("src"),data:f,success:function(){}})}),window.SS_PAGES.snapshot_page_snapshot_pro_managed_backups_create()}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_settings=function(){a('[name="files"]').on("change",function(){a('[name="files"]:checked').is("#common_files")?a("#wps-settings-localdir .wpmud-box-gray").removeClass("hidden"):a("#wps-settings-localdir .wpmud-box-gray").addClass("hidden")}).change(),a("#wps-settings--error .wps-input--parent > .wps-input--checkbox > input").each(function(){a(this).on("change",function(){var b=a(this),c=b.parents(".wps-input--parent").next(".wpmud-box-gray");b.is(":checked")?c.removeClass("hidden"):c.addClass("hidden")}).change()})}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_snapshot_create=function(){function b(){return null!==c&&c.abort(),d=!0,jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(snapshot_messages.snapshot_aborted),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"),!1}jQuery("input[name='frequency']").change(function(){"once"===jQuery("input[name='frequency']:checked").val()?(jQuery("#snapshot-immediate").attr("disabled",!1).attr("checked",!0),jQuery("#snapshot-interval").attr("disabled",!0),jQuery("div#snapshot-schedule-options-container").slideUp("fast"),jQuery("#snapshot-add-update-submit").text(jQuery("#snapshot-add-update-submit").data("title-save-and-run"))):(jQuery("#snapshot-immediate").attr("disabled",!0).attr("checked",!1),jQuery("#snapshot-interval").attr("disabled",!1),jQuery("div#snapshot-schedule-options-container").slideDown("slow"),jQuery("#checkbox-run-backup-now").is(":checked")||jQuery("#snapshot-add-update-submit").text(jQuery("#snapshot-add-update-submit").data("title-save-only")))}).change(),jQuery("#checkbox-run-backup-now").change(function(){a(this).is(":checked")&&"once"!==jQuery("input[name='frequency']:checked").val()?jQuery("#snapshot-add-update-submit").text(jQuery("#snapshot-add-update-submit").data("title-save-and-run")):"once"!==jQuery("input[name='frequency']:checked").val()&&jQuery("#snapshot-add-update-submit").text(jQuery("#snapshot-add-update-submit").data("title-save-only"))}).change(),jQuery("[name=snapshot-destination]").change(function(){"dropbox"==jQuery("[name=snapshot-destination]:checked").attr("data-destination-type")?jQuery("input#snapshot-destination-sync-mirror").attr("disabled",!1):(jQuery("input#snapshot-destination-sync-mirror").attr("disabled","disabled"),jQuery("input#snapshot-destination-sync-archive").attr("checked","checked"))}).change();var c=null,d=!1;jQuery("#wps-show-full-log").on("click",function(a){a.preventDefault();var b=jQuery(this),c=jQuery("#wps-log");c.is(".hidden")?(b.text(b.attr("data-wps-hide-title")),c.removeClass("hidden")):(b.text(b.attr("data-wps-show-title")),c.addClass("hidden"))}),jQuery("#wps-build-error-again").on("click",function(a){a.preventDefault(),jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").addClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").removeClass("hidden"),jQuery("form#snapshot-add-update").submit()}),jQuery("#wps-build-error-back").on("click",function(a){a.preventDefault(),jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").removeClass("hidden"),jQuery("#snapshot-add-update").removeClass("hidden"),jQuery("#container.wps-page-builder").addClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").addClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").removeClass("hidden")}),jQuery("#wps-cancel").off().on("click",function(c){c.preventDefault(),b(),a("html,body").animate({scrollTop:a("#container.wps-page-builder").offset().top},"slow")}),a("#container.wps-page-builder").off("click.abort").on("click.abort","a.snapshot-button-abort",function(c){c.preventDefault(),b(),a("html,body").animate({scrollTop:a("#container.wps-page-builder").offset().top},"slow")}),jQuery(".snapshot-tables-option, .snapshot-files-option").on("change",function(){1===jQuery("#snapshot-tables-option-none:checked").length&&1===jQuery("#snapshot-files-option-none:checked").length?(jQuery("#snapshot-ajax-error").html("<p>"+snapshot_messages.no_files_tables+"</p>").show(),jQuery("#snapshot-add-update-submit").addClass("button-disabled")):(jQuery("#snapshot-ajax-error").html("").hide(),jQuery("#snapshot-add-update-submit").removeClass("button-disabled"))}),jQuery("form#snapshot-add-update").off().submit(function(b){function e(b,p){var z,A;if("init"===b)z=b,A={action:"snapshot_backup_ajax","snapshot-proc-action":b,"snapshot-action":n,"snapshot-item":m,"snapshot-data-item":o,"snapshot-blog-id":v,"snapshot-name":w,"snapshot-notes":x,"snapshot-files-option":g,"snapshot-files-sections":f,"snapshot-files-ignore":i,"snapshot-tables-option":l,"snapshot-tables-array":k,"snapshot-interval":q,"snapshot-archive-count":r,"snapshot-destination":s,"snapshot-store-local":t,"snapshot-destination-directory":u,"snapshot-destination-sync":h,"snapshot-clean-remote":y,security:j},jQuery("[id^=snapshot-interval-offset]").each(function(){A[this.name]=this.value}),c=jQuery.ajax({type:"POST",url:ajaxurl,data:A,dataType:"json",error:function(a,b,c){!1!==a.responseText&&""!==a.responseText?(jQuery("#wps-build-error .wps-auth-message p").html(a.responseText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error .wps-auth-message p").html("<p>AAA "+snapshot_messages.snapshot_failed+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))},success:function(c){if(void 0===c||void 0===c.errorStatus)jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>BBB "+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden");else if(!1!==c.errorStatus)void 0===c.errorText?(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>CCC "+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#snapshot-ajax-error").append(c.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else if(!1===c.errorStatus||!1===d){var f=b;jQuery("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-bar span").width("100%"),jQuery("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-number").html("100%"),jQuery("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),jQuery("#container.wps-page-builder #wps-log-process-init .wps-loading-status").removeClass("wps-spinner"),jQuery("#container.wps-page-builder #wps-log-process-init .snapshot-button-abort").addClass("hidden"),D++;var g=Math.min(100,Math.round(100*D/C));if(jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(g+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(g+"%"),!1===d){if(void 0!==c.files_data&&(F=c.files_data,C+=F.length),void 0!==c.table_data){E=c.table_data;var h=JSON.stringify(c.table_data);if(h)for(var i in k)if(k.hasOwnProperty(i)){var f=k[i];-1===h.indexOf(f)&&a("#snapshot-item-table-"+f).remove()}e("table",0)}void 0!==c.MEMORY&&(void 0!==c.MEMORY.memory_limit&&jQuery("#snapshot-memory-info").find(".log-memory.number").html(c.MEMORY.memory_limit),void 0!==c.MEMORY.memory_usage_current&&jQuery("#snapshot-memory-info .log-usage.number").html(c.MEMORY.memory_usage_current),void 0!==c.MEMORY.memory_usage_peak&&jQuery("#snapshot-memory-info .log-peak.number").html(c.MEMORY.memory_usage_peak))}}}});else if("table"===b){var B=parseInt(p),G=B+1;if(G>E.length)return void(F.length>0?e("file",0):e("finish",0));var H=E[B];z=H.table_name,jQuery("#container.wps-page-builder #snapshot-item-table-"+z+" a.snapshot-button-abort").removeClass("hidden"),jQuery("#container.wps-page-builder #snapshot-item-table-"+z+" .wps-spinner").removeClass("hidden"),A={action:"snapshot_backup_ajax","snapshot-proc-action":b,"snapshot-action":n,"snapshot-item":m,"snapshot-data-item":o,"snapshot-blog-id":v,"snapshot-table-data-idx":B,security:j},c=jQuery.ajax({type:"POST",url:ajaxurl,data:A,dataType:"json",error:function(a,b,c){!1!==a.responseText&&""!==a.responseText?(jQuery("#wps-build-error .wps-auth-message p").html(a.responseText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))},success:function(a){if(void 0===a||void 0===a.errorStatus)jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden");else if(!1!==a.errorStatus)void 0===a.errorText?(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#snapshot-ajax-error").append(a.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else if(!1===a.errorStatus||!1===d){if(void 0===a.table_data)void 0!==a.errorText?(jQuery("#snapshot-ajax-error").append(a.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else{H=a.table_data;var b,c=parseInt(H.rows_start)+parseInt(H.rows_end);if(c>0?(b=Math.ceil(c/H.rows_total*100),jQuery("#container.wps-page-builder #snapshot-item-table-"+H.table_name+" .wps-loading-status .wps-loading-bar span").width(b+"%"),jQuery("#container.wps-page-builder #snapshot-item-table-"+H.table_name+" .wps-loading-status .wps-loading-number").html(b+"%")):(b=100,
jQuery("#container.wps-page-builder #snapshot-item-table-"+H.table_name+" .wps-loading-status .wps-loading-bar span").width(b+"%"),jQuery("#container.wps-page-builder #snapshot-item-table-"+H.table_name+" .wps-loading-status .wps-loading-number").html(b+"%")),100===b){jQuery("#container.wps-page-builder #snapshot-item-table-"+H.table_name+" .snapshot-button-abort").hide(),jQuery("#container.wps-page-builder #snapshot-item-table-"+H.table_name+" .wps-spinner").hide(),jQuery("#container.wps-page-builder #snapshot-item-table-"+H.table_name+" .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),D++;var f=Math.min(100,Math.ceil(100*D/C));jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(f+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(f+"%")}void 0!==a.MEMORY&&(void 0!==a.MEMORY.memory_limit&&jQuery("#snapshot-memory-info span.memory-limit").html(a.MEMORY.memory_limit),void 0!==a.MEMORY.memory_usage_current&&jQuery("#snapshot-memory-info span.memory-usage").html(a.MEMORY.memory_usage_current),void 0!==a.MEMORY.memory_usage_peak&&jQuery("#snapshot-memory-info span.memory-peak").html(a.MEMORY.memory_usage_peak))}e("table",G)}}})}else if("file"===b){var I=parseInt(p),J=I+1;if(z=b,J>F.length)return e("finish",0),!1;var K=F[I];jQuery("#snapshot-item-"+z+" .snapshot-filename").html(": "+K),jQuery("#container.wps-page-builder #snapshot-item-"+z+" a.snapshot-button-abort").removeClass("hidden"),jQuery("#container.wps-page-builder #snapshot-item-"+z+" .wps-spinner").removeClass("hidden"),A={action:"snapshot_backup_ajax","snapshot-proc-action":b,"snapshot-action":n,"snapshot-item":m,"snapshot-data-item":o,"snapshot-blog-id":v,"snapshot-file-data-key":K,security:j},c=jQuery.ajax({type:"POST",url:ajaxurl,data:A,dataType:"json",error:function(a,b,c){!1!==a.responseText&&""!==a.responseText?(jQuery("#wps-build-error .wps-auth-message p").html(a.responseText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))},success:function(a){if(void 0===a||void 0===a.errorStatus)jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden");else if(!1!==a.errorStatus)void 0===a.errorText?(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#snapshot-ajax-error").append(a.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else if(!1===a.errorStatus||!1===d){var b;if(J<F.length)b=Math.ceil(J/F.length*100),jQuery("#container.wps-page-builder #snapshot-item-"+z+" .wps-loading-status .wps-loading-bar span").width(b+"%"),jQuery("#container.wps-page-builder #snapshot-item-"+z+" .wps-loading-status .wps-loading-number").html(b+"%");else{D++;var c=Math.min(100,Math.ceil(100*D/C));jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(c+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(c+"%"),b=100,jQuery("#container.wps-page-builder #snapshot-item-"+z+" .wps-loading-status .wps-loading-bar span").width(b+"%"),jQuery("#container.wps-page-builder #snapshot-item-"+z+" .wps-loading-status .wps-loading-number").html(b+"%"),jQuery("#container.wps-page-builder #snapshot-item-"+z+" .wps-loading-status .wps-loading-bar .wps-loader").addClass("done")}100==b&&(jQuery("#container.wps-page-builder #snapshot-item-"+z+" .snapshot-button-abort").hide(),jQuery("#container.wps-page-builder #snapshot-item-"+z+" .wps-spinner").hide(),jQuery("#snapshot-item-"+z+" .snapshot-filename").html("")),void 0!==a.MEMORY&&(void 0!==a.MEMORY.memory_limit&&jQuery("#snapshot-memory-info span.memory-limit").html(a.MEMORY.memory_limit),void 0!==a.MEMORY.memory_usage_current&&jQuery("#snapshot-memory-info span.memory-usage").html(a.MEMORY.memory_usage_current),void 0!==a.MEMORY.memory_usage_peak&&jQuery("#snapshot-memory-info span.memory-peak").html(a.MEMORY.memory_usage_peak)),e("file",J)}}})}else if("finish"==b){z=b,jQuery("#container.wps-page-builder #snapshot-item-table-"+z+" .wps-loading-status .wps-loading-bar span").width("0%"),jQuery("#container.wps-page-builder #snapshot-item-table-"+z+" .wps-loading-status .wps-loading-number").html("0%");var L=jQuery("#container.wps-page-builder #snapshot-item-table-"+z+" .snapshot-text").html();jQuery("#container.wps-page-builder #snapshot-item-table-"+z+" .snapshot-text").html(L+" (creating zip archive of tables)"),A={action:"snapshot_backup_ajax","snapshot-proc-action":b,"snapshot-action":n,"snapshot-item":m,"snapshot-data-item":o,"snapshot-blog-id":v,security:j},c=jQuery.ajax({type:"POST",url:ajaxurl,data:A,dataType:"json",error:function(a,b,c){!1!==a.responseText&&""!==a.responseText?(jQuery("#wps-build-error .wps-auth-message p").html(a.responseText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))},success:function(a){if(void 0===a||void 0===a.errorStatus)jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden");else if(!1!==a.errorStatus)void 0===a.errorText?(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#snapshot-ajax-error").append(a.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else if(!1===a.errorStatus||!1===d){D++;var b=Math.min(100,Math.ceil(100*D/C));jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(b+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(b+"%");jQuery("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-bar span").width("100%"),jQuery("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-number").html("100%"),jQuery("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),jQuery("#container.wps-page-builder #wps-log-process-finish .wps-loading-status").removeClass("wps-spinner"),void 0!==a.MEMORY&&(void 0!==a.MEMORY.memory_limit&&jQuery("#snapshot-memory-info span.memory-limit").html(a.MEMORY.memory_limit),void 0!==a.MEMORY.memory_usage_current&&jQuery("#snapshot-memory-info span.memory-usage").html(a.MEMORY.memory_usage_current),void 0!==a.MEMORY.memory_usage_peak&&jQuery("#snapshot-memory-info span.memory-peak").html(a.MEMORY.memory_usage_peak)),void 0!==a.responseText&&(jQuery("#wps-build-success").removeClass("hidden").find(".wps-auth-message.success").html("<p>"+a.responseText+"</p>"),jQuery("#wps-build-success-view").attr("href",jQuery("#wps-build-success .wps-auth-message.success").find("a").attr("href")),jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))}}})}}d=!1,jQuery('[id^="snapshot-item-table-"]').remove(),jQuery("#snapshot-item-file").remove();var f=[],g=jQuery("input.snapshot-files-option:checked").val(),h="archive",i="",j=jQuery(":hidden#snapshot-ajax-nonce").val();if("none"!==g){if("all"===g);else if("selected"===g&&(jQuery("input.snapshot-backup-sub-options:checked",this).each(function(){f[f.length]=jQuery(this).attr("value")}),0===f.length))return jQuery("#snapshot-ajax-warning").html("<p>"+snapshot_messages.no_files_selected+"</p>").show(),!1;i=jQuery("textarea#snapshot-files-ignore").val(),h=jQuery("input.snapshot-destination-sync:checked").val()}var k=[],l=jQuery("input.snapshot-tables-option:checked").val();if("selected"===l){if(jQuery("input.snapshot-table-item:checked",this).each(function(){var a=jQuery(this).attr("value");k[k.length]=a}),0===k.length)return jQuery("#snapshot-ajax-warning").html("<p>"+snapshot_messages.no_tables_selected+"</p>").show(),!1}else"all"===l&&jQuery("input.snapshot-table-item",this).each(function(){k[k.length]=jQuery(this).attr("value")});if("none"===g&&"none"===l)return jQuery("#snapshot-ajax-error").html("<p>"+snapshot_messages.no_files_tables+"</p>").show(),!1;var m,n=jQuery("input#snapshot-action",this).val();"add"!==n&&"update"!==n||(m=jQuery("input#snapshot-item",this).val());var o=jQuery("input#snapshot-data-item",this).val();if(""===m)return jQuery("#snapshot-ajax-warning").html("<p>"+snapshot_messages.missing_timekey+"</p>").show(),!1;var p=jQuery("input[name=frequency]:checked",this).val(),q="once"!==p?jQuery("select#snapshot-interval",this).val():"immediate";if(!jQuery("#checkbox-run-backup-now",this).is(":checked")&&"immediate"!==q)return!0;b.preventDefault();var r=jQuery("input#snapshot-archive-count",this).val(),s=jQuery("[name=snapshot-destination]:checked",this).val(),t=jQuery("select#snapshot-destination-local",this).val(),u=jQuery("input#snapshot-destination-directory",this).val(),v=0;v=jQuery("select#snapshot-blog-id",this).length>0?jQuery("select#snapshot-blog-id",this).val():jQuery("input#snapshot-blog-id",this).val();var w=jQuery("input#snapshot-name",this).val(),x=jQuery("textarea#snapshot-notes",this).val();g=jQuery("input:radio[name=snapshot-files-option]:checked",this).val();var y=jQuery("#snapshot-clean-remote",this).is(":checked")?"1":"";jQuery("#snapshot-ajax-warning").html("").hide(),jQuery("#snapshot-add-update").addClass("hidden");var z;for(var A in k)if(k.hasOwnProperty(A)){var B=k[A];z=a('<tr id="snapshot-item-table-'+B+'"></tr>').append(a("#wps-log-process-template").html()).find(".wps-log-process.name").html(B).end(),jQuery("tr#wps-log-process-finish").before(z)}"all"!==g&&"selected"!==g||(z=a('<tr id="snapshot-item-file"></tr>').append(a("#wps-log-process-template").html()).find(".wps-log-process.name").html('Files: <span class="snapshot-filename" style="font-style: italic;"></span>').end(),jQuery("tr#wps-log-process-finish").before(z)),jQuery("#container.wps-page-builder").removeClass("hidden");var C=k.length+2,D=0,E=[],F=[];return e("init",0),!0})}}(jQuery),function(a){function b(a){return void 0!==a&&a.length?a.replace(/\\/g,"/").replace(/.*\//,""):a}window.SS_PAGES.snapshot_page_snapshot_pro_snapshots_restore=function(){function c(){return null!==d&&d.abort(),e=!0,a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(snapshot_messages.restore_aborted),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),!1}var d=null,e=!1;a("#wps-show-full-log").on("click",function(b){b.preventDefault(),a("#wps-log").toggle();var c=a(this),d="data-wps-"+(a("#wps-log").is(":visible")?"hide":"show")+"-title";c.text(c.attr(d))}),a("#wps-build-error-again").on("click",function(b){b.preventDefault(),a("#wps-build-error").addClass("hidden"),a("#wps-build-progress").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").addClass("hidden"),a(".wpmud-box-title .wps-title-progress").removeClass("hidden"),a("form#snapshot-edit-restore").submit()}),a("#wps-build-error-back").on("click",function(b){b.preventDefault(),a("#wps-build-error").addClass("hidden"),a("#wps-build-progress").removeClass("hidden"),a("#snapshot-edit-restore").removeClass("hidden"),a("#container.wps-page-builder").addClass("hidden"),a(".wpmud-box-title .wps-title-result").addClass("hidden"),a(".wpmud-box-title .wps-title-progress").removeClass("hidden")}),a("#wps-cancel").off().on("click",function(a){a.preventDefault(),c()}),a("form#snapshot-edit-restore").off().submit(function(){function f(v,w){var x,y;if("init"===v){x=v;var z='<div class="snapshot-item" id="snapshot-item-table-'+x+'"><div class="progress"><div class="percent">0%</div><div class="bar" style="width: 0px;"></div></div><button style="display: none;" class="snapshot-button-abort">Abort</button><div class="snapshot-text">Snapshot determining tables/files to restore</div></div>';a("#snapshot-progress-bar-container").append(z),a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" .progress .bar").width("0%"),a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" .progress .percent").html("0%"),a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" .snapshot-button-abort").show(),a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" button.snapshot-button-abort").click(function(){c()}),y={action:"snapshot_restore_ajax",snapshot_action:v,item_key:g,item_data:u,"snapshot-blog-id":p,"snapshot-files-option":m,"snapshot-files-sections":l,"snapshot-tables-option":o,"snapshot-tables-array":n,snapshot_blog_search:h,security:j},d=a.ajax({type:"POST",url:ajaxurl,data:y,dataType:"json",error:function(b,c,d){!1!==b.responseText&&""!==b.responseText?(a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(b.responseText),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")):(a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a("#wps-build-progress").addClass("hidden"))},success:function(b){var c;if(null!==b)if(void 0!==b.errorStatus)if(!1===b.errorStatus){if(!1===e){var d="init";a("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-bar span").width("100%"),a("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-number").html("100%"),a("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),a("#container.wps-page-builder #wps-log-process-init .snapshot-button-abort").addClass("hidden"),r++;var g=Math.min(100,Math.round(100*r/q));if(a("#wps-build-progress .wps-total-status .wps-loading-number").html(g+"%"),a("#wps-build-progress .wps-total-status .wps-loading-bar span").width(g+"%"),void 0!==b.MANIFEST.TABLES&&Object.keys(b.MANIFEST.TABLES).length){for(d in b.MANIFEST.TABLES)if(b.MANIFEST.TABLES.hasOwnProperty(d)){var h=b.MANIFEST.TABLES[d];c=a('<tr id="snapshot-item-table-'+h.table_name+'"></tr>').append(a("#wps-log-process-template").html()).find(".wps-log-process.name").html(h.label).end(),a("tr#wps-log-process-finish").before(c)}s=b.MANIFEST["TABLES-DATA"]}void 0!==b.MANIFEST["FILES-DATA"]&&Object.keys(b.MANIFEST["FILES-DATA"]).length&&(t=b.MANIFEST["FILES-DATA"],c=a('<tr id="snapshot-item-file"></tr>').append(a("#wps-log-process-template").html()).find(".wps-log-process.name").html('Files: <span class="snapshot-filename" style="font-style: italic;"></span>').end(),a("tr#wps-log-process-finish").before(c)),f("table",0)}}else void 0!==b.errorText&&(a("#wps-build-error .wps-auth-message p").html(b.errorText),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"));else a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden");else a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")}})}else if("table"===v){var A=parseInt(w),B=A+1;if(B>s.length)return void(t.length>0?f("file",0):f("finish",0));var C=s[A];x=C.table_name,a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" button.snapshot-button-abort").show().click(function(){c()}),y={action:"snapshot_restore_ajax",snapshot_action:v,item_key:g,item_data:u,"snapshot-blog-id":p,snapshot_table:x,table_data:C,snapshot_blog_search:h,security:j},d=a.ajax({type:"POST",url:ajaxurl,data:y,timeout:6e5,dataType:"json",error:function(b,c,d){!1!==b.responseText&&""!==b.responseText?(a("#wps-build-error .wps-auth-message p").html(b.responseText),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")):(a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"))},success:function(b){var c;if(a("#snapshot-progress-bar-container").find("#snapshot-item-table-"+x).find(".snapshot-button-abort").hide(),a("#snapshot-progress-bar-container").find("#snapshot-item-table-"+x).find(".wps-spinner").hide(),void 0!==b.errorStatus)if(!1===b.errorStatus){if(!1===e){if(void 0!==b.table_data){C=b.table_data;var d=parseInt(C.rows_start)+parseInt(C.rows_end);if(d>0?(c=Math.ceil(d/C.rows_total*100),a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .wps-loading-status .wps-loading-bar span").width(c+"%"),a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .wps-loading-status .wps-loading-number").html(c+"%")):(c=100,a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .wps-loading-status .wps-loading-bar span").width(c+"%"),a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .wps-loading-status .wps-loading-number").html(c+"%")),100==c){a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .snapshot-button-abort").hide(),a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .wps-spinner").hide(),a("#container.wps-page-builder #snapshot-item-table-"+C.table_name+" .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),r++;var g=Math.min(100,Math.round(100*r/q));a("#wps-build-progress .wps-total-status .wps-loading-number").html(g+"%"),a("#wps-build-progress .wps-total-status .wps-loading-bar span").width(g+"%")}}f("table",B)}}else a("#wps-build-error .wps-auth-message p").html(b.errorText),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden");else a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")}})}else if("file"==v){var D=parseInt(w),E=D+1;if(x=v,E>t.length)return void(t.length>0&&f("finish",0));var F=t[D];F=b(F),a("#snapshot-item-"+x+" .snapshot-filename").html(": "+F),a("#snapshot-progress-bar-container #snapshot-item-file button.snapshot-button-abort").show(),a("#snapshot-progress-bar-container #snapshot-item-file button.snapshot-button-abort").click(function(){c()}),y={action:"snapshot_restore_ajax",snapshot_action:v,item_key:g,item_data:u,file_data_idx:D,"snapshot-blog-id":p,security:j},d=a.ajax({type:"POST",url:ajaxurl,data:y,timeout:6e5,dataType:"json",error:function(b,c,d){!1!==b.responseText&&""!==b.responseText?(a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(b.responseText),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")):(a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"))},success:function(b){var c;if(a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" .snapshot-button-abort").hide(),a("#snapshot-progress-bar-container #snapshot-item-table-"+x+" .wps-spinner").hide(),void 0!==b.errorStatus)if(!1===b.errorStatus){if(!1===e){if(void 0!==b.file_data){if(E<t.length)c=Math.ceil(E/t.length*100),a("#container.wps-page-builder #snapshot-item-"+x+" .wps-loading-status .wps-loading-bar span").width(c+"%"),a("#container.wps-page-builder #snapshot-item-"+x+" .wps-loading-status .wps-loading-number").html(c+"%");else{r++;var d=Math.min(100,Math.round(100*r/q));a("#wps-build-progress .wps-total-status .wps-loading-number").html(d+"%"),a("#wps-build-progress .wps-total-status .wps-loading-bar span").width(d+"%"),c=100,a("#container.wps-page-builder #snapshot-item-"+x+" .wps-loading-status .wps-loading-bar span").width(c+"%"),a("#container.wps-page-builder #snapshot-item-"+x+" .wps-loading-status .wps-loading-number").html(c+"%"),a("#container.wps-page-builder #snapshot-item-"+x+" .wps-loading-status .wps-loading-bar .wps-loader").addClass("done")}100===c&&(a("#snapshot-progress-bar-container #snapshot-item-"+x+" .snapshot-button-abort").hide(),a("#snapshot-progress-bar-container #snapshot-item-"+x+" .wps-spinner").hide(),a("#snapshot-item-"+x+" .snapshot-filename").html(""))}f("file",E)}}else a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(b.errorText),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden");else a("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")}})}else"finish"==v&&(x=v,a("#container.wps-page-builder #snapshot-item-table-"+x+" .wps-loading-status .wps-loading-bar span").width("0%"),a("#container.wps-page-builder #snapshot-item-table-"+x+" .wps-loading-status").addClass("wps-spinner"),a("#container.wps-page-builder #snapshot-item-table-"+x+" .wps-loading-status .wps-loading-number").html("0%"),y={action:"snapshot_restore_ajax",snapshot_action:v,item_key:g,item_data:u,"snapshot-blog-id":p,snapshot_restore_plugin:i,snapshot_restore_theme:k,security:j},d=a.ajax({type:"POST",url:ajaxurl,data:y,dataType:"json",error:function(b,c,d){!1!==b.responseText&&""!==b.responseText?(a("#wps-build-error .wps-auth-message p").html(b.responseText),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")):(a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden"))},success:function(b){if(void 0!==b.errorStatus)if(!1===b.errorStatus){if(!1===e){r++;var c=Math.min(100,Math.round(100*r/q));a("#wps-build-progress .wps-total-status .wps-loading-number").html(c+"%"),a("#wps-build-progress .wps-total-status .wps-loading-bar span").width(c+"%");a("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-bar span").width("100%"),a("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-number").html("100%"),a("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),a("#container.wps-page-builder #wps-log-process-finish .wps-loading-status").removeClass("wps-spinner"),a("#wps-build-success-view").attr("href",a("#wps-build-success .wps-auth-message.success").find("a").attr("href")),a("#wps-build-error").addClass("hidden"),a("#wps-build-progress").addClass("hidden"),void 0!==b.restore_admin_url&&a("a.restored-admin-url").attr("href",b.restore_admin_url),void 0!==b.restore_site_url&&a("a.restored-site-url").attr("href",b.restore_site_url),a("#wps-build-success").removeClass("hidden")}}else a("#wps-build-error .wps-auth-message p").html(b.errorText),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden");else a("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),a("#wps-build-error").removeClass("hidden"),a(".wpmud-box-title .wps-title-result").removeClass("hidden"),a(".wpmud-box-title .wps-title-progress").addClass("hidden"),a("#wps-build-progress").addClass("hidden")}}))}var g=a('input[name="item"]').val(),h=a('input[name="snapshot-blog-id-search"]').val(),i=a("input#snapshot-restore-option-plugins",this).attr("checked"),j=jQuery(":hidden#snapshot-ajax-nonce").val();i="checked"===i?"yes":"no";var k=a('input[name="restore-option-theme"]:checked',this).val(),l=[],m=a("input.snapshot-files-option:checked").val();"all"==m||"selected"==m&&(a("input.snapshot-backup-sub-options:checked",this).each(function(){var b=a(this).attr("value");l[l.length]=b}),0===l.length&&(m="all"));var n=[],o=a("input.snapshot-tables-option:checked").val(),p=a("input#snapshot-blog-id").val();"selected"===o?(a("input.snapshot-table-item:checked",this).each(function(){n[n.length]=a(this).attr("value")}),0===n.length&&(o="all")):"all"===o&&a("input.snapshot-table-item",this).each(function(){n[n.length]=a(this).attr("value")});var q=n.length+2,r=0;a("#snapshot-edit-restore").addClass("hidden"),a("#snapshot-ajax-warning").html(""),a("#snapshot-ajax-warning").hide(),a("#container.wps-page-builder").removeClass("hidden");var s=[],t=[],u=a('input:radio[name="snapshot-restore-file"]').val();return f("init",0),!1})}}(jQuery),function(a){window.SS_PAGES.snapshot_page_snapshot_pro_snapshots=function(){a(".wps-menu-dots").each(function(){var b=a(this),c=b.parent(".wps-menu"),d=a(".wps-menu").not(c);b.on("click",function(){d.removeClass("open"),c[c.hasClass("open")?"removeClass":"addClass"]("open")})}),a("#my-snapshot-all").on("change",function(){a('input[id^="my-snapshot"]').attr("checked",a(this).is(":checked"))}),a("#wps-snapshot-log").find(".wps-popup-close").on("click",function(b){b.preventDefault(),a("#wps-snapshot-log").removeClass("show")}),a("#wps-snapshot-log-view").on("click",function(b){b.preventDefault(),a("#wps-snapshot-log .wps-log-box").html(snapshot_messages.loading+"<br />"),a("#wps-snapshot-log").addClass("show");var c=tb_parseQuery(a("#wps-snapshot-log").attr("data-ajax-src")),d=0,e=setInterval(function(){if(a("#wps-snapshot-log").length&&a("#wps-snapshot-log").is(".show")){var b={action:"snapshot_view_log_ajax","snapshot-item":c["snapshot-item"],"snapshot-data-item":c["snapshot-data-item"],"snapshot-log-position":d,"snapshot-noonce-field":c["snapshot-noonce-field"]};snapshot_ajax_hdl_xhr=jQuery.ajax({type:"POST",url:ajaxurl,cache:!1,data:b,dataType:"json",error:function(a,b,c){clearInterval(e)},success:function(b){0===b.payload.length||b.position>=b.filesize?clearInterval(e):(void 0!==b&&void 0!==b.payload&&(0===d?a("#wps-snapshot-log .wps-log-box").html(b.payload):a("#wps-snapshot-log .wps-log-box").append(b.payload),"1"==c.live&&a("#wps-snapshot-log").length&&a("#wps-snapshot-log .wps-log-box").scrollTop(a("#wps-snapshot-log .wps-log-box")[0].scrollHeight)),void 0!==b&&void 0!==b.position&&d!=b.position&&(d=b.position))}})}else clearInterval(e)},1e3)}),a("body").is(".snapshot_page_snapshot_pro_snapshot_create")||window.SS_PAGES.snapshot_page_snapshot_pro_snapshot_create()}}(jQuery),function(a){SS_UTILS.openModal=function(b,c,d,e){var f=a(a("#ss-modal-template").html());f.find(".wpmud-box-title > h3").html(b),f.find(".wpmud-box-content").html(c),a("#wpbody-content").append(f),a.isFunction(d)&&d(),f.fadeIn(),f.on("click",".wpmud-box-title > .close",function(){f.fadeOut(),setTimeout(function(){f.remove(),a.isFunction(e)&&e()},400)})}}(jQuery);
//# sourceMappingURL=admin.min.js.map