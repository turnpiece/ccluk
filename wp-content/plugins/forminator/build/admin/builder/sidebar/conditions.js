!function(e){formintorjs.define(["text!tpl/builder-sidebar.html"],function(i){return Backbone.View.extend({conditionsTpl:Forminator.Utils.template(e(i).find("#builder-sidebar-conditions-popup-tpl").html()),ruleTpl:Forminator.Utils.template(e(i).find("#builder-sidebar-conditions-rule-tpl").html()),wrappers:!1,conditions:!1,fields:[],className:"fui-conditions",events:{"click .wpmudev-action-done":"close","click .fui-add-condition":"new","click .fui-conditions--delete":"delete","change .fui-conditions--field":"update_field","change .fui-conditions--action":"update_rule","change .fui-conditions--values":"update_value","change .fui-conditions--input":"update_value","change .wpmudev-condition--actions":"update_actions","change .wpmudev-condition--rules":"update_rules"},initialize:function(e){this.wrappers=e.wrappers,this.fields=Forminator.Utils.get_fields(this.wrappers),this.conditions=this.model.get("conditions"),this.render()},render:function(){this.$el.html(this.conditionsTpl({data:this.model.toJSON()})),this.render_conditions(),Forminator.Utils.sui_delegate_events()},render_conditions:function(){var i=this;_.isUndefined(this.conditions)||this.conditions.each(function(t,n){var o=i.conditions.model_index(t),d=_.where(i.fields,{element_id:t.get("element_id")})[0]||{},s=i.ruleTpl({index:o,fields:_.filter(i.fields,function(e){return e.element_id!==i.model.get("element_id")}),field:d,condition:t.toJSON()}),l=e(s),a=i.$el.find(".fui-conditions--rules");l.appendTo(a),t.get("element_id")?d.hasOptions?(l.find(".fui-conditions--wrap-input").hide(),i.update_field_values(l,d,t)):(l.find(".fui-conditions--wrap-values").hide(),i.update_field_input(l,d,t)):(l.find(".fui-conditions--action").prop("disabled",!0),l.find(".fui-conditions--wrap-values").hide(),l.find(".fui-conditions--wrap-input").hide())})},update_field:function(i){var t=e(i.target),n=t.val(),o=(t.closest(".fui-conditions--rule"),this.get_model(t));""!==n?o.set("element_id",n):(o.set("element_id",n),o.set("rule","is"),o.set("value",!1)),this.render()},update_field_values:function(e,i,t){var n=e.find(".fui-conditions--values"),o=i,d=t.get("value");n.empty(),o&&o.values.length&&(n.append(new Option(Forminator.l10n.conditions.select_option,"")),_.each(o.values,function(e,i){var t=e.value;t||(t=e.label),n.append(new Option(e.label,t,!1,d===t))}))},update_field_input:function(e,i,t){var n=e.find(".fui-conditions--input"),o=t.get("value");n.val(o)},update_rule:function(i){var t=e(i.target),n=t.val();this.get_model(t).set("rule",n)},update_value:function(i){var t=e(i.target),n=t.val();this.get_model(t).set("value",n)},update_actions:function(i){var t=e(i.target),n=t.val();this.model.set("condition_action",n)},update_rules:function(i){var t=e(i.target),n=t.val();this.model.set("condition_rule",n)},new:function(e){e.preventDefault(),new_condition=new Forminator.Models.Condition({element_id:"",rule:"is",value:""}),this.conditions.add(new_condition,{silent:!0}),this.render()},delete:function(i){i.preventDefault();var t=e(i.target),n=this.get_model(t);this.conditions.remove(n,{silent:!0}),this.render()},get_model:function(e){var i=e.closest(".fui-conditions--rule").data("index");return this.conditions.get_by_index(i)},close:function(e){e.preventDefault(),this.trigger("conditions:modal:close"),Forminator.Events.trigger("sidebar:settings:updated",this.model)}})})}(jQuery);