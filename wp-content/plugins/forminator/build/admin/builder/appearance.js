!function(a){formintorjs.define(["admin/builder/appearance/appearance-settings","admin/builder/appearance/behaviour-settings","admin/builder/appearance/email-settings","admin/builder/appearance/advanced-settings","admin/builder/appearance/pagination-settings","admin/popup/ajax","text!admin/templates/appearance.html"],function(t,i,e,n,o,r,s){return Backbone.View.extend({mainTpl:Forminator.Utils.template(a(s).find("#appearance-main-tpl").html()),buttonsTpl:Forminator.Utils.template(a(s).find("#appearance-buttons-tpl").html()),events:{"click .forminator-save-changes":"save_changes","click .forminator-save-layout":"save_layout","click .wpmudev-button-back":"back_to_builder","click .wpmudev-preview":"open_preview","change .wpmudev-input,.forminator-field-singular":"set_dirty"},has_pagination:!1,dirty:!1,initialize:function(a){return this.render()},render:function(){var n=this.model.get("wrappers");this.has_pagination=Forminator.Utils.has_pagination(n),Forminator.Events.trigger("forminator:sidebar:close:settings"),this.$el.html(this.mainTpl({has_pagination:this.has_pagination})),this.$el.append(this.buttonsTpl()),this.$el.find(".wpmudev-wizard--content").tabs(),this.$el.find(".wpmudev-tabs-mobile").on("change",function(t){a("."+a(this).val()+" a").click()}),a("#wpmudev-header h1").html(Forminator.l10n.appearance.settings_title);var r={appearance:t,behaviour:i,emails:e};this.has_pagination&&(r.pagination=o),this.append_settings(r);var s=this;a(window).off("beforeunload.forminator-leave-wizard-confirm"),a(window).on("beforeunload.forminator-leave-wizard-confirm",function(a){if(s.dirty)return Forminator.l10n.popup.save_alert}),this.init_select2()},back_to_builder:function(a){Forminator.navigate("builder",{trigger:!0})},cancel_builder:function(a){a.preventDefault(),window.location.href=Forminator.Data.modules.custom_form.form_list_url},open_preview:function(t){t.preventDefault();var i=a(t.target);i.hasClass("wpmudev-preview")||(i=i.closest(".wpmudev-preview"));var e=i.data("modal"),n=i.data("nonce"),o=i.data("form-id");this.open_preview_popup(e,n,o,Forminator.l10n.popup.preview_cforms+" - "+this.model.get("formName"),this.model.toJSON())},open_preview_popup:function(t,i,e,n,o){_.isUndefined(n)&&(n=Forminator.l10n.appearance.preview_form);var s=new r({action:t,nonce:i,data:o,id:e});Forminator.Popup.open(function(){a(this).append(s.el),a(".forminator-design--material").each(function(){var t=a(this),i=t.find(".forminator-input"),e=t.find(".forminator-textarea"),n=t.find(".forminator-product"),o=t.find(".forminator-date"),r=t.find(".forminator-pagination--nav"),s=r.find("li");a('<span class="forminator-nav-border"></span>').insertAfter(s),i.prev(".forminator-field--label").addClass("forminator-floating--input"),e.prev(".forminator-field--label").addClass("forminator-floating--textarea"),o.hasClass("forminator-has_icon")?o.prev(".forminator-field--label").addClass("forminator-floating--date"):o.prev(".forminator-field--label").addClass("forminator-floating--input"),n.closest(".forminator-field").addClass("forminator-product--material"),i.wrap('<div class="forminator-input--wrap"></div>')})},{title:n})},save_changes:function(t){t.preventDefault(),this.validate()?(this.save(!1,!0),a(".wpmudev-preview").show()):(a(".wpmudev-wizard--content").tabs("option","active",0),a("html, body").animate({scrollTop:0},500))},save_layout:function(t){t.preventDefault(),this.validate()?this.save(!0,!0):(a(".wpmudev-wizard--content").tabs("option","active",0),a("html, body").animate({scrollTop:0},500))},save:function(t,i){var e=!1;if(i&&this.$el.find(".forminator-save").addClass("wpmudev-button-onload"),t){this.model.get("is_new")||!1||(this.model.set("is_new",!0),e=!0)}var n=this,o=Forminator.Utils.model_to_json(this.model),r=Forminator.Data.currentForm.formName||this.model.get("formName")||"",s=Forminator.Data.currentForm.formID||-1;a.post({url:Forminator.Data.ajaxUrl,data:{action:"forminator_save_builder_settings",formName:r,formID:s,data:o}}).success(function(a){if(n.dirty=!1,-1===s&&(Forminator.Data.currentForm.formID=a.data),i&&(setTimeout(function(){n.$el.find(".forminator-save").removeClass("wpmudev-button-onload")},500),t||Forminator.Notification.open("success",r+" "+Forminator.l10n.options.been_saved,4e3)),t){var o;e?(o=Forminator.Data.modules.custom_form.form_list_url,window.location.href=o+"&new=true&title="+r.replace(/ /g,"-")):(o=Forminator.Data.modules.custom_form.form_list_url,window.location.href=o+"&notification=true&title="+r.replace(/ /g,"-"))}}).error(function(){Forminator.Notification.open("error",Forminator.l10n.options.error_saving,5e3)})},validate:function(){var a=!1;return _.isEmpty(this.model.get("formName"))?(this.$el.find("#forminator-validate-name").show(),a=!0):this.$el.find("#forminator-validate-name").hide(),!a},init_select2:function(){Forminator.Utils.init_select2()},append_settings:function(a){var t=this;_.each(a,function(a,i){var e=new a({model:t.model});t.$el.find("#forminator-wizard-"+i).append(e.el)})},set_dirty:function(){this.dirty=!0}})})}(jQuery);