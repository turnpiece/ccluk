!function(t){formintorjs.define([],function(){var e=function(t,e,i,r,o){this.initialize(t,e,i,r,o)};return e.prototype={view:!1,model:!1,layout:!1,type:!1,wrapper:!1,$self:!1,$main:!1,$wrapper:!1,$helper:!1,wrappers:!1,drops:!1,drop:!1,timeout:50,time:!1,event:!1,initialize:function(t,e,i,r,o){this.view=t,this.model=e,this.layout=o,this.type=r,this.wrapper=i,this.drops=[],this.drop=!1,Forminator.Events.on("forminator:add:field:click",this.add_with_click,this),this.start()},start:function(){this.$self=this.view.$el,this.$main=t(".wpmudev-builder--form"),this.$self.draggable({revert:!0,revertDuration:0,zIndex:100,helper:"clone",cancel:"",distance:10,appendTo:this.$main,start:t.proxy(this.on_start,this),drag:t.proxy(this.on_drag,this),stop:t.proxy(this.on_stop,this)})},on_start:function(t,e){this.$self.hasClass("wpmudev-form-row")?this.$self.addClass("forminator-row-dragging"):this.$self.addClass("forminator-col-dragging"),this.prepare_drag(),Forminator.Events.trigger("field:drag:start",this.view,this.model)},on_drag:function(t,e){this.event=t,this.update_drop_timeout()},on_stop:function(t,e){this.drop.is_me||this.update_model(),this.reset(),Forminator.Events.trigger("forminator:field:drap:stop",this.view,this.model)},prepare_drag:function(){this.update_variables(),this.$self.css("visibility","hidden"),this.$self.css("position",""),this.$main.addClass("forminator-dragging"),this.$helper.css("width",this.$self.width()),this.$self.hasClass("wpmudev-form-row")&&_.each(this.$self.find(".wpmudev-form-col"),function(e){t(e).css("visibility","hidden")}),this.create_drop_points()},update_variables:function(){this.$wrapper=this.$self.closest(".wpmudev-form-row"),this.$helper=t(".ui-draggable-dragging")},placeholder_drop:function(){var e=t(".wpmudev-form--placeholder"),i=this.get_position(e),r=this.new_id();this.drops.push({id:r,top:i.top,bottom:i.bottom,left:i.left,right:i.right,type:"full",insert:["over",e],wrapper:!1,priority:1}),$drop=t('<div id="forminator-drop-'+r+'" class="forminator-drop-placeholder"></div>'),$drop.css({width:i.right-i.left,height:i.bottom-i.top}),$drop.insertBefore(e)},create_drop_points:function(){var t=this,e=this.get_wrappers(),i=this.layout.get("wrappers");if(latest_wrapper=!1,0===_.size(i))return void this.placeholder_drop();_.each(e,function(e,i){var r=e.view.$el,o=t.get_position(r),s=r.find(".wpmudev-form-col").attr("id"),d=t.view.$el.attr("id"),a=s===d;if(!r.hasClass("forminator-row-dragging")){if(t.drops.push({id:t.new_id(),top:o.top-50,bottom:o.center.y,left:o.left,right:o.right,type:"full",insert:["before",r],wrapper:e,priority:1,is_me:a}),!t.is_row(t.$self)&&!t.has_max_cols(e)){var p,n=e.fields||[];if(_.size(n)<3){_.each(n,function(i){var r=i.view.$el,o=t.get_position(r),s=r.attr("id")===t.view.$el.attr("id");t.drops.push({id:t.new_id(),top:o.top,bottom:o.bottom,left:o.left,right:o.left+o.width,type:"side-before",insert:["before",r],wrapper:e,field:i,priority:5,is_me:s}),p=i});var l=p.view.$el,h=t.get_position(l),f=l.attr("id")===t.view.$el.attr("id");t.drops.push({id:t.new_id(),top:h.top,bottom:h.bottom,left:h.center.x,right:h.right+20,type:"side-after",insert:["after",l],wrapper:e,field:p,priority:5,is_me:f})}}latest_wrapper=e}});var r=latest_wrapper.view.$el,o=t.get_position(r),s=r.find(".wpmudev-form-col").attr("id"),d=t.view.$el.attr("id"),a=s===d;t.drops.push({id:t.new_id(),top:o.center.y,bottom:o.bottom+65,left:o.left,right:o.right,type:"full",insert:["after",r],wrapper:latest_wrapper,priority:1,is_me:a}),this.render_drops()},render_drops:function(){_.each(this.drops,function(e){switch($drop=t('<div id="forminator-drop-'+e.id+'" class="forminator-drop forminator-drop-'+e.type+'"></div>'),e.insert[0]){case"before":$drop.insertBefore(e.insert[1]);break;case"after":$drop.insertAfter(e.insert[1])}"full"==e.type||"inside"==e.type?$drop.css("width",e.right-e.left-20):"side-before"!=e.type&&"side-after"!=e.type||$drop.css("height",e.bottom-e.top-10)})},update_drop_timeout:function(){var e=this,i=_.filter(this.drops,function(t){return e.event.pageY>t.top&&e.event.pageY<t.bottom&&e.event.pageX>t.left&&e.event.pageX<t.right}),r=_.where(i,{priority:_.max(_.pluck(i,"priority"))});r.length>0?this.select_drop_zone(r[0]):(this.drop=!1,t(".forminator-drop-use").removeClass("forminator-drop-use"))},select_drop_zone:function(e){this.drop=e;var i=t("#forminator-drop-"+e.id);t(".forminator-drop-use").removeClass("forminator-drop-use"),i.addClass("forminator-drop-use")},is_row:function(t){return!!t.hasClass("wpmudev-form-row")},has_max_cols:function(t){return!(((t.model.get("fields")||[]).length||0)<3)},get_position:function(e){var i=t(e),r=parseFloat(i.css("width")),o=parseFloat(i.css("height"))-10,s=i.offset(),d=s.top,a=d+o,p=s.left-10,n=p+r,l=Math.round(d+o/2),h=Math.round(p+r/2);if(this.is_row(i)){var f=i.prev();f.length>0&&($prev_data=this.get_position(f),d=$prev_data.center.y+20,o=l-d)}else{var f=i.prev();f.length>0?($prev_data=this.get_position(f),p=$prev_data.center.x):r/=2}return{width:r,height:o,top:d,bottom:a,left:p,right:n,center:{y:l,x:h}}},get_wrappers:function(){return Forminator.Grid||{}},new_id:function(){return Math.floor(9999*Math.random())},reset:function(){this.drops=[],this.drop=!1,t(".forminator-drop").remove(),t(".forminator-drop-view").remove(),t(".forminator-drop-placeholder").remove(),this.$self.css({position:"",top:"",left:"","z-index":"",visibility:"visible"}),this.$self.hasClass("wpmudev-form-row")&&_.each(this.$self.find(".wpmudev-form-col"),function(e){t(e).css("visibility","visible")}),this.$self.hasClass("wpmudev-form-row")?this.$self.removeClass("forminator-row-dragging"):this.$self.removeClass("forminator-col-dragging"),this.$main.removeClass("forminator-dragging")},remove_cols:function(t){t.removeClass("wpmudev-form-col-3"),t.removeClass("wpmudev-form-col-4"),t.removeClass("wpmudev-form-col-6"),t.removeClass("wpmudev-form-col-12")},update_model:function(){if(void 0!==this.drop.insert){this.is_shadow()&&(this.model=this.model.clone_deep(),this.model.set("element_id",Forminator.Utils.get_unique_id("field")));var t=this.drop.insert[0],e=this.drop.wrapper.model,i=this.layout.get("wrappers"),r=!1;if(0===_.size(i)&&(r=!0),"wrapper"===this.type){var o=this.model;this.update_wrapper_position(e,o)}if("field"===this.type)if(void 0===this.drop.field){var o=this.model,s=new Forminator.Models.Wrapper({fields:new Forminator.Collections.Fields(o)});if(s.set("wrapper_id",Forminator.Utils.get_unique_id("wrapper")),o.set("cols",12),i.add(s,{silent:!0}),this.wrapper){var d=this.wrapper.get("fields");d.remove(this.model,{silent:!0}),this.update_old_wrapper(d)}this.update_wrapper_position(e,s)}else{if(this.wrapper&&this.wrapper!==this.drop.wrapper){var d=this.wrapper.get("fields");d.remove(this.model,{silent:!0}),this.update_old_wrapper(d)}var a=e.get("fields"),p=this.drop.field.model,n=a.model_index(p),t=this.drop.insert[0];"after"===t&&n++,this.model.add_to(a,n),this.update_cols(a)}!0===r?Forminator.Events.trigger("dnd:reload:fields"):Forminator.Events.trigger("dnd:models:updated"),Forminator.Events.trigger("forminator:dnd:field:select",this.model.cid),this.activate_field()}},is_me_shadow:function(t){return this.$self.data("shadow")===t},add_with_click:function(t){this.is_me_shadow(t)&&this.update_model_with_click()},update_model_with_click:function(){var t=!1;0===_.size(e)&&(t=!0),this.is_shadow()&&(this.model=this.model.clone_deep(),this.model.set("element_id",Forminator.Utils.get_unique_id("field")));var e=this.layout.get("wrappers"),i=this.model,r=new Forminator.Models.Wrapper({fields:new Forminator.Collections.Fields(i)});r.set("wrapper_id",Forminator.Utils.get_unique_id("wrapper")),i.set("cols",12),e.add(r,{silent:!0}),!0===t?Forminator.Events.trigger("dnd:reload:fields"):Forminator.Events.trigger("dnd:models:updated"),Forminator.Events.trigger("forminator:dnd:field:select",this.model.cid),this.activate_field()},activate_field:function(){Forminator.Events.trigger("forminator:sidebar:open:settings",this.model)},is_shadow:function(){return void 0!==this.$self.data("shadow")},update_old_wrapper:function(t){var e=this.layout.get("wrappers");t.length?this.update_cols(t):e.remove(this.wrapper)},update_cols:function(t){var e=12/t.length;t.update_cols(e)},update_wrapper_position:function(t,e){if(void 0!==this.drop.insert){var i=this.layout.get("wrappers"),r=this.drop.insert[0],o=i.model_index(t),s=i.model_index(e);"after"===r&&o++,s<o&&o--,i.move_to(o,s)}},show_debug_data:function(){var e=this;_.each(this.drops,function(i){var r=t('<div class="forminator-drop-view"><span class="forminator-drop-view-pos"></span></div>');r.css({top:i.top,left:i.left,width:i.right-i.left,height:i.bottom-i.top}),e.$main.append(r)})}},e})}(jQuery);