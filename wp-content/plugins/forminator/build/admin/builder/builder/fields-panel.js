!function(e){formintorjs.define(["admin/builder/drag-drop","admin/builder/builder/field","admin/models/fields-collection","admin/builder/builder/wrapper"],function(i,t,r,d){return Backbone.View.extend({className:"wpmudev-builder--form-wrappers",fields:!1,wrappers:!1,grid:!1,initialize:function(e){return this.listenTo(Forminator.Events,"forminator:dnd:field:select",this.make_field_active),this.listenTo(Forminator.Events,"sidebar:settings:updated",this.settings_updated),this.listenTo(Forminator.Events,"sidebar:clone:field",this.clone_field),this.listenTo(Forminator.Events,"sidebar:delete:field",this.delete_field),this.render()},render:function(){var e=this;this.$el.html("");var r=0;this.wrappers=this.model.get("wrappers"),this.grid={},this.wrappers.each(function(s){var n=s.get("fields"),o=new d({model:s});e.$el.append(o.$el),e.grid[r]=new i(o,s,!1,"wrapper",e.model),e.grid[r].fields={},n.each(function(d){var n=new t({model:d,layout:e.model});o.$el.append(n.$el),e.grid[r].fields[d.get("id")]=new i(n,d,s,"field",e.model)}),r++}),Forminator.Grid=this.grid},clone_field:function(e){var i=this.get_wrapper_by_field(e),t=this.wrappers.model_index(i),r=e.clone_deep(),d=new Forminator.Models.Wrapper({fields:new Forminator.Collections.Fields(r)});d.set("wrapper_id",Forminator.Utils.get_unique_id("wrapper")),d.set("cols",12),d.set("element_id",Forminator.Utils.get_unique_id("field")),this.wrappers.add(d,{silent:!0});var s=this.wrappers.model_index(d);this.wrappers.move_to(t+1,s),Forminator.Events.trigger("forminator:sidebar:open:settings",r),this.render(),this.make_field_active(r.cid)},get_wrapper_by_field:function(e){var i=!1;return this.wrappers.each(function(t){t.get("fields").each(function(r){r.get_id()===e.get_id()&&(i=t)})}),i},delete_field:function(i){var t=this.get_wrapper_by_field(i);if(!1!==t){var r=t.get("fields"),d=(this.wrappers.model_index(t),t.fields_count());if(r.remove(i,{silent:!0}),d>1){var s=12/r.length;r.update_cols(s)}else this.wrappers.remove(t,{silent:!0});e("#wpmudev-sidebar-settings").find(".wpmudev-sidebar").removeClass("wpmudev-is_active"),Forminator.Events.trigger("forminator:sidebar:close:settings"),Forminator.Events.trigger("dnd:reload:fields")}},settings_updated:function(e){e.trigger("forminator:field:settings:updated");var i=Forminator.Utils.get_fields_models(this.wrappers,[e.cid]),t=new r(i),d=t.get_fields_related_to(e);_.each(d,function(e){e.trigger("forminator:field:settings:updated")}),this.make_field_active(e.cid)},make_field_active:function(i){var t=e("#wpmudev-field-"+i+" .wpmudev-form-field");t.addClass("wpmudev-is_active"),e("html, body").animate({scrollTop:t.offset().top-(e(window).height()-t.outerHeight(!0))/2},0)}})})}(jQuery);