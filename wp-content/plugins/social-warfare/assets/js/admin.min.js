var socialWarfareAdmin=socialWarfareAdmin||{},swpWidget,widgetSubmit;!function(e,t){"use strict";function a(e,a){var i=t("#social_warfare #"+e),r=i.parent(),s=a-i.val().length;if("swp_custom_tweet"==e){var o=0;if(t("#sample-permalink").length?o=t("#sample-permalink").text().length:t("#wp-admin-bar-view a").length&&(o=t("#wp-admin-bar-view a").attr("href").length),t("#swp-twitter-handle").length){s-=t("#swp-twitter-handle").text().length}s-=o}s>=0?r.find(".swp_CountDown").removeClass("swp_red").addClass("swp_blue"):r.find(".swp_CountDown").removeClass("swp_blue").addClass("swp_red"),r.find(".counterNumber").text(s)}function i(){t(".swp-notice-cta").on("click",function(a){a.preventDefault();var i=a.target.getAttribute("href");"string"==typeof i&&i.length&&e.open(i);var r=t(this).parents(".swp-dismiss-notice");t.post({url:ajaxurl,data:{action:"dismiss",key:r.data("key"),timeframe:this.dataset.timeframe},success:function(e){(e=JSON.parse(e))&&r.slideUp(500)}})})}function r(e){e.preventDefault();var a=!("on"==t(this).attr("status")),i=t(this).attr("field"),r=t(i);a?(t(this).attr("status","on"),r.prop("checked",!0).prop("value",!0)):(t(this).attr("status","off"),r.prop("checked",!1).prop("value",!1))}function s(e){var a={top:"-25px",position:"relative"};t("#"+e).css("border-top-right-radius",0).parent().css(a)}function o(e,a){var i='<div class="swp_CountDown"><span class="counterNumber">'+-a+"</span></div>";s(e),t("#social_warfare #"+e).parent().prepend(i)}function n(e){var a=["full-width","left","right"],i=t(e).data("type");a.forEach(function(a){var r=".swpmb-"+a;if(t(e).find(r)){var s=t(e).find(r).filter(function(e,a){return t(a).hasClass(i)});if(s.length){var o=t(e).find(r+"-wrap");t(o).append(s)}}})}function l(){t(".swpmb-meta-container[data-type]").map(function(e,a){var i=t(this).data("type");if(i){var r=t(".swpmb-field."+i);r.length&&t(this).append(r),n(a)}})}function c(){var e={swp_og_title:60,swp_og_description:150,swp_pinterest_description:500,swp_custom_tweet:280};Object.keys(e).map(function(i){var r=e[i];o(i,r),a(i,r),t("#social_warfare #"+i).on("input",function(){a(i,r)})})}function d(){t("[field=#swp_twitter_use_open_graph]").click(function(e){var a=t("#swp_twitter_use_open_graph");"true"==a.attr("value")?(t(".swpmb-meta-container[data-type=twitter]").slideUp(),a.attr("value","true")):(t(".swpmb-meta-container[data-type=twitter]").slideDown(),a.attr("value","false")),socialWarfareAdmin.resizeImageFields()})}function p(){if(t(t(".swpmb-media-list").length)){clearInterval(e.initSWMetabox),l(),setTimeout(socialWarfareAdmin.resizeImageFields,600),setTimeout(socialWarfareAdmin.resizeImageFields,1400),setTimeout(socialWarfareAdmin.resizeImageFields,3e3);"false"==t("#swp_twitter_use_open_graph").val()?t(".swpmb-meta-container[data-type=twitter]").slideDown():t(".swpmb-meta-container[data-type=twitter]").slideUp(),d(),t("ul.swpmb-media-list").find(".swpmb-overlay").click(socialWarfareAdmin.resizeImageFields),t("#social_warfare.ui-sortable-handle").click(socialWarfareAdmin.resizeImageFields),socialWarfareAdmin.addImageEditListeners(),t("#social_warfare.postbox").show()}}if("function"!=typeof t)if("function"==typeof jQuery)t=jQuery;else{if("function"!=typeof e.jQuery)return void console.log("Social Warfare requires jQuery, or $ as an alias of jQuery. Please make sure your theme provides access to jQuery before activating Social Warfare.");t=e.jQuery}if(socialWarfareAdmin.conditionalFields=function(){function a(e){return t('select[name="'+e+'"]').val()}function i(e){return"true"===e&&(e=!0),"false"===e&&(e=!1),e}void 0===t&&(t=jQuery),t("[data-dep]").each(function(){var a=t(this).data("dep"),r=JSON.parse(JSON.stringify(t(this).data("dep_val")));if(-1===e.location.href.indexOf("page=social-warfare"))var s=t(this).parents(".widgets-holder-wrap").find('[data-swp-name="'+a+'"]');else var s=t('[name="'+a+'"]')[0];var o;void 0===s&&void 0===(s=t('[name="'+a+'"]')[0])&&(s=t("[field$="+a+"]")[0]),o="checkbox"==t(s).attr("type")?t(s).prop("checked"):t(s).val(),o=i(o),-1!==e.location.href.indexOf("page=social-warfare")?-1!==t.inArray(o,r)&&t(s).parent(".sw-grid").is(":visible")?t(this).show():t(this).hide():-1!==t.inArray(o,r)||o===r?t(this).show():t(this).hide()}),!1===function(e){return t('[name="'+e+'"]').prop("checked")}("float_style_source")&&"custom_color"===a("float_default_colors")||"custom_color_outlines"===a("float_default_colors")||"custom_color"===a("float_single_colors")||"custom_color_outlines"===a("float_single_colors")||"custom_color"===a("float_hover_colors")||"custom_color_outlines"===a("float_hover_colors")?t(".sideCustomColor_wrapper").slideDown():t(".sideCustomColor_wrapper").slideUp()},e.location.href.indexOf("widgets.php")>-1)var f=setInterval(function(){void 0!==swpWidget&&clearInterval(f),swpWidget=t("#widgets-right [id*=_swp_popular_posts_widget], [id*=_swp_popular_posts_widget].open")[0],widgetSubmit=t(swpWidget).find("[id$=savewidget]")[0],t(swpWidget).on("click",socialWarfareAdmin.conditionalFields),t(widgetSubmit).on("click",function(){setTimeout(socialWarfareAdmin.conditionalFields,600)})},50);socialWarfareAdmin.linkLength=function(e){for(var t="",a=0;a<23;a++)t+="o";return e.replace(/(http:\/\/[\S]*)/g,t).length},socialWarfareAdmin.resizeImageFields=function(){t("ul.swpmb-media-list").each(function(e,a){if(t(a).is(":empty")){if(t(a).parents(".swpmb-field").attr("class").indexOf("pinterest")>0)var i=1.5*t(a).width();else var i=t(a).width()*(9/16);t(a).css("height",i)}else t(a).css("height","initial")})},socialWarfareAdmin.addImageEditListeners=function(){t(".swpmb-edit-media, .swpmb-remove-media").off(socialWarfareAdmin.resizeImageFields),t(".swpmb-edit-media, .swpmb-remove-media").on(socialWarfareAdmin.resizeImageFields)},socialWarfareAdmin.revokeNetworkConnection=function(a){var i,r,s,o;i=a.target,i=t(a.target).is("div")?a.target.parentNode:a.target,r=i.className.indexOf("swp-network"),r=1+i.className.indexOf("-",4+r),s=i.className.slice(r),r=s.indexOf(" "),o=-1==r?s:s.slice(0,r),t.post({url:ajaxurl,data:{action:"swp_delete_network_tokens",network:o},success:function(t){var a=JSON.parse(t);a.ok?e.location.href=a.url:console.log("bad response",a)}})},socialWarfareAdmin.triggerDeletePostMeta=function(t){t.preventDefault();var a=e.prompt("This will delete all Social Warfare meta keys for this post, including Open Graph, Twitter, and Pinterest descriptions and images. If you want to keep these, please copy them to an offline file first, and paste them back in after the reset. To reset, enter reset_post_meta","reset_or_cancel");console.log("prompt",a),"reset_post_meta"==a&&jQuery.post({url:ajaxurl,data:{action:"swp_reset_post_meta",post_id:socialWarfare.post_id},complete:function(e){socialWarfareAdmin.resetMetaFields()}})},socialWarfareAdmin.resetMetaFields=function(){t("#social_warfare.postbox").find("input[type=text], textarea").val(""),t("#social_warfare.postbox").find("select").val("default")},socialWarfareAdmin.addEventListeners=function(){t(".swp-revoke-button").on("click",socialWarfareAdmin.revokeNetworkConnection),t("#swp_reset_button").on("click",socialWarfareAdmin.triggerDeletePostMeta)},socialWarfareAdmin.createResetButton=function(){var e=t("#swp_reset_button"),a=jQuery('<button class="button">Reset Post Meta</button>');a.on("click",socialWarfareAdmin.triggerDeletePostMeta),e.after(a)},t(document).ready(function(){i(),t("#social_warfare.postbox").length&&(c(),socialWarfareAdmin.createResetButton(),socialWarfareAdmin.conditionalFields(),t(".sw-checkbox-toggle.swp-post-editor").click(r),t(".swp_popular_post_options select").on("change",socialWarfareAdmin.conditionalFields),e.initSWMetabox=setInterval(p,10)),socialWarfareAdmin.addEventListeners()})}(this,jQuery);