var openGroups=[],focusedEl=null;jQuery.fn.spinDown=function(){return this.click(function(){var e=jQuery(this);return e.next().slideToggle(100),e.parent().siblings().children(".state-active").click(),e.prev().toggleClass("not-active"),e.find(".icon").toggleClass("icon-triangle-1-s").end().toggleClass("state-active"),e.find(".ui-icon").toggleClass("ui-icon-triangle-1-s").end().toggleClass("ui-state-active"),e.is(".corner-all")?e.removeClass("corner-all").addClass("corner-top"):e.is(".corner-top")&&e.removeClass("corner-top").addClass("corner-all"),e.is(".ui-corner-all")?e.removeClass("ui-corner-all").addClass("ui-corner-top"):e.is(".ui-corner-top")&&e.removeClass("ui-corner-top").addClass("ui-corner-all"),!1})},jQuery.fn.validHex=function(){return this.each(function(){var e=jQuery(this).val();e=e.replace(/[^#a-fA-F0-9]/g,""),e.match(/#/g)&&e.match(/#/g).length>1&&(e=e.replace(/#/g,"")),e.indexOf("#")==-1&&(e="#"+e),e.length>7&&(e=e.substr(0,7)),jQuery(this).val(e)})},jQuery.fn.applyFarbtastic=function(){return this.each(function(){jQuery("<div/>").farbtastic(this).remove()})},jQuery(document).ready(function(e){jQuery(".state-default").hover(function(){jQuery(this).addClass("state-hover")},function(){jQuery(this).removeClass("state-hover")}),e("div.theme-group .theme-group-header").addClass("corner-all").spinDown(),e("input, select").focus(function(){e("input.focus, select.focus").removeClass("focus"),e(this).addClass("focus")}).blur(function(){e(this).removeClass("focus")}),e("input.hex").validHex().keyup(function(){e(this).validHex()}).click(function(){return e(this).addClass("focus"),e("#picker").remove(),e("div.picker-on").removeClass("picker-on"),e("div.texturePicker ul:visible").hide(0).parent().css("position","static"),e(this).after('<div id="picker"></div>').parent().addClass("picker-on"),e("#picker").farbtastic(this),!1}).wrap('<div class="hasPicker"></div>').applyFarbtastic(),e("body").click(function(){e("div.picker-on").removeClass("picker-on"),e("#picker").remove(),e("input.focus, select.focus").removeClass("focus"),e("div.texturePicker ul:visible").hide().parent().css("position","static")})}),jQuery.fn.farbtastic=function(e){return jQuery.farbtastic(this,e),this},jQuery.farbtastic=function(e,t){var e=jQuery(e).get(0);return e.farbtastic||(e.farbtastic=new jQuery._farbtastic(e,t))},jQuery._farbtastic=function(e,t){var r=this;jQuery(e).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var o=jQuery(".farbtastic",e);r.wheel=jQuery(".wheel",e).get(0),r.radius=84,r.square=100,r.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&jQuery("*",o).each(function(){if("none"!=this.currentStyle.backgroundImage){var e=this.currentStyle.backgroundImage;e=this.currentStyle.backgroundImage.substring(5,e.length-2),jQuery(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+e+"')"})}}),r.linkTo=function(e){return"object"==typeof r.callback&&jQuery(r.callback).unbind("keyup",r.updateValue),r.color=null,"function"==typeof e?r.callback=e:"object"!=typeof e&&"string"!=typeof e||(r.callback=jQuery(e),r.callback.bind("keyup",r.updateValue),r.callback.get(0).value&&r.setColor(r.callback.get(0).value)),this},r.updateValue=function(e){this.value&&this.value!=r.color&&r.setColor(this.value)},r.setColor=function(e){var t=r.unpack(e);return r.color!=e&&t&&(r.color=e,r.rgb=t,r.hsl=r.RGBToHSL(r.rgb),r.updateDisplay()),this},r.setHSL=function(e){return r.hsl=e,r.rgb=r.HSLToRGB(e),r.color=r.pack(r.rgb),r.updateDisplay(),this},r.widgetCoords=function(e){var t,o,a=e.target||e.srcElement,s=r.wheel;if("undefined"!=typeof e.offsetX){for(var i={x:e.offsetX,y:e.offsetY},n=a;n;)n.mouseX=i.x,n.mouseY=i.y,i.x+=n.offsetLeft,i.y+=n.offsetTop,n=n.offsetParent;for(var n=s,u={x:0,y:0};n;){if("undefined"!=typeof n.mouseX){t=n.mouseX-u.x,o=n.mouseY-u.y;break}u.x+=n.offsetLeft,u.y+=n.offsetTop,n=n.offsetParent}for(n=a;n;)n.mouseX=void 0,n.mouseY=void 0,n=n.offsetParent}else{var i=r.absolutePosition(s);t=(e.pageX||0*(e.clientX+jQuery("html").get(0).scrollLeft))-i.x,o=(e.pageY||0*(e.clientY+jQuery("html").get(0).scrollTop))-i.y}return{x:t-r.width/2,y:o-r.width/2}},r.mousedown=function(e){document.dragging||(jQuery(document).bind("mousemove",r.mousemove).bind("mouseup",r.mouseup),document.dragging=!0);var t=r.widgetCoords(e);return r.circleDrag=2*Math.max(Math.abs(t.x),Math.abs(t.y))>r.square,r.mousemove(e),!1},r.mousemove=function(e){var t=r.widgetCoords(e);if(r.circleDrag){var o=Math.atan2(t.x,-t.y)/6.28;o<0&&(o+=1),r.setHSL([o,r.hsl[1],r.hsl[2]])}else{var a=Math.max(0,Math.min(1,-(t.x/r.square)+.5)),s=Math.max(0,Math.min(1,-(t.y/r.square)+.5));r.setHSL([r.hsl[0],a,s])}return!1},r.mouseup=function(){jQuery(document).unbind("mousemove",r.mousemove),jQuery(document).unbind("mouseup",r.mouseup),document.dragging=!1},r.updateDisplay=function(){var e=6.28*r.hsl[0];jQuery(".h-marker",o).css({left:Math.round(Math.sin(e)*r.radius+r.width/2)+"px",top:Math.round(-Math.cos(e)*r.radius+r.width/2)+"px"}),jQuery(".sl-marker",o).css({left:Math.round(r.square*(.5-r.hsl[1])+r.width/2)+"px",top:Math.round(r.square*(.5-r.hsl[2])+r.width/2)+"px"}),jQuery(".color",o).css("backgroundColor",r.pack(r.HSLToRGB([r.hsl[0],1,.5]))),"object"==typeof r.callback?(jQuery(r.callback).css({backgroundColor:r.color,color:r.hsl[2]>.5?"#000":"#fff"}),jQuery(r.callback).each(function(){this.value&&this.value!=r.color&&(this.value=r.color,jQuery(this).change())})):"function"==typeof r.callback&&r.callback.call(r,r.color)},r.absolutePosition=function(e){var t={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var o=r.absolutePosition(e.offsetParent);t.x+=o.x,t.y+=o.y}return t},r.pack=function(e){var t=Math.round(255*e[0]),r=Math.round(255*e[1]),o=Math.round(255*e[2]);return"#"+(t<16?"0":"")+t.toString(16)+(r<16?"0":"")+r.toString(16)+(o<16?"0":"")+o.toString(16)},r.unpack=function(e){return 7==e.length?[parseInt("0x"+e.substring(1,3))/255,parseInt("0x"+e.substring(3,5))/255,parseInt("0x"+e.substring(5,7))/255]:4==e.length?[parseInt("0x"+e.substring(1,2))/15,parseInt("0x"+e.substring(2,3))/15,parseInt("0x"+e.substring(3,4))/15]:void 0},r.HSLToRGB=function(e){var t,r,o=e[0],a=e[1],s=e[2];return r=s<=.5?s*(a+1):s+a-s*a,t=2*s-r,[this.hueToRGB(t,r,o+.33333),this.hueToRGB(t,r,o),this.hueToRGB(t,r,o-.33333)]},r.hueToRGB=function(e,t,r){return r=r<0?r+1:r>1?r-1:r,6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(.66666-r)*6:e},r.RGBToHSL=function(e){var t,r,o,a,s,i,n=e[0],u=e[1],c=e[2];return t=Math.min(n,Math.min(u,c)),r=Math.max(n,Math.max(u,c)),o=r-t,i=(t+r)/2,s=0,i>0&&i<1&&(s=o/(i<.5?2*i:2-2*i)),a=0,o>0&&(r==n&&r!=u&&(a+=(u-c)/o),r==u&&r!=c&&(a+=2+(c-n)/o),r==c&&r!=n&&(a+=4+(n-u)/o),a/=6),[a,s,i]},jQuery("*",o).mousedown(r.mousedown),r.setColor("#000000"),t&&r.linkTo(t)};
