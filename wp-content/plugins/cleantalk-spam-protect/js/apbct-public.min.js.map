{"version":3,"sources":["apbct-public.js"],"names":["ct_date","Date","ctTimeMs","getTime","ctMouseEventTimerFlag","ctMouseData","ctMouseDataCounter","ctSetCookieSec","c_name","value","document","cookie","encodeURIComponent","apbct_attach_event_handler","elem","event","callback","window","addEventListener","attachEvent","apbct_remove_event_handler","removeEventListener","detachEvent","Math","floor","setTimeout","getTimezoneOffset","ctFunctionFirstKey","ctKeyStopStopListening","ctMouseReadInterval","setInterval","ctMouseWriteDataInterval","JSON","stringify","ctFunctionMouseMove","push","round","clientY","clientX","ctMouseStopData","clearInterval","apbct_ready","i","forms","length","form","onsubmit_prev","onsubmit","elements","key","this","isNaN","visible_fields_count","filter","getComputedStyle","display","visibility","opacity","getAttribute","forEach","el","j","els","visible_fields","trim","target","Function","call","apbct_js_keys__set_input_value","result","data","params","obj","getElementById","input_name","ct_input_value","replace","js_key","apbct_sendAJAXRequest","notJson","timeout","_ajax_nonce","ctPublic","jQuery","ajax","type","url","_ajax_url","success","parse","error","jqXHR","textStatus","errorThrown","console","log","ajaxComplete","xhr","settings","response","responseText","indexOf","apbct","blocked","alert","comment"],"mappings":"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","file":"apbct-public.min.js","sourcesContent":["var ct_date = new Date(), \r\n\tctTimeMs = new Date().getTime(),\r\n\tctMouseEventTimerFlag = true, //Reading interval flag\r\n\tctMouseData = [],\r\n\tctMouseDataCounter = 0;\r\n\r\nfunction ctSetCookieSec(c_name, value) {\r\n\tdocument.cookie = c_name + \"=\" + encodeURIComponent(value) + \"; path=/\";\r\n}\r\n\r\nfunction apbct_attach_event_handler(elem, event, callback){\r\n\tif(typeof window.addEventListener === \"function\") elem.addEventListener(event, callback);\r\n\telse                                              elem.attachEvent(event, callback);\r\n}\r\n\r\nfunction apbct_remove_event_handler(elem, event, callback){\r\n\tif(typeof window.removeEventListener === \"function\") elem.removeEventListener(event, callback);\r\n\telse                                                 elem.detachEvent(event, callback);\r\n}\r\n\r\nctSetCookieSec(\"ct_ps_timestamp\", Math.floor(new Date().getTime()/1000));\r\nctSetCookieSec(\"ct_fkp_timestamp\", \"0\");\r\nctSetCookieSec(\"ct_pointer_data\", \"0\");\r\nctSetCookieSec(\"ct_timezone\", \"0\");\r\n\r\nsetTimeout(function(){\r\n\tctSetCookieSec(\"ct_timezone\", ct_date.getTimezoneOffset()/60*(-1));\r\n},1000);\r\n\r\n//Writing first key press timestamp\r\nvar ctFunctionFirstKey = function output(event){\r\n\tvar KeyTimestamp = Math.floor(new Date().getTime()/1000);\r\n\tctSetCookieSec(\"ct_fkp_timestamp\", KeyTimestamp);\r\n\tctKeyStopStopListening();\r\n};\r\n\r\n//Reading interval\r\nvar ctMouseReadInterval = setInterval(function(){\r\n\tctMouseEventTimerFlag = true;\r\n}, 150);\r\n\t\r\n//Writting interval\r\nvar ctMouseWriteDataInterval = setInterval(function(){\r\n\tctSetCookieSec(\"ct_pointer_data\", JSON.stringify(ctMouseData));\r\n}, 1200);\r\n\r\n//Logging mouse position each 150 ms\r\nvar ctFunctionMouseMove = function output(event){\r\n\tif(ctMouseEventTimerFlag === true){\r\n\t\t\r\n\t\tctMouseData.push([\r\n\t\t\tMath.round(event.clientY),\r\n\t\t\tMath.round(event.clientX),\r\n\t\t\tMath.round(new Date().getTime() - ctTimeMs)\r\n\t\t]);\r\n\t\t\r\n\t\tctMouseDataCounter++;\r\n\t\tctMouseEventTimerFlag = false;\r\n\t\tif(ctMouseDataCounter >= 50){\r\n\t\t\tctMouseStopData();\r\n\t\t}\r\n\t}\r\n};\r\n\r\n//Stop mouse observing function\r\nfunction ctMouseStopData(){\r\n\tapbct_remove_event_handler(window, \"mousemove\", ctFunctionMouseMove);\r\n\tclearInterval(ctMouseReadInterval);\r\n\tclearInterval(ctMouseWriteDataInterval);\t\t\t\t\r\n}\r\n\r\n//Stop key listening function\r\nfunction ctKeyStopStopListening(){\r\n\tapbct_remove_event_handler(window, \"mousedown\", ctFunctionFirstKey);\r\n\tapbct_remove_event_handler(window, \"keydown\", ctFunctionFirstKey);\r\n}\r\n\r\napbct_attach_event_handler(window, \"mousemove\", ctFunctionMouseMove);\r\napbct_attach_event_handler(window, \"mousedown\", ctFunctionFirstKey);\r\napbct_attach_event_handler(window, \"keydown\", ctFunctionFirstKey);\r\n\r\n// Ready function\r\nfunction apbct_ready(){\r\n\tctSetCookieSec(\"apbct_visible_fields\", 0);\r\n\tctSetCookieSec(\"apbct_visible_fields_count\", 0);\r\n\tsetTimeout(function(){\r\n\t\tfor(var i = 0; i < document.forms.length; i++){\r\n\t\t\tvar form = document.forms[i];\r\n\r\n\t\t\tform.onsubmit_prev = form.onsubmit;\r\n\t\t\tform.onsubmit = function(event){\r\n\t\t\t\t\r\n\t\t\t\t// Get only fields\r\n\t\t\t\tvar elements = [];\r\n\t\t\t\tfor(var key in this.elements){\r\n\t\t\t\t\tif(!isNaN(+key))\r\n\t\t\t\t\t\telements[key] = this.elements[key];\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// Filter fields\r\n\t\t\t\telements = elements.filter(function(elem){\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar pass = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Filter fields\r\n\t\t\t\t\tif( getComputedStyle(elem).display    === \"none\" ||   // hidden\r\n\t\t\t\t\t\tgetComputedStyle(elem).visibility === \"hidden\" || // hidden\r\n\t\t\t\t\t\tgetComputedStyle(elem).opacity    === \"0\" ||      // hidden\r\n\t\t\t\t\t\telem.getAttribute(\"type\")         === \"hidden\" || // type == hidden\r\n\t\t\t\t\t\telem.getAttribute(\"type\")         === \"submit\" || // type == submit\r\n\t\t\t\t\t\telem.value                        === \"\"          // empty value\r\n\t\t\t\t\t){\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Filter elements with same names for type == radio\r\n\t\t\t\t\tif(elem.getAttribute(\"type\") === \"radio\"){\r\n\t\t\t\t\t\telements.forEach(function(el, j, els){\r\n\t\t\t\t\t\t\tif(elem.getAttribute('name') === el.getAttribute('name')){\r\n\t\t\t\t\t\t\t\tpass = false;\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// Visible fields count\r\n\t\t\t\tvar visible_fields_count = elements.length;\r\n\t\t\t\t\r\n\t\t\t\t// Visible fields\r\n\t\t\t\tvar visible_fields = '';\r\n\t\t\t\telements.forEach(function(elem, i, elements){\r\n\t\t\t\t\tvisible_fields += \" \" + elem.getAttribute(\"name\");\r\n\t\t\t\t});\r\n\t\t\t\tvisible_fields = visible_fields.trim();\r\n\t\t\t\t\r\n\t\t\t\tctSetCookieSec(\"apbct_visible_fields\", visible_fields);\r\n\t\t\t\tctSetCookieSec(\"apbct_visible_fields_count\", visible_fields_count);\r\n\t\t\t\t\r\n\t\t\t\t// Call previous submit action\r\n\t\t\t\tif(event.target.onsubmit_prev instanceof Function){\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\tevent.target.onsubmit_prev.call(event.target, event);\r\n\t\t\t\t\t}, 500);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}, 1000);\r\n}\r\napbct_attach_event_handler(window, \"DOMContentLoaded\", apbct_ready);\r\n\r\n// Capturing responses and output block message for unknown AJAX forms\r\njQuery(document).ajaxComplete(function(event, xhr, settings) {\r\n\tif(xhr.responseText && xhr.responseText.indexOf('\"apbct') !== -1){\r\n\t\tvar response = JSON.parse(xhr.responseText);\r\n\t\tif(typeof response.apbct !== 'undefined'){\r\n\t\t\tvar response = response.apbct;\r\n\t\t\tif(response.blocked){\r\n\t\t\t\talert(response.comment);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\nfunction apbct_js_keys__set_input_value(result, data, params, obj){\r\n\tif (document.getElementById(params.input_name) !== null) {\r\n\t\tvar ct_input_value = document.getElementById(params.input_name).value;\r\n\t\tdocument.getElementById(params.input_name).value = document.getElementById(params.input_name).value.replace(ct_input_value, result.js_key);\r\n\t}\r\n}\r\n\r\nfunction apbct_sendAJAXRequest(data, params, obj){\r\n\t\r\n\t// Default params\r\n\tvar callback    = params.callback    || null;\r\n\tvar notJson     = params.notJson     || null;\r\n\tvar timeout     = params.timeout     || 15000;\r\n\tvar obj         = obj                || null;\r\n\t\r\n\tdata._ajax_nonce = ctPublic._ajax_nonce;\r\n\t\r\n\tjQuery.ajax({\r\n\t\ttype: \"POST\",\r\n\t\turl: ctPublic._ajax_url,\r\n\t\tdata: data,\r\n\t\tsuccess: function(result){\r\n\t\t\tif(!notJson) result = JSON.parse(result);\r\n\t\t\tif(result.error){\r\n\t\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\tif(callback)\r\n\t\t\t\t\tcallback(result, data, params, obj);\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function(jqXHR, textStatus, errorThrown){\r\n\t\t\tconsole.log('APBCT_AJAX_ERROR');\r\n\t\t\tconsole.log(data);\r\n\t\t\tconsole.log(jqXHR);\r\n\t\t\tconsole.log(textStatus);\r\n\t\t\tconsole.log(errorThrown);\r\n\t\t},\r\n\t\ttimeout: timeout\r\n\t});\r\n}\r\n\r\n//(function(open) {\r\n//    XMLHttpRequest.prototype.open = function(method, url, async, user, pass) {\r\n//        this.addEventListener(\"readystatechange\", function() {\r\n//        }, false);\r\n//        open.call(this, method, url, async, user, pass);\r\n//    };\r\n//})(XMLHttpRequest.prototype.open);"]}