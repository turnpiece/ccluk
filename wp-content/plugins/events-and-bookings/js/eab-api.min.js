/*! Events and Bookings - v1.9.6
 * http://premium.wpmudev.org/project/events-and-booking
 * Copyright (c) 2017; * Licensed GPLv2+ */

!function(a){function b(b){var c=0;try{c=parseInt(b.status,10)}catch(a){c=0}if(!c)return a("#eab-wordpress_login-registration_wrapper").is(":visible")?a("#eab-wordpress-signup-status").text(l10nEabApi.wp_signup_error):a("#eab-wordpress_login-login_wrapper").is(":visible")&&a("#eab-wordpress-login-status").text(l10nEabApi.wp_username_pass_invalid),!1;var d=a("#eab-wordpress_login-wrapper"),e=d.attr("data-post_id");a.post(_eab_data.ajax_url,{action:"eab_get_form",post_id:e},function(b){a("body").append('<div id="eab-wordpress_form">'+b+"</div>"),a("#eab-wordpress_form").find("."+d.attr("class")).click()})}function c(){var c=a.Deferred(),d=a("#eab-wordpress_login-registration_wrapper"),e={username:a("#eab-wordpress_login-registration_username").val(),email:a("#eab-wordpress_login-registration_email").val()};c.done(function(){if(!e.username||!e.email)return a("#eab-wordpress-signup-status").text(l10nEabApi.wp_missing_user_email),!1;d.append('<img class="eab-waiting" src="'+_eab_data.root_url+'/waiting.gif" />'),a.post(_eab_data.ajax_url,{action:"eab_wordpress_register",data:e},function(a){b(a)}).always(function(){d.find("img.eab-waiting").remove()})}),a(document).trigger("eab-api-registration-data",[e,c]),setTimeout(function(){"pending"===c.state()&&c.resolve()},500)}function d(){var c=a("#eab-wordpress_login-login_username").val(),d=a("#eab-wordpress_login-login_password").val();if(!c||!d)return a("#eab-wordpress-login-status").text(l10nEabApi.wp_missing_username_password),!1;a.post(_eab_data.ajax_url,{action:"eab_wordpress_login",data:{username:c,password:d}},function(a){b(a)})}function e(){return a("#eab-wordpress_login-registration_wrapper").is(":visible")?c():!!a("#eab-wordpress_login-login_wrapper").is(":visible")&&d()}function f(b,c){a("#eab-wordpress_login-background").length||(a("body").append("<div id='eab-wordpress_login-background'></div><div id='eab-wordpress_login-wrapper' class='"+b.removeClass("active").attr("class")+"' data-post_id='"+c+"'><div id='eab-wordpress_login-registration_wrapper' class='eab-wordpress_login-element_wrapper'><h4>"+l10nEabApi.wp_register+"</h4><p class='eab-wordpress_login-element eab-wordpress_login-element-message'>"+l10nEabApi.wp_registration_msg+"</p><p id='eab-wordpress-signup-status'></p><p class='eab-wordpress_login-element'><label for='eab-wordpress_login-registration_username'>"+l10nEabApi.wp_username+"</label><input type='text' id='eab-wordpress_login-registration_username' placeholder='' /></p><p class='eab-wordpress_login-element'><label for='eab-wordpress_login-registration_email'>"+l10nEabApi.wp_email+"</label><input type='text' id='eab-wordpress_login-registration_email' placeholder='' /></p></div><div id='eab-wordpress_login-login_wrapper' class='eab-wordpress_login-element_wrapper' style='display:none'><h4>"+l10nEabApi.wp_login+"</h4><p class='eab-wordpress_login-element eab-wordpress_login-element-message'>"+l10nEabApi.wp_login_msg+"</p><p id='eab-wordpress-login-status'></p><p class='eab-wordpress_login-element'><label for='eab-wordpress_login-login_username'>"+l10nEabApi.wp_username+"</label><input type='text' id='eab-wordpress_login-login_username' placeholder='' /></p><p class='eab-wordpress_login-element'><label for='eab-wordpress_login-login_password'>"+l10nEabApi.wp_password+"</label><input type='password' id='eab-wordpress_login-login_password' placeholder='' /></p><p class='forgot_password' style='margin: 5px 0'><a href='"+l10nEabApi.wp_lost_pw_url+"'>"+l10nEabApi.wp_lost_pw_text+"</a></p></div><div id='eab-wordpress_login-mode_toggle'><a href='#' data-on='"+l10nEabApi.wp_toggle_on+"' data-off='"+l10nEabApi.wp_toggle_off+"'>"+l10nEabApi.wp_toggle_on+"</a></div><div id='eab-wordpress_login-command_wrapper'><input type='button' id='eab-wordpress_login-command-ok' value='"+l10nEabApi.wp_submit+"' /><input type='button' id='eab-wordpress_login-command-cancel' value='"+l10nEabApi.wp_cancel+"' /></div></div>"),a(document).trigger("eab-api-registration-form_rendered"));var d=a("#eab-wordpress_login-background"),f=a("#eab-wordpress_login-wrapper");d.css({width:a(document).width(),height:a(document).height()}),f.css({left:(a(document).width()-300)/2}),a("#eab-wordpress_login-mode_toggle a").click(function(){var b=a(this);return a("#eab-wordpress_login-registration_wrapper").is(":visible")?(b.text(b.attr("data-off")),a("#eab-wordpress_login-registration_wrapper").hide(),a("#eab-wordpress_login-login_wrapper").show()):(b.text(b.attr("data-on")),a("#eab-wordpress_login-login_wrapper").hide(),a("#eab-wordpress_login-registration_wrapper").show()),!1}),a("#eab-wordpress_login-command-ok").click(e),a("#eab-wordpress_login-command-cancel, #eab-wordpress_login-background").click(function(){return f.remove(),d.remove(),!1})}function g(){return l10nEabApi.data.gg_client_id?'<li><span id="signinButton"> <span class="g-signin" data-callback="eab_google_plus_login_callback" data-clientid="'+l10nEabApi.data.gg_client_id+'" data-cookiepolicy="single_host_origin" data-scope="profile email"> </span> </span></li>':'<li><a href="#" class="wpmudevevents-login_link wpmudevevents-login_link-google">'+l10nEabApi.google+"</a></li>"}function h(b){a("#wpmudevevents-login_links-wrapper").length&&a("#wpmudevevents-login_links-wrapper").remove(),b.parents(".wpmudevevents-buttons").after('<div id="wpmudevevents-login_links-wrapper" />');var c=a("#wpmudevevents-login_links-wrapper"),d=b.parents(".wpmudevevents-buttons").find('input:hidden[name="event_id"]').val();c.html('<ul class="wpmudevevents-login_links">'+(l10nEabApi.data.show_facebook?'<li><a href="#" class="wpmudevevents-login_link wpmudevevents-login_link-facebook">'+l10nEabApi.facebook+"</a></li>":"")+(l10nEabApi.data.show_twitter?'<li><a href="#" class="wpmudevevents-login_link wpmudevevents-login_link-twitter">'+l10nEabApi.twitter+"</a></li>":"")+(l10nEabApi.data.show_google?g():"")+(l10nEabApi.data.show_wordpress?'<li><a href="#" class="wpmudevevents-login_link wpmudevevents-login_link-wordpress">'+l10nEabApi.wordpress+"</a></li>":"")+'<li><a href="#" class="wpmudevevents-login_link wpmudevevents-login_link-cancel">'+l10nEabApi.cancel+"</a></li></ul>"),b.addClass("active"),c.find(".wpmudevevents-login_link").each(function(){var e=a(this),g=!1;e.is(".wpmudevevents-login_link-facebook")?g=function(){return FB.login(function(e){console.log(e),e.authResponse&&e.authResponse.userID&&(c.html('<img src="'+_eab_data.root_url+'waiting.gif" /> '+l10nEabApi.please_wait),a.post(_eab_data.ajax_url,{action:"eab_facebook_login",user_id:e.authResponse.userID,token:FB.getAccessToken()},function(e){var f=0;try{f=parseInt(e.status,10)}catch(a){f=0}if(!f)return c.remove(),b.click(),!1;a.post(_eab_data.ajax_url,{action:"eab_get_form",post_id:d},function(c){a("body").append('<div id="eab-facebook_form">'+c+"</div>"),a("#eab-facebook_form").find("."+b.removeClass("active").attr("class")).click()})}))},{scope:_eab_data.fb_scope}),!1}:e.is(".wpmudevevents-login_link-twitter")?g=function(){var e=window.open("","twitter_login","scrollbars=no,resizable=no,toolbar=no,location=no,directories=no,status=no,menubar=no,copyhistory=no,height=400,width=600");return e.document.write(l10nEabApi.please_wait),a.post(_eab_data.ajax_url,{action:"eab_get_twitter_auth_url",url:window.location.toString()},function(f){var g=function(){a(e).off("unload",g);var h=setInterval(function(){try{if(e.location.hostname==window.location.hostname){var g=e.location,i="";try{i=g.search}catch(a){i=""}clearInterval(h),e.close(),c.html('<img src="'+_eab_data.root_url+'waiting.gif" /> '+l10nEabApi.please_wait),a.post(_eab_data.ajax_url,{action:"eab_twitter_login",secret:f.secret,data:i},function(e){var f=0;try{f=parseInt(e.status,10)}catch(a){f=0}if(!f)return c.remove(),b.click(),!1;a.post(_eab_data.ajax_url,{action:"eab_get_form",post_id:d},function(c){a("body").append('<div id="eab-twitter_form">'+c+"</div>"),a("#eab-twitter_form").find("."+b.removeClass("active").attr("class")).click()})})}}catch(a){}},300)};a(e).on("unload",g);try{e.location=f.url}catch(a){e.location.replace(f.url)}}),!1}:e.is(".wpmudevevents-login_link-google")?g=function(){var e=window.open("https://www.google.com/accounts","google_login","scrollbars=no,resizable=no,toolbar=no,location=no,directories=no,status=no,menubar=no,copyhistory=no,height=400,width=800");return a.post(_eab_data.ajax_url,{action:"eab_get_google_auth_url",url:window.location.href},function(f){var g=f.url;e.location=g;var h=setInterval(function(){try{e.location.hostname==window.location.hostname&&(clearInterval(h),e.close(),c.html('<img src="'+_eab_data.root_url+'waiting.gif" /> '+l10nEabApi.please_wait),a.post(_eab_data.ajax_url,{action:"eab_google_login"},function(e){var f=0;try{f=parseInt(e.status,10)}catch(a){f=0}if(!f)return c.remove(),b.click(),!1;a.post(_eab_data.ajax_url,{action:"eab_get_form",post_id:d},function(c){a("body").append('<div id="eab-google_form">'+c+"</div>"),a("#eab-google_form").find("."+b.removeClass("active").attr("class")).click()})}))}catch(a){}},300)}),!1}:e.is(".wpmudevevents-login_link-wordpress")?g=function(){return f(b,d),!1}:e.is(".wpmudevevents-login_link-cancel")&&(g=function(){return b.removeClass("active"),c.remove(),!1}),g&&e.unbind("click").bind("click",g)}),l10nEabApi.data.gg_client_id&&"undefined"!=typeof gapi&&void 0!==gapi.signin&&gapi.signin.go()}function i(b){b.status.signed_in&&a.post(_eab_data.ajax_url,{action:"eab_google_plus_login",token:b.access_token},function(a){window.location.href=window.location.href})}a(function(){a("a.wpmudevevents-yes-submit, a.wpmudevevents-maybe-submit, a.wpmudevevents-no-submit").css("float","left").unbind("click").on("click touchend",function(){return a("a.wpmudevevents-yes-submit, a.wpmudevevents-maybe-submit, a.wpmudevevents-no-submit").removeClass("active"),h(a(this)),!1}),l10nEabApi.data.gg_client_id&&(window.eab_google_plus_login_callback=i,function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://apis.google.com/js/client:plusone.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}())})}(jQuery);