var GMW_Extensions={processing:!1,set_processing:function(e){e?jQuery("#gmw-extensions-page .disabler-block").show():setTimeout(function(){jQuery("#gmw-extensions-page .disabler-block").hide()},2500),GMW_Extensions.processing=e},init:function(){jQuery(".extensions-wrapper").find(".gmw-extension-wrapper.premium.inactive").sort().appendTo(jQuery(".extensions-wrapper")),jQuery(".extensions-updater .info-toggle, .extensions-cache .info-toggle").hover(function(){jQuery(this).closest("div").find(".info-wrapper").fadeIn("fast")},function(){jQuery(this).closest("div").find(".info-wrapper").fadeOut("fast")}),GMW_Extensions.tabs_init(),jQuery(document).on("click",".extensions-updater-button",function(e){e.preventDefault(),GMW_Extensions.set_processing(!0),GMW_Extensions.extensions_updater(jQuery(this))}),jQuery(document).on("click",".gmw-extension-action-button",function(e){e.preventDefault(),GMW_Extensions.set_processing(!0),GMW_Extensions.extension_activation(jQuery(this))}),jQuery(document).on("click",".gmw-license-action-button",function(e){e.preventDefault(),GMW_Extensions.set_processing(!0),GMW_Extensions.license_key_actions(jQuery(this))})},tabs_init:function(){jQuery("#gmw-extensions-filter ul li a").click(function(e){e.preventDefault(),jQuery(this).hasClass("filter-tab")&&(""==jQuery(this).data("filter")?jQuery(".extensions-title").fadeIn("fast"):jQuery(".extensions-title").fadeOut("fast")),jQuery(this).hasClass("filter-tab")?(type=filters=jQuery(this).data("filter"),jQuery("#gmw-extensions-filter ul li a.active-tab").hasClass("current")&&(filters+=".active"),jQuery(".filter-tab").removeClass("current"),jQuery(this).addClass("current"),jQuery(".extensions-wrapper .gmw-extension-wrapper").fadeOut("fast"),jQuery(".extensions-wrapper .gmw-extension-wrapper"+filters).fadeIn("fast")):(jQuery(this).toggleClass("current"),type=filters=jQuery("#gmw-extensions-filter ul li a.filter-tab.current").data("filter"),jQuery(this).hasClass("current")&&(filters+=".active"),jQuery(".extensions-wrapper .gmw-extension-wrapper").fadeOut("fast"),jQuery(".extensions-wrapper .gmw-extension-wrapper"+filters).fadeIn("fast"))})},extensions_updater:function(e){e.addClass("updating-message"),jQuery.ajax({type:"POST",dataType:"json",url:gmwVars.ajaxUrl,data:{action:"gmw_extensions_updater",updater_action:e.attr("data-action"),security:e.attr("data-nonce")},success:function(s){e.toggleClass("updating-message updated-message"),setTimeout(function(){e.removeClass("updated-message").fadeOut("fast",function(){"updater_enabled"==s?(e.toggleClass("button-primary button-secondary").attr("data-action","disable").html("Disable Updater").fadeIn("fast"),e.closest(".extensions-updater").toggleClass("disabled enabled")):(e.toggleClass("button-secondary button-primary").attr("data-action","enable").html("Enable Updater").fadeIn("fast"),e.closest(".extensions-updater").toggleClass("enabled disabled"))})},1500)}}).fail(function(s,a,t){window.console&&window.console.log&&(console.log(a+": "+t),s.responseText&&console.log(s.responseText)),orgHtml=e.html(),orgClass=e.attr("class"),e.fadeOut("fast",function(){e.html("Failed").removeClass("updating-message button-primary").addClass("gmw-icon-cancel button-secondary").fadeIn("fast")}),setTimeout(function(){e.fadeOut("fast",function(){e.html(orgHtml).attr("class",orgClass).removeClass("updating-message").fadeIn("fast")})},1500),GMW_Extensions.set_processing(!1)}).done(function(e){GMW_Extensions.set_processing(!1)})},extension_activation:function(e){e.html(e.data("updating_message")).addClass("updating-message"),actionLinkWrap=e.closest(".gmw-extension-wrapper"),licenseData=e.data(),jQuery.ajax({type:"GET",dataType:"json",url:gmwVars.ajaxUrl,data:{action:"gmw_"+licenseData.action,gmw_action:licenseData.action,slug:licenseData.slug,basename:licenseData.basename,security:licenseData.nonce},success:function(s){newLink=s.newLink,e.html(e.data("updated_message")).toggleClass("updating-message updated-message"),setTimeout(function(){e.fadeOut("slow",function(){e.closest(".gmw-extension-wrapper.active, .gmw-extension-wrapper.inactive").toggleClass("active inactive").removeClass("disabled"),jQuery(this).replaceWith(newLink),jQuery(newLink).fadeIn("slow"),jQuery.each(s.dependends,function(e,s){"activate_extension"==licenseData.action?jQuery('.gmw-extension-wrapper[data-slug="'+e+'"]').removeClass("disabled"):jQuery('.gmw-extension-wrapper[data-slug="'+e+'"]').removeClass("active").addClass("inactive disabled").find(".activation-disabled-message p span").html(s)})})},1500)}}).fail(function(s,a,t){window.console&&window.console.log&&(console.log(a+": "+t),s.responseText&&console.log(s.responseText)),orgClass=e.attr("class"),e.fadeOut("slow",function(){e.html("Failed").toggleClass("updating-message gmw-icon-cancel disabled").fadeIn()}),setTimeout(function(){e.fadeOut("slow",function(){e.html(e.data("label")).addClass(orgClass).removeClass("gmw-icon-cancel updating-message disabled").fadeIn(),actionLinkWrap.find(".activation-disabled-message p span").html(s.responseText),403!=s.status&&actionLinkWrap.addClass("disabled")})},1500),GMW_Extensions.set_processing(!1)}).done(function(e){GMW_Extensions.set_processing(!1)})},license_key_actions:function(e){licenseWrap=e.closest(".gmw-license-wrapper"),actionMessageWrap=licenseWrap.find(".actions-message"),license_data=e.data(),license_data.license_key=licenseWrap.find(".gmw-license-key").val(),e.hide(),license_data.license_key?"activate_license"==license_data.action?actionMessageWrap.addClass("updating-message button-primary").html("Activating").show():actionMessageWrap.addClass("updating-message button-secondary").html("Dectivating").show():actionMessageWrap.addClass("updating-message button-primary").html("Removing key").show(),jQuery.ajax({type:"POST",dataType:"json",url:gmwVars.ajaxUrl,data:{action:"gmw_license_key_actions",data:license_data,security:license_data.nonce},success:function(e){console.log(e),newLicenseWrap=e.form,licenseData=e.license_data,"activate_license"==license_data.action?"blank_key"!=licenseData.remote_connection&&("valid"==licenseData.license?actionMessageWrap.removeClass("updating-message").addClass("updated-message").html("Activated").show():actionMessageWrap.removeClass("updating-message button-primary").addClass("gmw-icon-cancel button-secondary").html("Failed").show()):actionMessageWrap.removeClass("updating-message").addClass("updated-message").html("Dectivated").show(),setTimeout(function(){licenseWrap.hide(),newLicenseWrap=jQuery(newLicenseWrap).hide(),licenseWrap.replaceWith(newLicenseWrap),newLicenseWrap.show()},1500)}}).fail(function(s,a,t){window.console&&window.console.log&&(console.log(a+": "+t),s.responseText&&console.log(s.responseText)),actionMessageWrap.fadeOut("slow",function(){actionMessageWrap.html("Failed").removeClass("updating-message button-primary").addClass("gmw-icon-cancel button-secondary").fadeIn()}),setTimeout(function(){actionMessageWrap.fadeOut("slow",function(){e.fadeIn()})},1500),GMW_Extensions.set_processing(!1)}).done(function(e){GMW_Extensions.set_processing(!1)})}};jQuery(document).ready(function(){GMW_Extensions.init()});