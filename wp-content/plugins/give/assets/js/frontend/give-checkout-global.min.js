var give_scripts,give_global_vars;jQuery(function(e){function a(){var a=e(this),t=a.parents("form");if("card_state"!=a.attr("id")){t.find("#card_state").empty().append('<option value="1">'+give_global_vars.general_loading+"</option>").prop("disabled",!0);var i={action:"give_get_states",country:a.val(),field_name:"card_state"};e.ajax({type:"POST",data:i,url:give_global_vars.ajaxurl,xhrFields:{withCredentials:!0},success:function(e){var a="",i=e.states_label;a=void 0!=typeof e.states_found&&1==e.states_found?e.data:'<input type="text" id="card_state"  name="card_state" class="cart-state give-input required" placeholder="'+i+'" value=""/>',!1===t.hasClass("float-labels-enabled")?"undefined"!=typeof e.states_require&&1==e.states_require?t.find('input[name="card_state"], select[name="card_state"]').closest("p").find("label .give-required-indicator").removeClass("give-hidden"):t.find('input[name="card_state"], select[name="card_state"]').closest("p").find("label .give-required-indicator").addClass("give-hidden"):t.find('input[name="card_state"], select[name="card_state"]').closest("p").find("label").text(i),t.find('input[name="card_state"], select[name="card_state"]').closest("p").find("label .state-label-text").text(i),t.find('input[name="card_state"], select[name="card_state"]').replaceWith(a),void 0!=typeof e.show_field&&1==e.show_field?t.find("p#give-card-state-wrap").removeClass("give-hidden"):t.find("p#give-card-state-wrap").addClass("give-hidden"),v.trigger("give_checkout_billing_address_updated",[e,t.attr("id")])}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}return!1}function t(){var a=e("form.give-form");a.each(function(a,t){t=e(t);var i=t.find(".card-number"),n=t.find(".card-cvc"),r=t.find(".card-expiry");i.length&&(i.payment("formatCardNumber"),n.payment("formatCardCVC"),r.payment("formatCardExpiry"))})}function i(e,a){e=e.toString().trim();var t=parseInt(give_global_vars.number_decimals);if("INR"===give_global_vars.currency){actual_price=accounting.unformat(e,give_global_vars.decimal_separator).toString();var i=result=amount="",n=actual_price.indexOf(".");for(-1!==n&&t&&(i=Number(actual_price.substr(parseInt(n))).toFixed(t).toString().substr(1),actual_price=actual_price.substr(0,parseInt(n)),i.length?t+1>i.length&&(i=(i+"000000000").substr(0,t+1)):i=".0000000000".substr(0,pa+1)),result=actual_price.substr(-3),amount=actual_price.substr(0,parseInt(actual_price.length)-3);amount.length>0;)result=amount.substr(-2)+give_global_vars.thousands_separator+result,amount=amount.substr(0,parseInt(amount.length)-2);i.length&&(result+=i),e=result,void 0!==a.symbol&&a.symbol.length&&("after"===give_global_vars.currency_pos?e+=a.symbol:e=a.symbol+e)}else"after"===give_global_vars.currency_pos&&(a.format="%v%s"),e=accounting.formatMoney(e,a);return e}function n(e){return Math.abs(parseFloat(accounting.unformat(e,give_global_vars.decimal_separator)))}function r(e){var a={symbol:"",decimal:give_global_vars.decimal_separator,thousand:give_global_vars.thousands_separator,precision:give_global_vars.number_decimals};return i(e,a)}function o(a){var t=[];return a.hasClass("give-form-type-multi")?(e.each(a.find(".give-donation-levels-wrap [data-price-id] "),function(e,a){a=a instanceof jQuery?a:jQuery(a),t.push({price_id:a.data("price-id"),amount:n(a.val())})}),t):t}function l(a){var t=a.parents("form"),i=a.val(),r=a.data("price-id");return void 0==r&&(r=a.find("option:selected").data("price-id")),"custom"===i?(t.find(".give-amount-top").val("").focus(),!1):(t.find(".give-amount-top").val(i),t.find("span.give-amount-top").text(i),e(".give-donation-amount .give-text-input",t).data("amount",n(t.find(".give-final-total-amount").data("total"))),t.find(".give-donation-amount .give-text-input").trigger("blur",[t,i,r]),void e(document).trigger("give_donation_value_updated",[t,i,r]))}function d(){var a=s("form-id"),t=s("payment-mode");if(!a||!t)return!1;var i=e("body").find("#give-form-"+a+"-wrap"),n=i.find("form.give-form"),r=i.hasClass("give-display-modal"),o=i.hasClass("give-display-reveal");n.find("#give-gateway-radio-list label").removeClass("give-gateway-option-selected"),n.find("input[name=payment-mode][value="+t+"]").prop("checked",!0).parent().addClass("give-gateway-option-selected");var d=s("level-id"),v=n.find('*[data-price-id="'+d+'"]');v.length>0&&l(v),r?give_open_form_modal(i,n):o&&(n.find(".give-btn-reveal").hide(),n.find("#give-payment-mode-select, #give_purchase_form_wrap").slideDown())}function s(e,a){a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=t.exec(a);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}var v=e(document);v.on("change","#give_cc_address input.card_state, #give_cc_address select",a),t(),v.on("give_gateway_loaded",function(e){t()}),e.fn.toggleError=function(e){return this.toggleClass("error",e),this.toggleClass("valid",!e),this},v.on("keyup change focusout",".give-form .card-number, .give-form .card-cvc, .give-form .card-expiry",function(a){var t=e(this),i=t.parents("form.give-form"),n=t.attr("id"),r=i.find(".card-number"),o=i.find(".card-cvc"),l=i.find(".card-expiry"),d=e.payment.cardType(r.val()),s=!1;switch(a.type){case"focusout":n.indexOf("card_number")>-1?(s=!e.payment.validateCardNumber(r.val()),r.toggleError(s)):n.indexOf("card_cvc")>-1?(s=!e.payment.validateCardCVC(o.val(),d),o.toggleError(s)):n.indexOf("card_expiry")>-1&&(s=!e.payment.validateCardExpiry(l.payment("cardExpiryVal")),l.toggleError(s)),t.parents("form").find(".give-submit").prop("disabled",s);break;default:if(t.hasClass("error")&&t.removeClass("error"),n.indexOf("card_number")>-1){var v=i.find(".card-type");null===d?(v.removeClass().addClass("off card-type"),t.removeClass("valid").addClass("error")):v.removeClass().addClass("card-type "+d)}else if(n.indexOf("card_expiry")>-1){var c=l.payment("cardExpiryVal");i.find(".card-expiry-month").val(c.month),i.find(".card-expiry-year").val(c.year)}}}),v.on("submit","#give_payment_mode",function(){var a=e("#give-gateway option:selected").val();if(0==a)return alert(give_global_vars.no_gateway),!1}),v.on("click","#give-payment-mode-select input",function(){var a=e(this).parents("form"),t=e("#give-payment-mode-select li"),i=e('#give-payment-mode-select li.give-gateway-option-selected input[name="payment-mode"]').val(),n="";t.removeClass("give-gateway-option-selected"),t.prop("checked",!1),e(this).prop("checked",!0),e(this).parent().addClass("give-gateway-option-selected"),n=e('#give-payment-mode-select li.give-gateway-option-selected input[name="payment-mode"]').val(),a.attr("action",a.attr("action").replace("payment-mode="+i,"payment-mode="+n))}),v.on("focus",".give-donation-amount .give-text-input",function(a){var t=e(this).parents("form");e(this).removeClass("invalid-amount");var i=t.find(".give-final-total-amount").data("total");e(this).data("amount",n(i)),e(this).parent(".give-donation-amount").addClass("give-custom-amount-focus-in"),t.find(".give-default-level, .give-radio-input").removeClass("give-default-level"),t.find(".give-btn-level-custom").addClass("give-default-level"),t.find(".give-radio-input").prop("checked",!1),t.find(".give-radio-input.give-radio-level-custom").prop("checked",!0),t.find(".give-select-level").prop("selected",!1),t.find(".give-select-level .give-donation-level-custom").prop("selected",!0)}),v.on("blur",".give-donation-amount .give-text-input",function(a,t,l,d){var s=void 0!=t?t:e(this).closest("form"),v=e(this).data("amount"),c=void 0!=l?l:e(this).val(),u=s.find('input[name="give-form-minimum"]'),g=n(u.val()),p=0==c?g:n(c),m=o(e(this).parents("form")),f="";d=void 0!=d?d:-1;var _={symbol:"",decimal:give_global_vars.decimal_separator,thousand:give_global_vars.thousands_separator,precision:give_global_vars.number_decimals},h=i(p,_);if(e(this).val(h),!m.length||-1<d||(e.each(m,function(e,a){if(a.amount===p)return d=a.price_id,!1}),!(-1<d)&&g<=p&&(d="custom")),(p<g||p<1)&&-1===d){e(this).addClass("give-invalid-amount"),_.symbol=give_global_vars.currency_sign,f=give_global_vars.bad_minimum+" "+i(g,_),s.find(".give-submit").prop("disabled",!0);var b=s.find(".give-invalid-minimum");if(0===b.length){var y=e('<div class="give_error give-invalid-minimum">'+f+"</div>").hide();y.insertBefore(s.find(".give-total-wrap")).show()}}else e(this).removeClass("give-invalid-amount"),s.find(".give-invalid-minimum").slideUp(300,function(){e(this).remove()}),s.find(".give-submit").prop("disabled",!1);if(v!==p&&(_.symbol=give_global_vars.currency_sign,s.find(".give-final-total-amount").data("total",p).text(i(p,_))),-1!==d)switch(e('input[name="give-price-id"]',s).val(d),s.find(".give-amount-hidden").val(r(p)),s.find(".give-default-level").removeClass("give-default-level"),!0){case!!s.find(".give-radio-input").length:s.find(".give-radio-input").prop("checked",!1),s.find('.give-radio-input[data-price-id="'+d+'"]').prop("checked",!0).addClass("give-default-level");break;case!!s.find("button.give-donation-level-btn").length:s.find("button.give-donation-level-btn").blur(),s.find('button.give-donation-level-btn[data-price-id="'+d+'"]').focus().addClass("give-default-level");break;case!!s.find("select.give-select-level").length:s.find("select.give-select-level option").prop("selected",!1),s.find('select.give-select-level option[data-price-id="'+d+'"]').prop("selected",!0).addClass("give-default-level")}e(this).parent(".give-donation-amount").removeClass("give-custom-amount-focus-in")}),v.on("click touchend",".give-donation-level-btn",function(a){a.preventDefault(),l(e(this))}),v.on("click touchend",".give-radio-input-level",function(a){l(e(this))}),v.on("change",".give-select-level",function(a){l(e(this))}),d(),v.on("click",".give_terms_links",function(a){a.preventDefault();var t=e(this).closest("fieldset");return e("[class^=give_terms-]",t).slideToggle(),e("a.give_terms_links",t).toggle(),!1})});