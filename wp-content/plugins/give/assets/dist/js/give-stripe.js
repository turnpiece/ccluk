(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t,r){for(var i=0;i<r.length;i++){var a=r[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,(n=a.key,l=void 0,l=function(t,r){if("object"!==e(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,r||"default");if("object"!==e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(n,"string"),"symbol"===e(l)?l:String(l)),a)}var n,l}var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t&&(this.formElement=t,this.publishableKey=t.getAttribute("data-publishable-key"),this.accountId=t.getAttribute("data-account")?t.getAttribute("data-account"):"",this.idPrefix=t.getAttribute("data-id")?t.getAttribute("data-id"):"",this.locale=give_stripe_vars.preferred_locale,this.fieldsFormat=give_stripe_vars.cc_fields_format,this.isSingleInputField="single"===this.fieldsFormat,this.isMounted=!1,this.fontStyles=[],0!==Object.keys(give_stripe_vars.element_font_styles).length&&this.fontStyles.push(give_stripe_vars.element_font_styles))}var r,i,a;return r=e,(i=[{key:"setupStripeElement",value:function(){var e={};return 0!==this.accountId.trim().length&&(e={stripeAccount:this.accountId}),Stripe(this.publishableKey,e)}},{key:"getElements",value:function(e){var t={locale:this.locale};return this.fontStyles.length>0&&(t={fonts:this.fontStyles,locale:this.locale}),e.elements(t)}},{key:"createElement",value:function(e,t){var r=[],i=this.getElementsToMountOn(),a={style:this.getElementStyles(),classes:this.getElementClasses()};return i.forEach((function(t,i){"card"===t[0]?a.hidePostalCode=!!give_stripe_vars.checkout_address:"cardNumber"===t[0]?a.placeholder=give_stripe_vars.card_number_placeholder_text:"cardCvc"===t[0]?a.placeholder=give_stripe_vars.card_cvc_placeholder_text:delete a.placeholder,r.push(e.create(t[0],a))})),"cardNumber"===i[0][0]&&r[0].addEventListener("change",(function(e){var r="diners"===e.brand?"dinersclub":e.brand;t.querySelector(".card-type").className="card-type "+r})),r}},{key:"destroyElement",value:function(e){e.forEach((function(e,t){e.destroy()}))}},{key:"getElementStyles",value:function(){return{base:give_stripe_vars.element_base_styles,complete:give_stripe_vars.element_complete_styles,empty:give_stripe_vars.element_empty_styles,invalid:give_stripe_vars.element_invalid_styles}}},{key:"getElementClasses",value:function(){return{focus:"focus",empty:"empty",invalid:"invalid"}}},{key:"getElementsToMountOn",value:function(){var e={cardNumber:"#give-card-number-field-".concat(this.idPrefix),cardCvc:"#give-card-cvc-field-".concat(this.idPrefix),cardExpiry:"#give-card-expiration-field-".concat(this.idPrefix)};return this.isSingleInputField&&(e={card:"#give-stripe-single-cc-fields-".concat(this.idPrefix)}),Object.entries(e)}},{key:"mountElement",value:function(e){var t=this.getElementsToMountOn();Array.from(e).forEach((function(e,r){e.mount(t[r][1])}))}},{key:"unMountElement",value:function(e){var t=this.getElementsToMountOn();Array.from(e).forEach((function(e,r){e.unmount(t[r][1])}))}},{key:"createPaymentMethod",value:function(e,t,r){var i={};if(this.isSingleInputField||(i.name=e.querySelector('input[name="card_name"]').value),!give_stripe_vars.stripe_card_update){var a=e.querySelector('input[name="give_first"]').value,n=e.querySelector('input[name="give_last"]').value,l=e.querySelector('input[name="give_email"]').value;i.name="".concat(a," ").concat(n),i.email=l,e.querySelector("[id^=give-purchase-button]").setAttribute("disabled","disabled")}if(give_stripe_vars.checkout_address&&!give_stripe_vars.stripe_card_update){var o=e.querySelector(".card-address").value,c=e.querySelector(".card-address-2").value,s=e.querySelector(".card-city").value,u=e.querySelector(".card_state").value,d=e.querySelector(".card-zip").value,v=e.querySelector(".billing-country").value;i.address={line1:o||"",line2:c||"",city:s||"",state:u||"",postal_code:d||"",country:v||""}}t.createPaymentMethod({type:"card",card:r[0],billing_details:i}).then((function(t){if(t.error){var r=jQuery(e),i='<div class="give_errors"><p class="give_error">'.concat(t.error.message,"</p></div>"),a=e.getAttribute("data-id");return Give.form.fn.resetDonationButton(r),void(e.querySelector("#give-stripe-payment-errors-".concat(a)).innerHTML=i)}e.querySelector('input[name="give_stripe_payment_method"]').value=t.paymentMethod.id,e.submit()}))}},{key:"triggerStripeModal",value:function(e,t,r,i){var a=e.querySelector('input[name="give-form-id-prefix"]'),n=e.querySelector("#give-stripe-checkout-modal-donate-button-".concat(a.value)),l=e.querySelector('input[name="card_name"]'),o=document.querySelector(".give-stripe-checkout-modal-container"),c=document.querySelector("#give-purchase-button"),s={};c.addEventListener("click",(function(){o.scrollIntoView({behavior:"smooth"})})),i.forEach((function(e){s.cardName=!1,e.addEventListener("ready",(function(e){s[e.elementType]=!1,s.cardName="card"===e.elementType})),e.addEventListener("change",(function(e){s[e.elementType]=e.complete,Object.values(s).every((function(e){return!0===e}))?n.removeAttribute("disabled"):n.setAttribute("disabled","disabled")}))})),null!==l&&l.addEventListener("keyup",(function(e){s.cardName=""!==e.target.value,Object.values(s).every((function(e){return!0===e}))?n.removeAttribute("disabled"):n.setAttribute("disabled","disabled")})),null!==n&&n.addEventListener("click",(function(a){var l=a.target,o=l.nextElementSibling;n.getAttribute("data-is_legacy_form")?(l.value=give_global_vars.purchase_loading,o.style.display="inline-block"):(l.value="",o.classList.add("sequoia-loader"),o.classList.add("spinning"),o.classList.remove("give-loading-animation")),t.createPaymentMethod(e,r,i),a.preventDefault()}))}}])&&t(r.prototype,i),a&&t(r,a),Object.defineProperty(r,"prototype",{writable:!1}),e}();document.addEventListener("DOMContentLoaded",(function(e){Array.from(document.querySelectorAll(".give-form-wrap")).forEach((function(e){var t=e.querySelector(".give-form");if(null!==t&&t.getAttribute("data-publishable-key")){var i=give_stripe_vars.hasOwnProperty("stripe_card_update")&&parseInt(give_stripe_vars.stripe_card_update),a=t.querySelector('input[name="give-form-id-prefix"]'),n=new r(t),l=n.setupStripeElement(),o=n.getElements(l),c=n.createElement(o,t),s=Give.form.fn.getInfo("stripe-checkout-type",t);d(!1),document.addEventListener("give_gateway_loaded",d),t.onsubmit=function(e){var r=u(),o=r.selectedGatewayId,s=r.isStripeModalCheckoutGateway;if((i||"stripe"===o)&&(n.createPaymentMethod(t,l,c),e.preventDefault()),s){var d=t.querySelector(".give-stripe-checkout-modal"),v=d.querySelector(".give-stripe-checkout-donation-amount"),m=d.querySelector(".give-stripe-checkout-donor-email"),p=t.querySelector(".give-final-total-amount").textContent,y=t.querySelector('input[name="give_email"]').value,f=t.querySelector('input[name="give_validate_stripe_payment_fields"]');d.classList.add("give-stripe-checkout-show-modal"),null!==v&&(v.innerHTML=p),null!==m&&(m.innerHTML=y),f.setAttribute("value","1");var g=t.querySelector(".give-stripe-checkout-modal-close");null!==g&&g.addEventListener("click",(function(e){t.querySelector("#give-stripe-checkout-modal-".concat(a.value)).classList.remove("give-stripe-checkout-show-modal");var r=t.querySelector(".give-submit");null!==r&&(r.value=r.getAttribute("data-before-validation-label"),r.nextElementSibling.style.display="none",r.removeAttribute("disabled"),t.querySelector('input[name="give_validate_stripe_payment_fields"]').setAttribute("value","0")),e.preventDefault()})),e.preventDefault()}}}function u(){var e=t.querySelector('input[name="give-gateway"]'),r=e?e.value:"",i="modal"===s;return{formGateway:e,selectedGatewayId:r,isCheckoutTypeModal:i,isStripeModalCheckoutGateway:e&&"stripe_checkout"===r&&i}}function d(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=u(),a=r.selectedGatewayId,o=r.isStripeModalCheckoutGateway;i||"stripe"===a||o?n.mountElement(c):e&&n.unMountElement(c),o&&n.triggerStripeModal(t,n,l,c)}}))}))})();